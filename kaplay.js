"use strict";var kaplay=(()=>{var vr=Object.defineProperty;var lu=Object.getOwnPropertyDescriptor;var mu=Object.getOwnPropertyNames;var pu=Object.prototype.hasOwnProperty;var i=(t,e)=>vr(t,"name",{value:e,configurable:!0});var du=(t,e)=>{for(var r in e)vr(t,r,{get:e[r],enumerable:!0})},fu=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of mu(e))!pu.call(t,o)&&o!==r&&vr(t,o,{get:()=>e[o],enumerable:!(n=lu(e,o))||n.enumerable});return t};var hu=t=>fu(vr({},"__esModule",{value:!0}),t);var ho=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return r=>{for(var n=r.length,o=new Uint8Array((n-(r[n-1]=="=")-(r[n-2]=="="))*3/4|0),s=0,a=0;s<n;){var c=t[r.charCodeAt(s++)],u=t[r.charCodeAt(s++)],m=t[r.charCodeAt(s++)],l=t[r.charCodeAt(s++)];o[a++]=c<<2|u>>4,o[a++]=u<<4|m>>2,o[a++]=m<<6|l}return o}})();var Vc={};du(Vc,{default:()=>Ac});var _=class t{static{i(this,"Color")}r=255;g=255;b=255;constructor(e,r,n){this.r=Ke(e,0,255),this.g=Ke(r,0,255),this.b=Ke(n,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new t(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!r)throw new Error("Invalid hex color format");return new t(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,r,n){if(r==0)return new t(255*n,255*n,255*n);let o=i((l,p,f)=>(f<0&&(f+=1),f>1&&(f-=1),f<1/6?l+(p-l)*6*f:f<1/2?p:f<2/3?l+(p-l)*(2/3-f)*6:l),"hue2rgb"),s=n<.5?n*(1+r):n+r-n*r,a=2*n-s,c=o(a,s,e+1/3),u=o(a,s,e),m=o(a,s,e-1/3);return new t(Math.round(c*255),Math.round(u*255),Math.round(m*255))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,r){return new t(Oe(this.r,e.r,r),Oe(this.g,e.g,r),Oe(this.b,e.b,r))}toHSL(){let e=this.r/255,r=this.g/255,n=this.b/255,o=Math.max(e,r,n),s=Math.min(e,r,n),a=(o+s)/2,c=a,u=a;if(o==s)a=c=0;else{let m=o-s;switch(c=u>.5?m/(2-o-s):m/(o+s),o){case e:a=(r-n)/m+(r<n?6:0);break;case r:a=(n-e)/m+2;break;case n:a=(e-r)/m+4;break}a/=6}return[a,c,u]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function W(...t){if(t.length===0)return new _(255,255,255);if(t.length===1){if(t[0]instanceof _)return t[0].clone();if(typeof t[0]=="string")return _.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return _.fromArray(t[0])}else if(t.length===2){if(t[0]instanceof _)return t[0].clone()}else if(t.length===3||t.length===4)return new _(t[0],t[1],t[2]);throw new Error("Invalid color arguments")}i(W,"rgb");var go=i((t,e,r)=>_.fromHSL(t,e,r),"hsl2rgb");function ae(t){return t*Math.PI/180}i(ae,"deg2rad");function at(t){return t*180/Math.PI}i(at,"rad2deg");function Ke(t,e,r){return e>r?Ke(t,r,e):Math.min(Math.max(t,e),r)}i(Ke,"clamp");function Oe(t,e,r){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*r;if(t instanceof O&&e instanceof O)return t.lerp(e,r);if(t instanceof _&&e instanceof _)return t.lerp(e,r);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}i(Oe,"lerp");function Le(t,e,r,n,o){return n+(t-e)/(r-e)*(o-n)}i(Le,"map");function yo(t,e,r,n,o){return Ke(Le(t,e,r,n,o),n,o)}i(yo,"mapc");var O=class t{static{i(this,"Vec2")}x=0;y=0;constructor(e=0,r=e){this.x=e,this.y=r}static fromAngle(e){let r=ae(e);return new t(Math.cos(r),Math.sin(r))}static fromArray(e){return new t(e[0],e[1])}static ZERO=new t(0,0);static ONE=new t(1,1);static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);toAxis(){return Math.abs(this.x)>Math.abs(this.y)?this.x<0?t.LEFT:t.RIGHT:this.y<0?t.UP:t.DOWN}clone(){return new t(this.x,this.y)}static copy(e,r){return r.x=e.x,r.y=e.y,r}add(...e){let r=b(...e);return new t(this.x+r.x,this.y+r.y)}static addScaled(e,r,n,o){return o.x=e.x+r.x*n,o.y=e.y+r.y*n,o}static addc(e,r,n,o){return o.x=e.x+r,o.y=e.y+n,o}static add(e,r,n){return n.x=e.x+r.x,n.y=e.y+r.y,n}sub(...e){let r=b(...e);return new t(this.x-r.x,this.y-r.y)}static subc(e,r,n,o){return o.x=e.x-r,o.y=e.y-n,o}static sub(e,r,n){return n.x=e.x-r.x,n.y=e.y-r.y,n}scale(...e){let r=b(...e);return new t(this.x*r.x,this.y*r.y)}static scale(e,r,n){return n.x=e.x*r,n.y=e.y*r,n}static scalec(e,r,n,o){return o.x=e.x*r,o.y=e.y*n,o}static scalev(e,r,n){return n.x=e.x*r.x,n.y=e.y*r.y,n}dist(...e){let r=b(...e);return this.sub(r).len()}static dist(e,r){let n=e.x-r.x,o=e.y-r.y;return Math.sqrt(n*n+o*o)}sdist(...e){let r=b(...e);return this.sub(r).slen()}static sdist(e,r){let n=e.x-r.x,o=e.y-r.y;return n*n+o*o}len(){return Math.sqrt(this.dot(this))}static len(e){return Math.sqrt(e.x*e.x+e.y*e.y)}slen(){return this.dot(this)}static slen(e){return e.x*e.x+e.y*e.y}unit(){let e=this.len();return e===0?new t(0):this.scale(1/e)}static unit(e,r){let n=t.len(e);return r.x=e.x/n,r.y=e.y/n,r}normal(){return new t(this.y,-this.x)}static normal(e,r){return r.x=e.y,r.y=-e.x,r}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}rotate(e){if(e instanceof t)return new t(this.x*e.x-this.y*e.y,this.x*e.y+this.y*e.x);{let r=ae(e),n=Math.cos(r),o=Math.sin(r);return new t(this.x*n-this.y*o,this.x*o+this.y*n)}}static rotate(e,r,n){let o=e.x;return n.x=e.x*r.x-e.y*r.y,n.y=o*r.y+e.y*r.x,n}static rotateByAngle(e,r,n){let o=Math.cos(r),s=Math.sin(r),a=e.x;return n.x=e.x*o-e.y*s,n.y=a*s+e.y*o,n}invRotate(e){return e instanceof t?this.rotate(new t(e.x,-e.y)):this.rotate(-e)}static inverseRotate(e,r,n){let o=e.x;return n.x=e.x*r.x+e.y*r.y,n.y=-o*r.y+e.y*r.x,n}dot(e){return this.x*e.x+this.y*e.y}static dot(e,r){return e.x*e.x+e.y*e.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,r){return e.x*r.y-e.y*r.x}angle(...e){let r=b(...e);return at(Math.atan2(this.y-r.y,this.x-r.x))}static toAngle(e){return Math.atan2(e.y,e.x)}angleBetween(...e){let r=b(...e);return at(Math.atan2(this.cross(r),this.dot(r)))}static angleBetween(e,r){return Math.atan2(t.cross(e,r),t.dot(e,r))}lerp(e,r){return new t(Oe(this.x,e.x,r),Oe(this.y,e.y,r))}static lerp(e,r,n,o){return o.x=e.x*(r.x-e.x)*n,o.y=e.y*(r.y-e.y)*n,o}slerp(e,r){let n=this.dot(e),o=this.cross(e),s=Math.atan2(o,n);return this.scale(Math.sin((1-r)*s)).add(e.scale(Math.sin(r*s))).scale(1/o)}static slerp(e,r,n,o){let s=t.dot(e,r),a=t.cross(e,r),c=Math.atan2(a,s),u=Math.sin((1-n)*c),m=Math.sin(n*c),l=1/a;return o.x=(e.x*u+r.x*m)*l,o.y=(e.y*u+r.y*m)*l,o}isZero(){return this.x===0&&this.y===0}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new te(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}};function b(...t){if(t.length===1){if(t[0]instanceof O)return new O(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new O(...t[0])}return new O(...t)}i(b,"vec2");var X=class t{static{i(this,"Quad")}x=0;y=0;w=1;h=1;constructor(e,r,n,o){this.x=e,this.y=r,this.w=n,this.h=o}scale(e){return new t(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new O(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function de(t,e,r,n){return new X(t,e,r,n)}i(de,"quad");var xt=class t{static{i(this,"Mat2")}a;b;c;d;constructor(e,r,n,o){this.a=e,this.b=r,this.c=n,this.d=o}mul(e){return new t(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return b(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new t(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new t(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,r=this.det,n=e+Math.sqrt(e*e-r),o=e-Math.sqrt(e*e-r);return[n,o]}eigenvectors(e,r){return this.c!=0?[[e-this.d,this.c],[r-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,r-this.a]]:Math.abs(this.transform(b(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let r=Math.cos(e),n=Math.sin(e);return new t(r,n,-n,r)}static scale(e,r){return new t(e,0,0,r)}},De=class t{static{i(this,"Mat23")}a;b;c;d;e;f;constructor(e=1,r=0,n=0,o=1,s=0,a=0){this.a=e,this.b=r,this.c=n,this.d=o,this.e=s,this.f=a}static fromMat2(e){return new t(e.a,e.b,e.c,e.d,0,0)}toMat2(){return new xt(this.a,this.b,this.c,this.d)}static fromTranslation(e){return new t(1,0,0,1,e.x,e.y)}static fromRotation(e){let r=Math.cos(e),n=Math.sin(e);return new t(r,n,-n,r,0,0)}static fromScale(e){return new t(e.x,0,0,e.y,0,0)}clone(){return new t(this.a,this.b,this.c,this.d,this.e,this.f)}setMat23(e){this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f}setIdentity(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}mul(e){return new t(e.a*this.a+e.b*this.c,e.a*this.b+e.b*this.d,e.c*this.a+e.d*this.c,e.c*this.b+e.d*this.d,e.e*this.a+e.f*this.c+this.e,e.e*this.b+e.f*this.d+this.f)}translateSelfV(e){return this.e+=e.x*this.a+e.y*this.c,this.f+=e.x*this.b+e.y*this.d,this}translateSelf(e,r){return this.e+=e*this.a+r*this.c,this.f+=e*this.b+r*this.d,this}rotateSelf(e){let r=ae(e),n=Math.cos(r),o=Math.sin(r),s=this.a,a=this.b;return this.a=n*this.a+o*this.c,this.b=n*this.b+o*this.d,this.c=n*this.c-o*s,this.d=n*this.d-o*a,this}scaleSelfV(e){return this.a*=e.x,this.b*=e.x,this.c*=e.y,this.d*=e.y,this}scaleSelf(e,r){return this.a*=e,this.b*=e,this.c*=r,this.d*=r,this}mulSelf(e){let r=e.a*this.a+e.b*this.c,n=e.a*this.b+e.b*this.d,o=e.c*this.a+e.d*this.c,s=e.c*this.b+e.d*this.d,a=e.e*this.a+e.f*this.c+this.e,c=e.e*this.b+e.f*this.d+this.f;this.a=r,this.b=n,this.c=o,this.d=s,this.e=a,this.f=c}transform(e){return b(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}transformPoint(e,r){let n=e.x;return r.x=this.a*e.x+this.c*e.y+this.e,r.y=this.b*n+this.d*e.y+this.f,r}transformVector(e,r){let n=e.x;return r.x=this.a*e.x+this.c*e.y,r.y=this.b*n+this.d*e.y,r}get det(){return this.a*this.d-this.b*this.c}get inverse(){let e=this.det;return new t(this.d/e,-this.b/e,-this.c/e,this.a/e,(this.c*this.f-this.d*this.e)/e,(this.b*this.e-this.a*this.f)/e)}getTranslation(){return new O(this.e,this.f)}getRotation(){return at(Math.atan2(-this.c,this.a))}getScale(){return new O(Math.sqrt(this.a*this.a+this.c*this.c),Math.sqrt(this.b*this.b+this.d*this.d))}},yt=class t{static{i(this,"Mat3")}m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,r,n,o,s,a,c,u,m){this.m11=e,this.m12=r,this.m13=n,this.m21=o,this.m22=s,this.m23=a,this.m31=c,this.m32=u,this.m33=m}static fromMat2(e){return new t(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new xt(this.m11,this.m12,this.m21,this.m22)}mul(e){return new t(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let r=Math.cos(e),n=Math.sin(e),o=this.m11,s=this.m12;return this.m11=r*this.m11+n*this.m21,this.m12=r*this.m12+n*this.m22,this.m21=r*this.m21-n*o,this.m22=r*this.m22-n*s,this}scale(e,r){return this.m11*=e,this.m12*=e,this.m21*=r,this.m22*=r,this}get inverse(){let e=this.det;return new t((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new t(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},Ft=class t{static{i(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new t([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new t([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=ae(-e);let r=Math.cos(e),n=Math.sin(e);return new t([1,0,0,0,0,r,-n,0,0,n,r,0,0,0,0,1])}static rotateY(e){e=ae(-e);let r=Math.cos(e),n=Math.sin(e);return new t([r,0,n,0,0,1,0,0,-n,0,r,0,0,0,0,1])}static rotateZ(e){e=ae(-e);let r=Math.cos(e),n=Math.sin(e);return new t([r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=ae(-e);let r=Math.cos(e),n=Math.sin(e),o=this.m[0],s=this.m[1],a=this.m[4],c=this.m[5];return this.m[0]=o*r+s*n,this.m[1]=-o*n+s*r,this.m[4]=a*r+c*n,this.m[5]=-a*n+c*r,this}mult(e){let r=[];for(let n=0;n<4;n++)for(let o=0;o<4;o++)r[n*4+o]=this.m[0*4+o]*e.m[n*4+0]+this.m[1*4+o]*e.m[n*4+1]+this.m[2*4+o]*e.m[n*4+2]+this.m[3*4+o]*e.m[n*4+3];return new t(r)}multVec2(e){return new O(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new O(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new O(r,e/r)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new O(e/r,r)}else return new O(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return at(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return at(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new O(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new O(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new O(0,0)}invert(){let e=[],r=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],o=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],a=this.m[8]*this.m[14]-this.m[12]*this.m[10],c=this.m[8]*this.m[13]-this.m[12]*this.m[9],u=this.m[6]*this.m[15]-this.m[14]*this.m[7],m=this.m[5]*this.m[15]-this.m[13]*this.m[7],l=this.m[5]*this.m[14]-this.m[13]*this.m[6],p=this.m[4]*this.m[15]-this.m[12]*this.m[7],f=this.m[4]*this.m[14]-this.m[12]*this.m[6],C=this.m[5]*this.m[15]-this.m[13]*this.m[7],v=this.m[4]*this.m[13]-this.m[12]*this.m[5],g=this.m[6]*this.m[11]-this.m[10]*this.m[7],x=this.m[5]*this.m[11]-this.m[9]*this.m[7],y=this.m[5]*this.m[10]-this.m[9]*this.m[6],G=this.m[4]*this.m[11]-this.m[8]*this.m[7],B=this.m[4]*this.m[10]-this.m[8]*this.m[6],D=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*r-this.m[6]*n+this.m[7]*o,e[4]=-(this.m[4]*r-this.m[6]*s+this.m[7]*a),e[8]=this.m[4]*n-this.m[5]*s+this.m[7]*c,e[12]=-(this.m[4]*o-this.m[5]*a+this.m[6]*c),e[1]=-(this.m[1]*r-this.m[2]*n+this.m[3]*o),e[5]=this.m[0]*r-this.m[2]*s+this.m[3]*a,e[9]=-(this.m[0]*n-this.m[1]*s+this.m[3]*c),e[13]=this.m[0]*o-this.m[1]*a+this.m[2]*c,e[2]=this.m[1]*u-this.m[2]*m+this.m[3]*l,e[6]=-(this.m[0]*u-this.m[2]*p+this.m[3]*f),e[10]=this.m[0]*C-this.m[1]*p+this.m[3]*v,e[14]=-(this.m[0]*l-this.m[1]*f+this.m[2]*v),e[3]=-(this.m[1]*g-this.m[2]*x+this.m[3]*y),e[7]=this.m[0]*g-this.m[2]*G+this.m[3]*B,e[11]=-(this.m[0]*x-this.m[1]*G+this.m[3]*D),e[15]=this.m[0]*y-this.m[1]*B+this.m[2]*D;let U=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let h=0;h<4;h++)for(let A=0;A<4;A++)e[h*4+A]*=1/U;return new t(e)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function Er(t,e,r,n=o=>-Math.cos(o)){return t+(n(r)+1)/2*(e-t)}i(Er,"wave");var gu=1103515245,bu=12345,bo=2147483648,Jt=class{static{i(this,"RNG")}seed;constructor(e){this.seed=e}gen(){return this.seed=(gu*this.seed+bu)%bo,this.seed/bo}genNumber(e,r){return e+this.gen()*(r-e)}genVec2(e,r){return new O(this.genNumber(e.x,r.x),this.genNumber(e.y,r.y))}genColor(e,r){return new _(this.genNumber(e.r,r.r),this.genNumber(e.g,r.g),this.genNumber(e.b,r.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof O)return this.genVec2(b(0,0),e[0]);if(e[0]instanceof _)return this.genColor(W(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof O&&e[1]instanceof O)return this.genVec2(e[0],e[1]);if(e[0]instanceof _&&e[1]instanceof _)return this.genColor(e[0],e[1])}throw new Error("More than 2 arguments not supported")}},dn=new Jt(Date.now());function xo(t){return t!=null&&(dn.seed=t),dn.seed}i(xo,"randSeed");function be(...t){return dn.genAny(...t)}i(be,"rand");function fn(...t){return Math.floor(be(...t))}i(fn,"randi");function vo(t){return be()<=t}i(vo,"chance");function hn(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}i(hn,"shuffle");function Co(t,e){return t.length<=e?t.slice():hn(t.slice()).slice(0,e)}i(Co,"chooseMultiple");function wo(t){return t[fn(t.length)]}i(wo,"choose");function gn(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}i(gn,"testRectRect");function yu(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let r=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(r===0)return null;let n=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/r,o=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/r;return n<0||n>1||o<0||o>1?null:n}i(yu,"testLineLineT");function Or(t,e){let r=yu(t,e);return r?b(t.p1.x+r*(t.p2.x-t.p1.x),t.p1.y+r*(t.p2.y-t.p1.y)):null}i(Or,"testLineLine");function Sr(t,e){let r=e.p2.sub(e.p1),n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;if(r.x!=0){let s=(t.pos.x-e.p1.x)/r.x,a=(t.pos.x+t.width-e.p1.x)/r.x;n=Math.max(n,Math.min(s,a)),o=Math.min(o,Math.max(s,a))}if(r.y!=0){let s=(t.pos.y-e.p1.y)/r.y,a=(t.pos.y+t.height-e.p1.y)/r.y;n=Math.max(n,Math.min(s,a)),o=Math.min(o,Math.max(s,a))}return o>=n&&o>=0&&n<=1}i(Sr,"testRectLine");function Tr(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}i(Tr,"testRectPoint");function Eo(t,e){let r=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),n=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return b(r,n).sdist(e.center)<=e.radius*e.radius}i(Eo,"testRectCircle");function Oo(t,e){return So(e,new pe(t.points()))}i(Oo,"testRectPolygon");function Ar(t,e){let r=e.sub(t.p1),n=t.p2.sub(t.p1);if(Math.abs(r.cross(n))>Number.EPSILON)return!1;let o=r.dot(n)/n.dot(n);return o>=0&&o<=1}i(Ar,"testLinePoint");function Lt(t,e){let r=t.p2.sub(t.p1),n=r.dot(r),o=t.p1.sub(e.center),s=2*r.dot(o),a=o.dot(o)-e.radius*e.radius,c=s*s-4*n*a;if(n<=Number.EPSILON||c<0)return!1;if(c==0){let u=-s/(2*n);if(u>=0&&u<=1)return!0}else{let u=(-s+Math.sqrt(c))/(2*n),m=(-s-Math.sqrt(c))/(2*n);if(u>=0&&u<=1||m>=0&&m<=1)return!0}return Vr(e,t.p1)}i(Lt,"testLineCircle");function bn(t,e){if(vt(e,t.p1)||vt(e,t.p2))return!0;for(let r=0;r<e.pts.length;r++){let n=e.pts[r],o=e.pts[(r+1)%e.pts.length];if(Or(t,new Ve(n,o)))return!0}return!1}i(bn,"testLinePolygon");function Vr(t,e){return t.center.sdist(e)<t.radius*t.radius}i(Vr,"testCirclePoint");function xu(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}i(xu,"testCircleCircle");function Zt(t,e){let r=e.pts[e.pts.length-1];for(let n of e.pts){if(Lt(new Ve(r,n),t))return!0;r=n}return Vr(t,e.pts[0])?!0:vt(e,t.center)}i(Zt,"testCirclePolygon");function So(t,e){for(let r=0;r<t.pts.length;r++)if(bn(new Ve(t.pts[r],t.pts[(r+1)%t.pts.length]),e))return!0;return!!(t.pts.some(r=>vt(e,r))||e.pts.some(r=>vt(t,r)))}i(So,"testPolygonPolygon");function vt(t,e){let r=!1,n=t.pts;for(let o=0,s=n.length-1;o<n.length;s=o++)n[o].y>e.y!=n[s].y>e.y&&e.x<(n[s].x-n[o].x)*(e.y-n[o].y)/(n[s].y-n[o].y)+n[o].x&&(r=!r);return r}i(vt,"testPolygonPoint");function yn(t,e){e=e.sub(t.center);let r=ae(t.angle),n=Math.cos(r),o=Math.sin(r),s=e.x*n+e.y*o,a=-e.x*o+e.y*n;return s*s/(t.radiusX*t.radiusX)+a*a/(t.radiusY*t.radiusY)<1}i(yn,"testEllipsePoint");function Cr(t,e){let r=e.center.sub(t.center),n=ae(t.angle),o=Math.cos(n),s=Math.sin(n),a=r.x*o+r.y*s,c=-r.x*s+r.y*o;return yn(new Pe(b(),t.radiusX+e.radius,t.radiusY+e.radius,0),b(a,c))}i(Cr,"testEllipseCircle");function To(t,e){let r=t.toMat2().inverse;return e=new Ve(r.transform(e.p1.sub(t.center)),r.transform(e.p2.sub(t.center))),Lt(e,new xe(b(),1))}i(To,"testEllipseLine");function vu(t,e){if(t.radiusX===t.radiusY)return Cr(e,new xe(t.center,t.radiusX));if(e.radiusX===e.radiusY)return Cr(t,new xe(e.center,e.radiusX));let r=new yt(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),n=new yt(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),o=t.center.x,s=t.center.y,a=e.center.x,c=e.center.y,u=ae(t.angle),m=ae(e.angle),l=new yt(Math.cos(u),-Math.sin(u),o,Math.sin(u),Math.cos(u),s,0,0,1),p=new yt(Math.cos(m),-Math.sin(m),a,Math.sin(m),Math.cos(m),c,0,0,1),f=l.inverse,C=p.inverse,v=f.transpose.mul(r).mul(f),g=C.transpose.mul(n).mul(C),x=v.m11,y=v.m12,G=v.m13,B=v.m21,D=v.m22,U=v.m23,h=v.m31,A=v.m32,S=v.m33,P=g.m11,V=g.m12,j=g.m13,K=g.m21,$=g.m22,q=g.m23,Q=g.m31,z=g.m32,Y=g.m33,re=x*D*S-x*U*A-y*B*S+y*U*h+G*B*A-G*D*h,J=(x*D*Y-x*U*z-x*A*q+x*S*$-y*B*Y+y*U*Q+y*h*q-y*S*K+G*B*z-G*D*Q-G*h*$+G*A*K+B*A*j-B*S*V-D*h*j+D*S*P+U*h*V-U*A*P)/re,ie=(x*$*Y-x*q*z-y*K*Y+y*q*Q+G*K*z-G*$*Q-B*V*Y+B*j*z+D*P*Y-D*j*Q-U*P*z+U*V*Q+h*V*q-h*j*$-A*P*q+A*j*K+S*P*$-S*V*K)/re,ce=(P*$*Y-P*q*z-V*K*Y+V*q*Q+j*K*z-j*$*Q)/re;if(J>=0){let H=-3*ie+J**2,L=3*J*ce+ie*J**2-4*ie**2,N=-27*ce**2+18*ce*J*ie+J**2*ie**2-4*J**3*ce-4*ie**3;return!(H>0&&L<0&&N>0)}else{let H=-3*ie+J**2,L=-27*ce**2+18*ce*J*ie+J**2*ie**2-4*J**3*ce-4*ie**3;return!(H>0&&L>0)}}i(vu,"testEllipseEllipse");function Ao(t,e){return xn(t,new pe(e.points()))}i(Ao,"testEllipseRect");function xn(t,e){let r=t.toMat2().inverse;return e=new pe(e.pts.map(n=>r.transform(n.sub(t.center)))),Zt(new xe(b(),1),e)}i(xn,"testEllipsePolygon");function Cu(t,e){return t.x===e.x&&t.y===e.y}i(Cu,"testPointPoint");function wu(t,e){return e instanceof O?Cu(e,t.pt):e instanceof xe?Vr(e,t.pt):e instanceof Ve?Ar(e,t.pt):e instanceof te?Tr(e,t.pt):e instanceof pe?vt(e,t.pt):e instanceof Pe?yn(e,t.pt):!1}i(wu,"testPointShape");function Eu(t,e){return e instanceof O?Ar(t,e):e instanceof xe?Lt(t,e):e instanceof Ve?Or(t,e)!=null:e instanceof te?Sr(e,t):e instanceof pe?bn(t,e):e instanceof Pe?To(e,t):!1}i(Eu,"testLineShape");function Ou(t,e){return e instanceof O?Vr(t,e):e instanceof xe?xu(t,e):e instanceof Ve?Lt(e,t):e instanceof te?Eo(e,t):e instanceof pe?Zt(t,e):e instanceof Pe?Cr(e,t):!1}i(Ou,"testCircleShape");function Su(t,e){return e instanceof O?Tr(t,e):e instanceof xe?Eo(t,e):e instanceof Ve?Sr(t,e):e instanceof te?gn(t,e):e instanceof pe?Oo(t,e):e instanceof Pe?Ao(e,t):!1}i(Su,"testRectShape");function Tu(t,e){return e instanceof O?vt(t,e):e instanceof xe?Zt(e,t):e instanceof Ve?bn(e,t):e instanceof te?Oo(e,t):e instanceof pe?So(e,t):e instanceof Pe?xn(e,t):!1}i(Tu,"testPolygonShape");function Au(t,e){return e instanceof O?yn(t,e):e instanceof xe?Cr(t,e):e instanceof Ve?To(t,e):e instanceof te?Ao(t,e):e instanceof pe?xn(t,e):e instanceof Pe?vu(e,t):!1}i(Au,"testEllipseShape");function Vo(t,e,r){let n=t,o=r.p1,s=r.p2,a=e,c=s.sub(o),u=a.cross(c);if(Math.abs(u)<Number.EPSILON)return null;let m=o.sub(n),l=m.cross(c)/u;if(l<=0||l>=1)return null;let p=m.cross(a)/u;if(p<=0||p>=1)return null;let f=c.normal().unit();return e.dot(f)>0&&(f.x*=-1,f.y*=-1),{point:n.add(a.scale(l)),normal:f,fraction:l}}i(Vo,"raycastLine");function Vu(t,e,r){let n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,s;if(t.x!=0){let a=(r.pos.x-t.x)/e.x,c=(r.pos.x+r.width-t.x)/e.x;s=b(-Math.sign(e.x),0),n=Math.max(n,Math.min(a,c)),o=Math.min(o,Math.max(a,c))}if(t.y!=0){let a=(r.pos.y-t.y)/e.y,c=(r.pos.y+r.height-t.y)/e.y;Math.min(a,c)>n&&(s=b(0,-Math.sign(e.y))),n=Math.max(n,Math.min(a,c)),o=Math.min(o,Math.max(a,c))}return o>=n&&n>=0&&n<=1?{point:t.add(e.scale(n)),normal:s,fraction:n}:null}i(Vu,"raycastRect");function Po(t,e,r){let n=t,o=r.center,s=e,a=s.dot(s),c=n.sub(o),u=2*s.dot(c),m=c.dot(c)-r.radius*r.radius,l=u*u-4*a*m;if(a<=Number.EPSILON||l<0)return null;if(l==0){let p=-u/(2*a);if(p>=0&&p<=1){let f=n.add(s.scale(p));return{point:f,normal:f.sub(o),fraction:p}}}else{let p=(-u+Math.sqrt(l))/(2*a),f=(-u-Math.sqrt(l))/(2*a),C=null;if(p>=0&&p<=1&&(C=p),f>=0&&f<=1&&(C=Math.min(f,C??f)),C!=null){let v=n.add(s.scale(C));return{point:v,normal:v.sub(o).unit(),fraction:C}}}return null}i(Po,"raycastCircle");function Pu(t,e,r){let n=r.pts,o=null,s=n[n.length-1];for(let a=0;a<n.length;a++){let c=n[a],u=Vo(t,e,new Ve(s,c));u&&(!o||o.fraction>u.fraction)&&(o=u),s=c}return o}i(Pu,"raycastPolygon");function Mu(t,e,r){let n=r.toMat2(),o=n.inverse,s=o.transform(t.sub(r.center)),a=o.transform(e),c=Po(s,a,new xe(b(),1));if(c){let u=xt.rotation(ae(-r.angle)),l=xt.scale(r.radiusX,r.radiusY).transform(c.point),p=n.transform(c.point).add(r.center),f=p.dist(t)/e.len();return{point:p,normal:u.transform(b(r.radiusY**2*l.x,r.radiusX**2*l.y)).unit(),fraction:f}}return c}i(Mu,"raycastEllipse");function Mo(t,e,r,n=64){let o=t,s=e.len(),a=e.scale(1/s),c=0,u=b(Math.floor(t.x),Math.floor(t.y)),m=b(a.x>0?1:-1,a.y>0?1:-1),l=b(Math.abs(1/a.x),Math.abs(1/a.y)),p=b(m.x>0?u.x+1-t.x:t.x-u.x,m.y>0?u.y+1-t.y:t.y-u.y),f=b(l.x<1/0?l.x*p.x:1/0,l.y<1/0?l.y*p.y:1/0),C=-1;for(;c<=n;){let v=r(u);if(v===!0)return{point:o.add(a.scale(c)),normal:b(C===0?-m.x:0,C===1?-m.y:0),fraction:c/s,gridPos:u};if(v)return v;f.x<f.y?(u.x+=m.x,c=f.x,f.x+=l.x,C=0):(u.y+=m.y,c=f.y,f.y+=l.y,C=1)}return null}i(Mo,"raycastGrid");var wr=class t{static{i(this,"Point")}pt;constructor(e){this.pt=e.clone()}transform(e){return new t(e.transformPoint(this.pt,b()))}bbox(){return new te(this.pt,0,0)}area(){return 0}clone(){return new t(this.pt)}collides(e){return wu(this,e)}contains(e){return this.pt.eq(e)}raycast(e,r){return null}random(){return this.pt.clone()}},Ve=class t{static{i(this,"Line")}p1;p2;constructor(e,r){this.p1=e.clone(),this.p2=r.clone()}transform(e){return new t(e.transformPoint(this.p1,b()),e.transformPoint(this.p2,b()))}bbox(){return te.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}collides(e){return Eu(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Vo(e,r,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(be(1)))}},te=class t{static{i(this,"Rect")}pos;width;height;constructor(e,r,n){this.pos=e.clone(),this.width=r,this.height=n}static fromPoints(e,r){return new t(e.clone(),r.x-e.x,r.y-e.y)}center(){return new O(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new pe(this.points().map(r=>e.transformPoint(r,b())))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let r=this.pos,n=this.pos.add(this.width,this.height),o=Math.max(r.x-e.x,0,e.x-n.x),s=Math.max(r.y-e.y,0,e.y-n.y);return o*o+s*s}collides(e){return Su(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Vu(e,r,this)}random(){return this.pos.add(be(this.width),be(this.height))}},xe=class t{static{i(this,"Circle")}center;radius;constructor(e,r){this.center=e.clone(),this.radius=r}transform(e){return new Pe(this.center,this.radius,this.radius).transform(e)}bbox(){return te.fromPoints(this.center.sub(b(this.radius)),this.center.add(b(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}collides(e){return Ou(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Po(e,r,this)}random(){return this.center.add(O.fromAngle(be(360)).scale(be(this.radius)))}},Pe=class t{static{i(this,"Ellipse")}center;radiusX;radiusY;angle;constructor(e,r,n,o=0){this.center=e.clone(),this.radiusX=r,this.radiusY=n,this.angle=o}static fromMat2(e){let r=e.inverse,n=r.transpose.mul(r),[o,s]=n.eigenvalues,[a,c]=n.eigenvectors(o,s),[u,m]=[1/Math.sqrt(o),1/Math.sqrt(s)];return u>m?new t(b(),u,m,at(Math.atan2(-a[1],a[0]))):new t(b(),m,u,at(Math.atan2(-c[1],c[0])))}toMat2(){let e=ae(this.angle),r=Math.cos(e),n=Math.sin(e);return new xt(r*this.radiusX,-n*this.radiusY,n*this.radiusX,r*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new t(e.transformPoint(this.center,b()),e.a*this.radiusX,e.d*this.radiusY);{let r=this.toMat2(),n=e.getRotation(),o=e.getScale();r=yt.fromMat2(r).scale(o.x,o.y).rotate(n).toMat2();let a=t.fromMat2(r);return a.center=e.transformPoint(this.center,b()),a}}bbox(){if(this.angle==0)return te.fromPoints(this.center.sub(b(this.radiusX,this.radiusY)),this.center.add(b(this.radiusX,this.radiusY)));{let e=ae(this.angle),r=Math.cos(e),n=Math.sin(e),o=this.radiusX*r,s=this.radiusX*n,a=this.radiusY*n,c=this.radiusY*r,u=Math.sqrt(o*o+a*a),m=Math.sqrt(s*s+c*c);return te.fromPoints(this.center.sub(b(u,m)),this.center.add(b(u,m)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return Au(this,e)}contains(e){e=e.sub(this.center);let r=ae(this.angle),n=Math.cos(r),o=Math.sin(r),s=e.x*n+e.y*o,a=-e.x*o+e.y*n;return s*s/(this.radiusX*this.radiusX)+a*a/(this.radiusY*this.radiusY)<1}raycast(e,r){return Mu(e,r,this)}random(){return this.center}};function Gu(t,e,r,n){let o=e.sub(t),s=n.sub(r),a=o.cross(s);return a<1e-5&&a>-1e-5||(a=r.sub(t).cross(s)/a,a<0||a>1)?null:t.add(o.scale(a))}i(Gu,"segmentLineIntersection");var pe=class t{static{i(this,"Polygon")}pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new t(this.pts.map(r=>e.transformPoint(r,b())))}bbox(){let e=b(Number.MAX_VALUE),r=b(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),r.x=Math.max(r.x,n.x),e.y=Math.min(e.y,n.y),r.y=Math.max(r.y,n.y);return te.fromPoints(e,r)}area(){let e=0,r=this.pts.length;for(let n=0;n<r;n++){let o=this.pts[n],s=this.pts[(n+1)%r];e+=o.x*s.y*.5,e-=s.x*o.y*.5}return Math.abs(e)}clone(){return new t(this.pts.map(e=>e.clone()))}collides(e){return Tu(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Pu(e,r,this)}random(){return b()}cut(e,r){let n=new Ve(e,r),o=[],s=[],a=r.sub(e),c=this.pts[this.pts.length-1],u=c.sub(e),m=a.cross(u)>0;return this.pts.forEach(l=>{u=l.sub(e);let p=a.cross(u)>0;if(m!=p){let f=Gu(c,l,e,r);o.push(f),s.push(f),m=p}(p?o:s).push(l),c=l}),[o.length?new t(o):null,s.length?new t(s):null]}};function Go(t,e,r,n){let o=n*n,s=1-n,a=s*s;return t.scale(a).add(e.scale(2*s*n)).add(r.scale(o))}i(Go,"evaluateQuadratic");function Ro(t,e,r,n){let o=1-n;return e.sub(t).scale(2*o).add(r.sub(e).scale(2*n))}i(Ro,"evaluateQuadraticFirstDerivative");function Do(t,e,r,n){return r.sub(e.scale(2)).add(t).scale(2)}i(Do,"evaluateQuadraticSecondDerivative");function er(t,e,r,n,o){let s=o*o,a=s*o,c=1-o,u=c*c,m=u*c;return t.scale(m).add(e.scale(3*u*o)).add(r.scale(3*c*s)).add(n.scale(a))}i(er,"evaluateBezier");function Bo(t,e,r,n,o){let s=o*o,a=1-o,c=a*a;return e.sub(t).scale(3*c).add(r.sub(e).scale(6*a*o)).add(n.sub(r).scale(3*s))}i(Bo,"evaluateBezierFirstDerivative");function Uo(t,e,r,n,o){let s=1-o;return r.sub(e.scale(2)).add(t).scale(6*s).add(n.sub(r.scale(2)).add(e).scale(6*o))}i(Uo,"evaluateBezierSecondDerivative");function Fo(t,e,r,n,o){let s=.5*(((-o+2)*o-1)*o),a=.5*((3*o-5)*o*o+2),c=.5*(((-3*o+4)*o+1)*o),u=.5*((o-1)*o*o);return t.scale(s).add(e.scale(a)).add(r.scale(c)).add(n.scale(u))}i(Fo,"evaluateCatmullRom");function Lo(t,e,r,n,o){let s=.5*((-3*o+4)*o-1),a=.5*((9*o-10)*o),c=.5*((-9*o+8)*o+1),u=.5*((3*o-2)*o);return t.scale(s).add(e.scale(a)).add(r.scale(c)).add(n.scale(u))}i(Lo,"evaluateCatmullRomFirstDerivative");function Io(t){let e=vn(t),r=e(1);return n=>{let o=n*r,s=e(o,!0);return t(s)}}i(Io,"normalizedCurve");function vn(t,e=10,r=10){let n=[0],o=[0],a=1/(e-1)/r,c=0,u=t(0),m=0;for(let l=1;l<e;l++){for(let p=0;p<r;p++){m+=a;let f=t(m),C=f.dist(u);c+=C,u=f}n[l]=c,o[l]=m}return o[e-1]=1,(l,p=!1)=>{if(p){let f=l;if(f<=0)return 0;if(f>=c)return 1;let C=0;for(;n[C+1]<f;)C++;let v=o[C],g=o[C+1],x=n[C],y=n[C+1],G=(f-x)/(y-x);return v+(g-v)*G}else{if(l<=0)return 0;if(l>=1)return n[e-1];let f=0;for(;o[f+1]<l;)f++;let C=o[f],v=o[f+1],g=n[f],x=n[f+1],y=(l-C)/(v-C);return g+(x-g)*y}}}i(vn,"curveLengthApproximation");function It(t,e,r,n){let o=2*t+e-2*n+r,s=-3*t+3*n-2*e-r,a=e,c=t;return u=>{let m=u*u,l=m*u;return o*l+s*m+a*u+c}}i(It,"hermite");function Cn(t,e,r,n,o,s=It){let a=s(e.x,(1-o)*(r.x-t.x),(1-o)*(n.x-e.x),r.x),c=s(e.y,(1-o)*(r.y-t.y),(1-o)*(n.y-e.y),r.y);return u=>new O(a(u),c(u))}i(Cn,"cardinal");function jt(t,e,r,n,o=It){return Cn(t,e,r,n,.5,o)}i(jt,"catmullRom");function jo(t,e,r,n,o=It){return jt(n.add(t.sub(e).scale(6)),t,n,t.add(n.sub(r).scale(6)),o)}i(jo,"bezier");function Ko(t,e,r,n,o,s,a,c=It){let u=c(e.x,.5*(1-o)*(1+a)*(1+s)*(e.x-t.x)+.5*(1-o)*(1-a)*(1-s)*(r.x-e.x),.5*(1-o)*(1+a)*(1-s)*(r.x-e.x)+.5*(1-o)*(1-a)*(1+s)*(n.x-r.x),r.x),m=c(e.y,.5*(1-o)*(1+a)*(1+s)*(e.y-t.y)+.5*(1-o)*(1-a)*(1-s)*(r.y-e.y),.5*(1-o)*(1+a)*(1-s)*(r.y-e.y)+.5*(1-o)*(1-a)*(1+s)*(n.y-r.y),r.y);return l=>new O(u(l),m(l))}i(Ko,"kochanekBartels");function ko(t,e,r,n){let o=2*t+e-2*n+r,s=-3*t+3*n-2*e+r,a=e;return c=>{let u=c*c;return 3*o*u+2*s*c+a}}i(ko,"hermiteFirstDerivative");function Xt(t){return 0<=t&&t<=1}i(Xt,"inZeroOneDomain");function mn(t,e){return Math.abs(t-e)<=Number.EPSILON}i(mn,"approximately");function Qt(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}i(Qt,"cubeRoot");function Ru(t,e,r,n){let o=3*t-6*e+3*r,s=-3*t+3*e,a=t,c=-t+3*e-3*r+n;if(mn(c,0)){if(mn(o,0))return mn(s,0)?[]:[-a/s].filter(Xt);let y=Math.sqrt(s*s-4*o*a),G=2*o;return[(y-s)/G,(-s-y)/G].filter(Xt)}o/=c,s/=c,a/=c;let u=(3*s-o*o)/3,m=u/3,l=(2*o*o*o-9*o*s+27*a)/27,p=l/2,f=p*p+m*m*m;if(f<0){let y=-u/3,G=y*y*y,B=Math.sqrt(G),D=-l/(2*B),U=D<-1?-1:D>1?1:D,h=Math.acos(U),S=2*Qt(B),P=S*Math.cos(h/3)-o/3,V=S*Math.cos((h+2*Math.PI)/3)-o/3,j=S*Math.cos((h+4*Math.PI)/3)-o/3;return[P,V,j].filter(Xt)}if(f===0){let y=p<0?Qt(-p):-Qt(p),G=2*y-o/3,B=-y-o/3;return[G,B].filter(Xt)}let C=Math.sqrt(f),v=Qt(C-p),g=Qt(C+p);return[v-g-o/3].filter(Xt)}i(Ru,"getCubicRoots");function Du(t,e,r,n,o){let s=Ru(t.x-o,e.x-o,r.x-o,n.x-o);return s.length>0?er(t,e,r,n,s[0]).y:NaN}i(Du,"cubicBezierYforX");function No(t){if(!t||t.length==0)throw new Error("Need at least one point for easingLinear.");let e=t.length;return r=>{if(r<=0||t.length==1||r<=t[0].x)return t[0].y;for(let n=0;n<e;n++)if(t[n].x>=r)return Le(r,t[n-1].x,t[n].x,t[n-1].y,t[n].y);return t[t.length-1].y}}i(No,"easingLinear");function _o(t,e){return r=>Du(b(0,0),t,e,b(1,1),r)}i(_o,"easingCubicBezier");function Ho(t,e="jump-end"){let r=1/t,n=e=="jump-start"||e=="jump-both",o=e=="jump-end"||e=="jump-both",s=1/(t+(o?1:0)),a=n?s:0;return c=>{let u=Math.floor(c/r);return a+u*s}}i(Ho,"easingSteps");function qo(t,e,r){return(e.x-t.x)*(r.y-t.y)-(e.y-t.y)*(r.x-t.x)>=0}i(qo,"isOrientedCcw");function Bu(t){let e=0,r=t[t.length-1];for(let n=0;n<t.length;n++)e+=(t[n].x-r.x)*(t[n].y+r.y),r=t[n];return e<0}i(Bu,"isOrientedCcwPolygon");function pn(t,e,r,n){let o=n.x-r.x,s=n.y-r.y,a=o*(t.y-r.y)-s*(t.x-r.x),c=o*(e.y-r.y)-s*(e.x-r.x);return a*c>=0}i(pn,"onSameSide");function Uu(t,e,r,n){return pn(t,e,r,n)&&pn(t,r,e,n)&&pn(t,n,e,r)}i(Uu,"pointInTriangle");function Fu(t,e,r,n){for(let o of t)if(o!==e&&o!==r&&o!==n&&Uu(o,e,r,n))return!0;return!1}i(Fu,"someInTriangle");function Lu(t,e,r,n){return qo(t,e,r)&&!Fu(n,t,e,r)}i(Lu,"isEar");function Pr(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],r=[],n=0;for(let p=0;p<t.length;p++){let f=t[n],C=t[p];(C.x<f.x||C.x==f.x&&C.y<f.y)&&(n=n),e[p]=p+1,r[p]=p-1}e[e.length-1]=0,r[0]=r.length-1,Bu(t)||([e,r]=[r,e]);let o=[];for(let p=0;p<t.length;++p)qo(t[r[p]],t[p],t[e[p]])||o.push(t[p]);let s=[],a=t.length,c=1,u=0,m,l;for(;a>3;){m=e[c],l=r[c];let p=t[l],f=t[c],C=t[m];if(Lu(p,f,C,o))s.push([p,f,C]),e[l]=m,r[m]=l,o.splice(o.indexOf(f),1),--a,u=0;else if(++u>a)return[];c=m}return m=e[c],l=r[c],s.push([t[l],t[c],t[m]]),s}i(Pr,"triangulate");function zo(t){if(t.length<3)return!1;let e=t.length-2,r=t.length-1,n=0,o=t[r].sub(t[e]),s=t[n].sub(t[r]),a=o.cross(s);for(;n+1<t.length;)if(e=r,r=n,n++,o=t[r].sub(t[e]),s=t[n].sub(t[r]),o.cross(s)*a<0)return!1;return!0}i(zo,"isConvex");var Yo=i(t=>t[0]instanceof _,"arrayIsColor"),Wo=i(t=>t[0]instanceof O,"arrayIsVec2"),$o=i(t=>typeof t[0]=="number","arrayIsNumber");var Kt=class{static{i(this,"BinaryHeap")}_items;_compareFn;constructor(e=(r,n)=>r<n){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],r=this._items.pop();return this._items.length!==0&&(this._items[0]=r,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let r=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[r])&&this._items[e]>=this._items[r])break;this.swap(e,r),e=r}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let r=2*e+1;if(r<this._items.length-1&&!this._compareFn(this._items[r],this._items[r+1])&&++r,this._compareFn(this._items[e],this._items[r]))break;this.swap(e,r),e=r}}swap(e,r){[this._items[e],this._items[r]]=[this._items[r],this._items[e]]}get length(){return this._items.length}};function Iu(t){let e=window.atob(t),r=e.length,n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=e.charCodeAt(o);return n.buffer}i(Iu,"base64ToArrayBuffer");function Xo(t){return Iu(t.split(",")[1])}i(Xo,"dataURLToArrayBuffer");function Mr(t,e){let r=document.createElement("a");r.href=e,r.download=t,r.click()}i(Mr,"download");function wn(t,e){Mr(t,"data:text/plain;charset=utf-8,"+e)}i(wn,"downloadText");function Qo(t,e){wn(t,JSON.stringify(e))}i(Qo,"downloadJSON");function En(t,e){let r=URL.createObjectURL(e);Mr(t,r),URL.revokeObjectURL(r)}i(En,"downloadBlob");var Gr=i(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL");var Jo=i(t=>t.split(".").slice(0,-1).join("."),"getFileName");function Rr(t,e){if(t===e)return!0;let r=typeof t,n=typeof e;if(r!==n)return!1;if(r==="object"&&n==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let o=Object.keys(t),s=Object.keys(e);if(o.length!==s.length)return!1;for(let a of o){let c=t[a],u=e[a];if(!Rr(c,u))return!1}return!0}return!1}i(Rr,"deepEq");var tr=class extends Map{static{i(this,"Registry")}lastID=0;push(e){let r=this.lastID;return this.set(r,e),this.lastID++,r}pushd(e){let r=this.push(e);return()=>this.delete(r)}},He=class t{static{i(this,"KEventController")}paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let r=new t(()=>e.forEach(n=>n.cancel()));return Object.defineProperty(r,"paused",{get:i(()=>e[0].paused,"get"),set:i(n=>e.forEach(o=>o.paused=n),"set")}),r.paused=!1,r}static replace(e,r){return e.cancel=()=>r.cancel(),r.paused=e.paused,Object.defineProperty(e,"paused",{get:i(()=>r.paused,"get"),set:i(n=>r.paused=n,"set")}),e}},me=class{static{i(this,"KEvent")}handlers=new tr;add(e){let r=this.handlers.pushd((...o)=>{n.paused||e(...o)}),n=new He(r);return n}addOnce(e){let r=this.add((...n)=>{r.cancel(),e(...n)});return r}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(r=>r(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},Je=class{static{i(this,"KEventHandler")}handlers={};registers={};on(e,r){return this.handlers[e]||(this.handlers[e]=new me),this.handlers[e].add(r)}onOnce(e,r){let n=this.on(e,(...o)=>{n.cancel(),r(...o)});return n}next(e){return new Promise(r=>{this.onOnce(e,(...n)=>r(n[0]))})}trigger(e,...r){this.handlers[e]&&this.handlers[e].trigger(...r)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};var Zo=i(t=>t instanceof Error?t.message:String(t),"getErrorMessage");function rr(t,e){return Number(t.toFixed(e))}i(rr,"toFixed");function fe(t,e){return(...r)=>{let n=r.length;if(n===t.length)return t(...r);if(n===e.length)return e(...r)}}i(fe,"overload2");var ju=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function ti(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],r=0,n=0;for(;r<t.length;){if(n+=Ku(r+n,t),Yu(t[r+n])&&n++,Hu(t[r+n])&&n++,qu(t[r+n])&&n++,Wu(t[r+n])){n++;continue}e.push(t.substring(r,r+n)),r+=n,n=0}return e}i(ti,"runes");function Ku(t,e){let r=e[t];if(!ku(r)||t===e.length-1)return 1;let n=r+e[t+1],o=e.substring(t+2,t+5);return ei(n)&&ei(o)?4:Nu(n)&&zu(o)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:_u(o)?4:2}i(Ku,"nextUnits");function ku(t){return t&&Ct(t[0].charCodeAt(0),55296,56319)}i(ku,"isFirstOfSurrogatePair");function ei(t){return Ct(On(t),127462,127487)}i(ei,"isRegionalIndicator");function Nu(t){return Ct(On(t),127988,127988)}i(Nu,"isSubdivisionFlag");function _u(t){return Ct(On(t),127995,127999)}i(_u,"isFitzpatrickModifier");function Hu(t){return typeof t=="string"&&Ct(t.charCodeAt(0),65024,65039)}i(Hu,"isVariationSelector");function qu(t){return typeof t=="string"&&Ct(t.charCodeAt(0),8400,8447)}i(qu,"isDiacriticalMark");function zu(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&Ct(e,917504,917631)}i(zu,"isSupplementarySpecialpurposePlane");function Yu(t){return typeof t=="string"&&ju.includes(t.charCodeAt(0))}i(Yu,"isGrapheme");function Wu(t){return typeof t=="string"&&t.charCodeAt(0)===8205}i(Wu,"isZeroWidthJoiner");function On(t){let e=t.charCodeAt(0)-55296,r=t.charCodeAt(1)-56320;return(e<<10)+r+65536}i(On,"codePointFromSurrogatePair");function Ct(t,e,r){return t>=e&&t<=r}i(Ct,"betweenInclusive");var ke=i((t,e)=>Array.isArray(t)?t?.includes(e):t===e,"isEqOrIncludes"),Ze=i((t,e)=>Array.isArray(e)?e.some(r=>t.has(r)):t.has(e),"setHasOrIncludes"),nr=i((t,e,r)=>{t.has(e)?t.get(e)?.push(r):t.set(e,[r])},"mapAddOrPush");var ri=(()=>{let t=0;return()=>t++})();var ni={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"select","10":"lstick","16":"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"start","10":"lstick","16":"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};var oi=i(()=>dt.lastInputDevice,"getLastInputDeviceType"),ii=i(()=>{let t=dt.buttons;for(let e in t){let r=t[e].keyboard&&[t[e].keyboard].flat(),n=t[e].keyboardCode&&[t[e].keyboardCode].flat(),o=t[e].gamepad&&[t[e].gamepad].flat(),s=t[e].mouse&&[t[e].mouse].flat();r&&r.forEach(a=>{nr(dt.buttonsByKey,a,e)}),n&&n.forEach(a=>{nr(dt.buttonsByKeyCode,a,e)}),o&&o.forEach(a=>{nr(dt.buttonsByGamepad,a,e)}),s&&s.forEach(a=>{nr(dt.buttonsByMouse,a,e)})}},"parseButtonBindings");var wt=class{static{i(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},Sn=class{static{i(this,"GamepadState")}buttonState=new wt;stickState=new Map},Tn=class{static{i(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((r,n)=>r+n)/this.dts.length)),this.dts=[])}},dt,si=ni,Xu=i(t=>{let e=t.buttons??{};return{canvas:t.canvas,buttons:e,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new Tn,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new O(0),mouseDeltaPos:new O(0),keyState:new wt,mouseState:new wt,mergedGamepadState:new Sn,gamepadStates:new Map,lastInputDevice:null,buttonState:new wt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new Je}},"initAppState"),ai=i(t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e=Xu(t);dt=e,ii();function r(){return e.dt*e.timeScale}i(r,"dt");function n(){return e.fixedDt*e.timeScale}i(n,"fixedDt");function o(){return e.restDt*e.timeScale}i(o,"restDt");function s(){return e.isHidden}i(s,"isHidden");function a(){return e.time}i(a,"time");function c(){return e.fpsCounter.fps}i(c,"fps");function u(){return e.numFrames}i(u,"numFrames");function m(){return e.canvas.toDataURL()}i(m,"screenshot");function l(d){e.canvas.style.cursor=d}i(l,"setCursor");function p(){return e.canvas.style.cursor}i(p,"getCursor");function f(d){if(d)try{let w=e.canvas.requestPointerLock();w.catch&&w.catch(M=>console.error(M))}catch(w){console.error(w)}else document.exitPointerLock()}i(f,"setCursorLocked");function C(){return!!document.pointerLockElement}i(C,"isCursorLocked");function v(d){d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen()}i(v,"enterFullscreen");function g(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}i(g,"exitFullscreen");function x(d=!0){d?v(e.canvas):g()}i(x,"setFullscreen");function y(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}i(y,"isFullscreen");function G(){e.stopped=!0;let d=Object.entries(Ie),w=Object.entries(cn),M=Object.entries(xr);for(let[I,se]of d)e.canvas.removeEventListener(I,se);for(let[I,se]of w)document.removeEventListener(I,se);for(let[I,se]of M)window.removeEventListener(I,se);fo.disconnect()}i(G,"quit");function B(d,w){e.loopID!==null&&cancelAnimationFrame(e.loopID);let M=0,I=0,se=i(Re=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(se);return}let le=Re/1e3,st=Math.min(le-e.realTime,.25),Ut=t.maxFPS?1/t.maxFPS:0;if(e.realTime=le,I+=st,I>Ut){if(!e.skipTime){for(M+=I,e.dt=e.fixedDt,e.restDt=0;M>e.fixedDt;)M-=e.fixedDt,M<e.fixedDt&&(e.restDt=M),d();e.restDt=M,e.dt=I,e.time+=r(),e.fpsCounter.tick(e.dt)}I=0,e.skipTime=!1,e.numFrames++,w(iu,su)}e.loopID=requestAnimationFrame(se)},"frame");se(0)}i(B,"run");function D(){return"ontouchstart"in window||navigator.maxTouchPoints>0}i(D,"isTouchscreen");function U(){return e.mousePos.clone()}i(U,"mousePos");function h(){return e.mouseDeltaPos.clone()}i(h,"mouseDeltaPos");function A(d="left"){return e.mouseState.pressed.has(d)}i(A,"isMousePressed");function S(d="left"){return e.mouseState.down.has(d)}i(S,"isMouseDown");function P(d="left"){return e.mouseState.released.has(d)}i(P,"isMouseReleased");function V(){return e.isMouseMoved}i(V,"isMouseMoved");function j(d){return d===void 0?e.keyState.pressed.size>0:Ze(e.keyState.pressed,d)}i(j,"isKeyPressed");function K(d){return d===void 0?e.keyState.pressedRepeat.size>0:Ze(e.keyState.pressedRepeat,d)}i(K,"isKeyPressedRepeat");function $(d){return d===void 0?e.keyState.down.size>0:Ze(e.keyState.down,d)}i($,"isKeyDown");function q(d){return d===void 0?e.keyState.released.size>0:Ze(e.keyState.released,d)}i(q,"isKeyReleased");function Q(d){return d===void 0?e.mergedGamepadState.buttonState.pressed.size>0:Ze(e.mergedGamepadState.buttonState.pressed,d)}i(Q,"isGamepadButtonPressed");function z(d){return d===void 0?e.mergedGamepadState.buttonState.down.size>0:Ze(e.mergedGamepadState.buttonState.down,d)}i(z,"isGamepadButtonDown");function Y(d){return d===void 0?e.mergedGamepadState.buttonState.released.size>0:Ze(e.mergedGamepadState.buttonState.released,d)}i(Y,"isGamepadButtonReleased");function re(d){return d===void 0?e.buttonState.pressed.size>0:Ze(e.buttonState.pressed,d)}i(re,"isButtonPressed");function J(d){return d===void 0?e.buttonState.down.size>0:Ze(e.buttonState.down,d)}i(J,"isButtonDown");function ie(d){return d===void 0?e.buttonState.released.size>0:Ze(e.buttonState.released,d)}i(ie,"isButtonReleased");function ce(d){return e.buttons?.[d]}i(ce,"getButton");function H(d,w){e.buttons[d]={...e.buttons[d],...w}}i(H,"setButton");function L(d){e.buttonState.press(d),e.events.trigger("buttonPress",d)}i(L,"pressButton");function N(d){e.buttonState.release(d),e.events.trigger("buttonRelease",d)}i(N,"releaseButton");function ee(d){return e.events.on("resize",d)}i(ee,"onResize");let ne=fe(d=>e.events.on("keyDown",d),(d,w)=>e.events.on("keyDown",M=>ke(d,M)&&w(M))),we=fe(d=>e.events.on("keyPress",w=>d(w)),(d,w)=>e.events.on("keyPress",M=>ke(d,M)&&w(M))),Ae=fe(d=>e.events.on("keyPressRepeat",d),(d,w)=>e.events.on("keyPressRepeat",M=>ke(d,M)&&w(M))),Bt=fe(d=>e.events.on("keyRelease",d),(d,w)=>e.events.on("keyRelease",M=>ke(d,M)&&w(M))),yr=fe(d=>e.events.on("mouseDown",w=>d(w)),(d,w)=>e.events.on("mouseDown",M=>ke(d,M)&&w(M))),Ia=fe(d=>e.events.on("mousePress",w=>d(w)),(d,w)=>e.events.on("mousePress",M=>ke(d,M)&&w(M))),ja=fe(d=>e.events.on("mouseRelease",w=>d(w)),(d,w)=>e.events.on("mouseRelease",M=>M===d&&w(M)));function Ka(d){return e.events.on("mouseMove",()=>d(U(),h()))}i(Ka,"onMouseMove");function ka(d){return e.events.on("charInput",d)}i(ka,"onCharInput");function Na(d){return e.events.on("touchStart",d)}i(Na,"onTouchStart");function _a(d){return e.events.on("touchMove",d)}i(_a,"onTouchMove");function Ha(d){return e.events.on("touchEnd",d)}i(Ha,"onTouchEnd");function qa(d){return e.events.on("scroll",d)}i(qa,"onScroll");function za(d){return e.events.on("hide",d)}i(za,"onHide");function Ya(d){return e.events.on("show",d)}i(Ya,"onShow");let Wa=fe(d=>e.events.on("gamepadButtonPress",(w,M)=>d(w,M)),(d,w)=>e.events.on("gamepadButtonPress",(M,I)=>ke(d,M)&&w(M,I))),$a=fe(d=>e.events.on("gamepadButtonDown",(w,M)=>d(w,M)),(d,w)=>e.events.on("gamepadButtonDown",(M,I)=>ke(d,M)&&w(M,I))),Xa=fe(d=>e.events.on("gamepadButtonRelease",(w,M)=>d(w,M)),(d,w)=>e.events.on("gamepadButtonRelease",(M,I)=>ke(d,M)&&w(M,I)));function Qa(d,w){return e.events.on("gamepadStick",(M,I,se)=>M===d&&w(I,se))}i(Qa,"onGamepadStick");function Ja(d){return e.events.on("gamepadConnect",d)}i(Ja,"onGamepadConnect");function Za(d){return e.events.on("gamepadDisconnect",d)}i(Za,"onGamepadDisconnect");function eu(d){return e.mergedGamepadState.stickState.get(d)||new O(0)}i(eu,"getGamepadStick");function tu(){return[...e.charInputted]}i(tu,"charInputted");function uo(){return[...e.gamepads]}i(uo,"getGamepads");let ru=fe(d=>e.events.on("buttonPress",w=>d(w)),(d,w)=>e.events.on("buttonPress",M=>ke(d,M)&&w(M))),nu=fe(d=>e.events.on("buttonDown",w=>d(w)),(d,w)=>e.events.on("buttonDown",M=>ke(d,M)&&w(M))),ou=fe(d=>e.events.on("buttonRelease",w=>d(w)),(d,w)=>e.events.on("buttonRelease",M=>ke(d,M)&&w(M)));function iu(){e.events.trigger("input"),e.keyState.down.forEach(d=>e.events.trigger("keyDown",d)),e.mouseState.down.forEach(d=>e.events.trigger("mouseDown",d)),e.buttonState.down.forEach(d=>{e.events.trigger("buttonDown",d)}),uu()}i(iu,"processInput");function su(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((d,w)=>{e.mergedGamepadState.stickState.set(w,new O(0))}),e.charInputted=[],e.isMouseMoved=!1,e.mouseDeltaPos=new O(0),e.gamepadStates.forEach(d=>{d.buttonState.update(),d.stickState.forEach((w,M)=>{d.stickState.set(M,new O(0))})})}i(su,"resetInput");function co(d){let w={index:d.index,isPressed:i(M=>e.gamepadStates.get(d.index)?.buttonState.pressed.has(M)||!1,"isPressed"),isDown:i(M=>e.gamepadStates.get(d.index)?.buttonState.down.has(M)||!1,"isDown"),isReleased:i(M=>e.gamepadStates.get(d.index)?.buttonState.released.has(M)||!1,"isReleased"),getStick:i(M=>e.gamepadStates.get(d.index)?.stickState.get(M)||b(),"getStick")};return e.gamepads.push(w),e.gamepadStates.set(d.index,{buttonState:new wt,stickState:new Map([["left",new O(0)],["right",new O(0)]])}),w}i(co,"registerGamepad");function au(d){e.gamepads=e.gamepads.filter(w=>w.index!==d.index),e.gamepadStates.delete(d.index)}i(au,"removeGamepad");function uu(){for(let d of navigator.getGamepads())d&&!e.gamepadStates.has(d.index)&&co(d);for(let d of e.gamepads){let w=navigator.getGamepads()[d.index];if(!w)continue;let I=(t.gamepads??{})[w.id]||si[w.id]||si.default,se=e.gamepadStates.get(d.index);if(se){for(let Re=0;Re<w.buttons.length;Re++){let le=I.buttons[Re],st=w.buttons[Re],Ut=e.buttonsByGamepad.has(le);if(st.pressed){if(se.buttonState.down.has(le)){e.events.trigger("gamepadButtonDown",le,d);continue}e.lastInputDevice="gamepad",Ut&&e.buttonsByGamepad.get(le)?.forEach(je=>{e.buttonState.press(je),e.events.trigger("buttonPress",je)}),e.mergedGamepadState.buttonState.press(le),se.buttonState.press(le),e.events.trigger("gamepadButtonPress",le,d)}else se.buttonState.down.has(le)&&(Ut&&e.buttonsByGamepad.get(le)?.forEach(je=>{e.buttonState.release(je),e.events.trigger("buttonRelease",je)}),e.mergedGamepadState.buttonState.release(le),se.buttonState.release(le),e.events.trigger("gamepadButtonRelease",le,d))}for(let Re in I.sticks){let le=I.sticks[Re];if(!le)continue;let st=new O(w.axes[le.x],w.axes[le.y]);se.stickState.set(Re,st),e.mergedGamepadState.stickState.set(Re,st),e.events.trigger("gamepadStick",Re,st,d)}}}}i(uu,"processGamepad");let Ie={},cn={},xr={},lo=t.pixelDensity||1;Ie.mousemove=d=>{let w=new O(d.offsetX,d.offsetY),M=new O(d.movementX,d.movementY);if(y()){let I=e.canvas.width/lo,se=e.canvas.height/lo,Re=window.innerWidth,le=window.innerHeight,st=Re/le,Ut=I/se;if(st>Ut){let je=le/se,ln=(Re-I*je)/2;w.x=Le(d.offsetX-ln,0,I*je,0,I),w.y=Le(d.offsetY,0,se*je,0,se)}else{let je=Re/I,ln=(le-se*je)/2;w.x=Le(d.offsetX,0,I*je,0,I),w.y=Le(d.offsetY-ln,0,se*je,0,se)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=w,e.mouseDeltaPos=M,e.events.trigger("mouseMove")})};let mo=["left","middle","right","back","forward"];Ie.mousedown=d=>{e.events.onOnce("input",()=>{let w=mo[d.button];w&&(e.lastInputDevice="mouse",e.buttonsByMouse.has(w)&&e.buttonsByMouse.get(w)?.forEach(M=>{e.buttonState.press(M),e.events.trigger("buttonPress",M)}),e.mouseState.press(w),e.events.trigger("mousePress",w))})},Ie.mouseup=d=>{e.events.onOnce("input",()=>{let w=mo[d.button];w&&(e.buttonsByMouse.has(w)&&e.buttonsByMouse.get(w)?.forEach(M=>{e.buttonState.release(M),e.events.trigger("buttonRelease",M)}),e.mouseState.release(w),e.events.trigger("mouseRelease",w))})};let cu=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),po={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};Ie.keydown=d=>{cu.has(d.key)&&d.preventDefault(),e.events.onOnce("input",()=>{let w=po[d.key]||d.key.toLowerCase(),M=d.code;if(w===void 0)throw new Error(`Unknown key: ${d.key}`);w.length===1?(e.events.trigger("charInput",w),e.charInputted.push(w)):w==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),d.repeat?(e.keyState.pressRepeat(w),e.events.trigger("keyPressRepeat",w)):(e.lastInputDevice="keyboard",e.buttonsByKey.has(w)&&e.buttonsByKey.get(w)?.forEach(I=>{e.buttonState.press(I),e.events.trigger("buttonPress",I)}),e.buttonsByKeyCode.has(M)&&e.buttonsByKeyCode.get(M)?.forEach(I=>{e.buttonState.press(I),e.events.trigger("buttonPress",I)}),e.keyState.press(w),e.events.trigger("keyPressRepeat",w),e.events.trigger("keyPress",w))})},Ie.keyup=d=>{e.events.onOnce("input",()=>{let w=po[d.key]||d.key.toLowerCase(),M=d.code;e.buttonsByKey.has(w)&&e.buttonsByKey.get(w)?.forEach(I=>{e.buttonState.release(I),e.events.trigger("buttonRelease",I)}),e.buttonsByKeyCode.has(M)&&e.buttonsByKeyCode.get(M)?.forEach(I=>{e.buttonState.release(I),e.events.trigger("buttonRelease",I)}),e.keyState.release(w),e.events.trigger("keyRelease",w)})},Ie.touchstart=d=>{d.preventDefault(),e.events.onOnce("input",()=>{let w=[...d.changedTouches],M=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new O(w[0].clientX-M.x,w[0].clientY-M.y),e.lastInputDevice="mouse",e.buttonsByMouse.has("left")&&e.buttonsByMouse.get("left")?.forEach(I=>{e.buttonState.press(I),e.events.trigger("buttonPress",I)}),e.mouseState.press("left"),e.events.trigger("mousePress","left")),w.forEach(I=>{e.events.trigger("touchStart",new O(I.clientX-M.x,I.clientY-M.y),I)})})},Ie.touchmove=d=>{d.preventDefault(),e.events.onOnce("input",()=>{let w=[...d.changedTouches],M=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let I=e.mousePos;e.mousePos=new O(w[0].clientX-M.x,w[0].clientY-M.y),e.mouseDeltaPos=e.mousePos.sub(I),e.events.trigger("mouseMove")}w.forEach(I=>{e.events.trigger("touchMove",new O(I.clientX-M.x,I.clientY-M.y),I)})})},Ie.touchend=d=>{e.events.onOnce("input",()=>{let w=[...d.changedTouches],M=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new O(w[0].clientX-M.x,w[0].clientY-M.y),e.mouseDeltaPos=new O(0,0),e.buttonsByMouse.has("left")&&e.buttonsByMouse.get("left")?.forEach(I=>{e.buttonState.release(I),e.events.trigger("buttonRelease",I)}),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),w.forEach(I=>{e.events.trigger("touchEnd",new O(I.clientX-M.x,I.clientY-M.y),I)})})},Ie.touchcancel=d=>{e.events.onOnce("input",()=>{let w=[...d.changedTouches],M=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new O(w[0].clientX-M.x,w[0].clientY-M.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),w.forEach(I=>{e.events.trigger("touchEnd",new O(I.clientX-M.x,I.clientY-M.y),I)})})},Ie.wheel=d=>{d.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new O(d.deltaX,d.deltaY))})},Ie.contextmenu=d=>d.preventDefault(),cn.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger("show")):(e.isHidden=!0,e.events.trigger("hide"))},xr.gamepadconnected=d=>{let w=co(d.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",w)})},xr.gamepaddisconnected=d=>{let w=uo().filter(M=>M.index===d.gamepad.index)[0];au(d.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",w)})};for(let[d,w]of Object.entries(Ie))e.canvas.addEventListener(d,w);for(let[d,w]of Object.entries(cn))document.addEventListener(d,w);for(let[d,w]of Object.entries(xr))window.addEventListener(d,w);let fo=new ResizeObserver(d=>{for(let w of d)if(w.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return fo.observe(e.canvas),{dt:r,fixedDt:n,restDt:o,time:a,run:B,canvas:e.canvas,fps:c,numFrames:u,quit:G,isHidden:s,setFullscreen:x,isFullscreen:y,setCursor:l,screenshot:m,getGamepads:uo,getCursor:p,setCursorLocked:f,isCursorLocked:C,isTouchscreen:D,mousePos:U,mouseDeltaPos:h,isKeyDown:$,isKeyPressed:j,isKeyPressedRepeat:K,isKeyReleased:q,isMouseDown:S,isMousePressed:A,isMouseReleased:P,isMouseMoved:V,isGamepadButtonPressed:Q,isGamepadButtonDown:z,isGamepadButtonReleased:Y,getGamepadStick:eu,isButtonPressed:re,isButtonDown:J,isButtonReleased:ie,setButton:H,getButton:ce,pressButton:L,releaseButton:N,charInputted:tu,onResize:ee,onKeyDown:ne,onKeyPress:we,onKeyPressRepeat:Ae,onKeyRelease:Bt,onMouseDown:yr,onMousePress:Ia,onMouseRelease:ja,onMouseMove:Ka,onCharInput:ka,onTouchStart:Na,onTouchMove:_a,onTouchEnd:Ha,onScroll:qa,onHide:za,onShow:Ya,onGamepadButtonDown:$a,onGamepadButtonPress:Wa,onGamepadButtonRelease:Xa,onGamepadStick:Qa,onGamepadConnect:Ja,onGamepadDisconnect:Za,onButtonPress:ru,onButtonDown:nu,onButtonRelease:ou,getLastInputDeviceType:oi,events:e.events}},"initApp");function Me(){return R.dt()*Z.timeScale}i(Me,"dt");function ui(){return R.fixedDt()*Z.timeScale}i(ui,"fixedDt");function ci(){return R.restDt()*Z.timeScale}i(ci,"restDt");var Qu=new O(-1,-1),Ju=new O(0,-1),Zu=new O(1,-1),ec=new O(-1,0),tc=new O(0,0),rc=new O(1,0),nc=new O(-1,1),oc=new O(0,1),ic=new O(1,1);function qe(t){switch(t){case"topleft":return Qu;case"top":return Ju;case"topright":return Zu;case"left":return ec;case"center":return tc;case"right":return rc;case"botleft":return nc;case"bot":return oc;case"botright":return ic;default:return t}}i(qe,"anchorPt");function li(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}i(li,"alignPt");var Dr=2.5949095,mi=1.70158+1,pi=2*Math.PI/3,di=2*Math.PI/4.5,Br={linear:i(t=>t,"linear"),easeInSine:i(t=>1-Math.cos(t*Math.PI/2),"easeInSine"),easeOutSine:i(t=>Math.sin(t*Math.PI/2),"easeOutSine"),easeInOutSine:i(t=>-(Math.cos(Math.PI*t)-1)/2,"easeInOutSine"),easeInQuad:i(t=>t*t,"easeInQuad"),easeOutQuad:i(t=>1-(1-t)*(1-t),"easeOutQuad"),easeInOutQuad:i(t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,"easeInOutQuad"),easeInCubic:i(t=>t*t*t,"easeInCubic"),easeOutCubic:i(t=>1-Math.pow(1-t,3),"easeOutCubic"),easeInOutCubic:i(t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,"easeInOutCubic"),easeInQuart:i(t=>t*t*t*t,"easeInQuart"),easeOutQuart:i(t=>1-Math.pow(1-t,4),"easeOutQuart"),easeInOutQuart:i(t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,"easeInOutQuart"),easeInQuint:i(t=>t*t*t*t*t,"easeInQuint"),easeOutQuint:i(t=>1-Math.pow(1-t,5),"easeOutQuint"),easeInOutQuint:i(t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,"easeInOutQuint"),easeInExpo:i(t=>t===0?0:Math.pow(2,10*t-10),"easeInExpo"),easeOutExpo:i(t=>t===1?1:1-Math.pow(2,-10*t),"easeOutExpo"),easeInOutExpo:i(t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,"easeInOutExpo"),easeInCirc:i(t=>1-Math.sqrt(1-Math.pow(t,2)),"easeInCirc"),easeOutCirc:i(t=>Math.sqrt(1-Math.pow(t-1,2)),"easeOutCirc"),easeInOutCirc:i(t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,"easeInOutCirc"),easeInBack:i(t=>mi*t*t*t-1.70158*t*t,"easeInBack"),easeOutBack:i(t=>1+mi*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),"easeOutBack"),easeInOutBack:i(t=>t<.5?Math.pow(2*t,2)*((Dr+1)*2*t-Dr)/2:(Math.pow(2*t-2,2)*((Dr+1)*(t*2-2)+Dr)+2)/2,"easeInOutBack"),easeInElastic:i(t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*pi),"easeInElastic"),easeOutElastic:i(t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*pi)+1,"easeOutElastic"),easeInOutElastic:i(t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*di))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*di)/2+1,"easeInOutElastic"),easeInBounce:i(t=>1-Br.easeOutBounce(1-t),"easeInBounce"),easeOutBounce:i(t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,"easeOutBounce"),easeInOutBounce:i(t=>t<.5?(1-Br.easeOutBounce(1-2*t))/2:(1+Br.easeOutBounce(2*t-1))/2,"easeInOutBounce")},ut=Br;var kt=class t{static{i(this,"Vec3")}x;y;z;constructor(e,r,n){this.x=e,this.y=r,this.z=n}dot(e){return this.x*this.x+this.y*this.y+this.z*this.z}cross(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}};var Vn=class{static{i(this,"CircleCollider")}center;radius;constructor(e,r){this.center=e,this.radius=r}support(e){return this.center.add(e.unit().scale(this.radius))}},Pn=class{static{i(this,"EllipseCollider")}center;radiusX;radiusY;angle;constructor(e,r,n,o){this.center=e,this.radiusX=r,this.radiusY=n,this.angle=o}support(e){if(this.angle===0){let r=e.unit().scale(this.radiusX,this.radiusY).unit().scale(this.radiusX,this.radiusY);return this.center.add(r)}else{e=e.rotate(-this.angle);let r=e.unit().scale(this.radiusX,this.radiusY).unit().scale(this.radiusX,this.radiusY);return r=r.rotate(this.angle),this.center.add(r)}}},or=class{static{i(this,"PolygonCollider")}vertices;center;constructor(e){this.vertices=e,this.center=this.vertices[0]}support(e){let r,n=Number.NEGATIVE_INFINITY;for(let o of this.vertices){let s=o.dot(e);s>n&&(n=s,r=o)}return r}};function fi(t,e,r){var n=r.scale(-1);return t.support(r).sub(e.support(n))}i(fi,"calculateSupport");function sc(t,e,r,n){var o=fi(e,r,n);return t.push(o),n.dot(o)>=0}i(sc,"addSupport");function An(t,e,r){let n=new kt(t.x,t.y,0),o=new kt(e.x,e.y,0),s=new kt(r.x,r.y,0),c=n.cross(o).cross(s);return b(c.x,c.y)}i(An,"tripleProduct");function hi(t,e,r,n){switch(t.length){case 0:{n.x=r.center.x-e.center.x,n.y=r.center.y-e.center.y;break}case 1:{n.x=n.x*=-1,n.y=n.y*=-1;break}case 2:{let a=t[1].sub(t[0]),c=t[0].scale(-1),u=An(a,c,a);n.x=u.x,n.y=u.y;break}case 3:{let a=t[2].scale(-1),c=t[1].sub(t[2]),u=t[0].sub(t[2]);var o=An(u,c,c),s=An(c,u,u);if(o.dot(a)>0)t.splice(0,1),n.x=o.x,n.y=o.y;else if(s.dot(a)>0)t.splice(1,1),n.x=s.x,n.y=s.y;else return 1}break;default:throw Error(`Can't have s simplex with ${t.length} vertices!`)}return sc(t,e,r,n)?2:0}i(hi,"evolveSimplex");function ac(t,e){let r=[],n=b();for(var o=2;o===2;)o=hi(r,t,e,n);return o===1}i(ac,"gjkIntersects");function uc(t,e){var r=Number.POSITIVE_INFINITY,n=new O,o=0,s=new O;for(let c=0;c<t.length;c++){let u=c+1;u>=t.length&&(u=0),s=t[u].sub(t[c]);let m;switch(e){case 0:m=new O(s.y,-s.x);case 1:m=new O(-s.y,s.x)}m=m.unit();var a=m.dot(t[c]);a<r&&(r=a,n=m,o=u)}return{distance:r,normal:n,index:o}}i(uc,"findClosestEdge");var cc=20;function lc(t,e,r){let o=(r[1].x-r[0].x)*(r[1].y+r[0].y),s=(r[2].x-r[1].x)*(r[2].y+r[1].y),a=(r[0].x-r[2].x)*(r[0].y+r[2].y);var c=o+s+a>=0?0:1;let u=new O;for(let C=0;C<cc;C++){var m=uc(r,c),l=fi(t,e,m.normal),p=l.dot(m.normal);if(u=m.normal.scale(p),Math.abs(p-m.distance)<=1e-5){let v=u.len();return v!=0?{normal:u.scale(-1/v),distance:v}:null}else r.splice(m.index,0,l)}let f=u.len();return f!=0?{normal:u.scale(-1/f),distance:f}:null}i(lc,"getIntersection");function mc(t,e){let r=[],n=e.center.sub(t.center);for(var o=2;o===2;)o=hi(r,t,e,n);return o!==1?null:lc(t,e,r)}i(mc,"gjkIntersection");function Ur(t){return t instanceof te?new or(t.points()):t instanceof xe?new Vn(t.center,t.radius):t instanceof pe?new or(t.pts):t instanceof Pe?new Pn(t.center,t.radiusX,t.radiusY,t.angle):new or(t.bbox().points())}i(Ur,"shapeToCollider");function gi(t,e){let r=Ur(t),n=Ur(e);return ac(r,n)}i(gi,"gjkShapeIntersects");function Mn(t,e){let r=Ur(t),n=Ur(e);return mc(r,n)}i(Mn,"gjkShapeIntersection");function pc(t,e,r){let n=[],o=e;for(n.push(o);o!==t;){if(o=r.get(o),o==null)return null;n.push(o)}return n.reverse()}i(pc,"buildPath");function Gn(t,e,r){let n=new Kt((a,c)=>a.cost<c.cost);n.insert({cost:0,node:e});let o=new Map;o.set(e,e);let s=new Map;for(s.set(e,0);n.length!==0;){let a=n.remove()?.node;if(a===r)break;let c=t.getNeighbours(a);for(let u of c){let m=(s.get(a)||0)+t.getCost(a,u)+t.getHeuristic(u,r);(!s.has(u)||m<s.get(u))&&(s.set(u,m),n.insert({cost:m,node:u}),o.set(u,a))}}return pc(e,r,o)}i(Gn,"aStarSearch");var Rn=class{static{i(this,"NavEdge")}a;b;polygon;constructor(e,r,n){this.a=e,this.b=r,this.polygon=new WeakRef(n)}isLeft(e,r){return(this.b.x-this.a.x)*(r-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},Dn=class{static{i(this,"NavPolygon")}_edges;_centroid;_id;constructor(e){this._id=e}get id(){return this._id}set edges(e){this._edges=e;let r=0,n=0,o=0;for(let s of this._edges){s.polygon=new WeakRef(this);let a=s.a.x*s.b.y-s.a.y*s.b.x;r+=(s.a.x+s.b.x)*a,n+=(s.a.y+s.b.y)*a,o+=a}o/=2,this._centroid=b(r/(6*o),n/(6*o))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let r=!1;for(let n of this.edges)n.b.y>e.y!=n.a.y>e.y&&e.x<(n.a.x-n.b.x)*(e.y-n.b.y)/(n.a.y-n.b.y)+n.b.x&&(r=!r);return r}},Fr=class{static{i(this,"NavMesh")}_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let r=this._pointCache[`${e.x}_${e.y}`];return r||(r=e.clone(),this._pointCache[`${e.x}_${e.y}`]=r,r)}_addEdge(e){let r=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[r]=e,e}_findEdge(e,r){let n=`${e.x}_${e.y}-${r.x}_${r.y}`;return this._edgeCache[n]}_findCommonEdge(e,r){for(let n of e.edges){let o=this._findEdge(n.b,n.a);if(o&&o.polygon.deref().id===r.id)return o}return null}addPolygon(e){let r=new Dn(this._polygons.length),n=e.map((o,s)=>new Rn(o,e[(s+1)%e.length],r));r.edges=n,this._polygons.push(r);for(let o of r.edges)this._addEdge(o);return r}addRect(e,r){let n=this._addPoint(e),o=this._addPoint(e.add(r.x,0)),s=this._addPoint(e.add(r)),a=this._addPoint(e.add(0,r.y));return this.addPolygon([n,o,s,a])}_getLocation(e){for(let r of this._polygons)if(r.contains(e))return r;return null}getNeighbours(e){let r=[];for(let n of this._polygons[e].edges){let o=this._findEdge(n.b,n.a);if(o){let s=o.polygon.deref();s&&r.push(s.id)}}return r}getCost(e,r){return 1}getHeuristic(e,r){let n=this._polygons[e],o=this._polygons[r],s=n.centroid.x-o.centroid.x,a=n.centroid.y-o.centroid.y;return Math.sqrt(s*s+a*a)}getPath(e,r){return e===void 0||r===void 0?[]:e===r?[e,r]:Gn(this,e,r)}getWaypointPath(e,r,n){let o=n?.type||"centroids",s=this._getLocation(e),a=this._getLocation(r);if(s===void 0||a===void 0)return[];let c=this.getPath(s.id,a.id);if(!c)return[];if(o==="edges"){let u=[];for(let m=1;m<c.length;m++){let l=this._polygons[c[m-1]],p=this._polygons[c[m]],f=this._findCommonEdge(l,p);u.push(f.middle.add(p.centroid.sub(f.middle).unit().scale(4)))}return[e,...u,r]}else return[e,...c.slice(1,-1).map(u=>this._polygons[u].centroid),r]}};function rt(t,e){return e.setIdentity(),t.pos&&e.translateSelfV(t.pos),t.scale&&e.scaleSelfV(t.scale),t.angle&&e.rotateSelf(t.angle),t.parent&&e.mulSelf(t.parent.transform),e}i(rt,"calcTransform");function bi(t,e,r,n){n.x=t.x/e*2-1,n.y=-t.y/r*2+1}i(bi,"screen2ndc");function Et(t,e,r,n,o,s=1){n=ae(n%360),o=ae(o%360),o<=n&&(o+=Math.PI*2);let a=[],c=Math.ceil((o-n)/ae(8)*s),u=(o-n)/c,m=b(Math.cos(n),Math.sin(n)),l=b(Math.cos(u),Math.sin(u));for(let p=0;p<=c;p++)a.push(t.add(e*m.x,r*m.y)),m=b(m.x*l.x-m.y*l.y,m.x*l.y+m.y*l.x);return a}i(Et,"getArcPts");var Lr=class{static{i(this,"Edge")}obj;x;isLeft;constructor(e,r){this.obj=e,this.x=0,this.isLeft=r}},Ir=class{static{i(this,"SweepAndPrune")}edges;objects;constructor(){this.edges=[],this.objects=new Map}add(e){let r=new Lr(e,!0),n=new Lr(e,!1);this.edges.push(r),this.edges.push(n),this.objects.set(e,[r,n])}remove(e){let r=this.objects.get(e);r&&(this.edges.splice(this.edges.indexOf(r[0]),1),this.edges.splice(this.edges.indexOf(r[1]),1),this.objects.delete(e))}clear(){this.edges=[],this.objects.clear()}update(){for(let[e,r]of this.objects.entries()){rt(e,e.transform);let n=e.worldArea().bbox();r[0].x=n.pos.x,r[1].x=n.pos.x+n.width}for(let e=1;e<this.edges.length;e++)for(let r=e-1;r>=0&&!(this.edges[r].x<this.edges[r+1].x);r--)[this.edges[r],this.edges[r+1]]=[this.edges[r+1],this.edges[r]]}*[Symbol.iterator](){let e=new Set;for(let r of this.edges)if(r.isLeft){for(let n of e)yield[n,r.obj];e.add(r.obj)}else e.delete(r.obj)}};function yi(...t){let e=W(...t),r=t[3]??1;T.bgColor=e,T.bgAlpha=r,T.ggl.gl.clearColor(e.r/255,e.g/255,e.b/255,r)}i(yi,"setBackground");function xi(){return T.bgColor?.clone?.()??null}i(xi,"getBackground");var Be=class t{static{i(this,"Texture")}ctx;src=null;glTex;width;height;constructor(e,r,n,o={}){this.ctx=e;let s=e.gl,a=e.gl.createTexture();if(!a)throw new Error("Failed to create texture");this.glTex=a,e.onDestroy(()=>this.free()),this.width=r,this.height=n;let c={linear:s.LINEAR,nearest:s.NEAREST}[o.filter??e.opts.texFilter??"nearest"],u={repeat:s.REPEAT,clampToEdge:s.CLAMP_TO_EDGE}[o.wrap??"clampToEdge"];this.bind(),r&&n&&s.texImage2D(s.TEXTURE_2D,0,s.RGBA,r,n,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,u),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,u),this.unbind()}static fromImage(e,r,n={}){let o=new t(e,r.width,r.height,n);return o.update(r),o.src=r,o}update(e,r=0,n=0){let o=this.ctx.gl;this.bind(),o.texSubImage2D(o.TEXTURE_2D,0,r,n,o.RGBA,o.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},jr=class{static{i(this,"BatchRenderer")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform=null;constructor(e,r,n,o){let s=e.gl;this.vertexFormat=r,this.ctx=e,this.stride=r.reduce((c,u)=>c+u.size,0),this.maxVertices=n,this.maxIndices=o;let a=s.createBuffer();if(!a)throw new Error("Failed to create vertex buffer");this.glVBuf=a,e.pushArrayBuffer(this.glVBuf),s.bufferData(s.ARRAY_BUFFER,n*4,s.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=s.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o*4,s.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,r,n,o,s=null,a=null){(e!==this.curPrimitive||s!==this.curTex||o!==this.curShader||this.curUniform!=a&&!Rr(this.curUniform,a)||this.vqueue.length+r.length*this.stride>this.maxVertices||this.iqueue.length+n.length>this.maxIndices)&&this.flush();let c=this.vqueue.length/this.stride,u=r.length;for(let m=0;m<u;m++)this.vqueue.push(r[m]);u=n.length;for(let m=0;m<u;m++)this.iqueue.push(n[m]+c);this.curPrimitive=e,this.curShader=o,this.curTex=s,this.curUniform=a}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curUniform&&this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function Ot(t){let e=[],r=i(s=>{e.push(s),t(s)},"push"),n=i(()=>{e.pop(),t(o()??null)},"pop"),o=i(()=>e[e.length-1],"cur");return[r,n,o]}i(Ot,"genStack");function vi(t,e={}){let r=[];function n(U){r.push(U)}i(n,"onDestroy");function o(){r.forEach(h=>h());let U=t.getExtension("WEBGL_lose_context");U&&U.loseContext()}i(o,"destroy");let s=null;function a(U){if(Rr(U,s))return;s=U;let h=U.reduce((A,S)=>A+S.size,0);U.reduce((A,S,P)=>(t.vertexAttribPointer(P,S.size,t.FLOAT,!1,h*4,A),t.enableVertexAttribArray(P),A+S.size*4),0)}i(a,"setVertexFormat");let[c,u]=Ot(U=>t.bindTexture(t.TEXTURE_2D,U)),[m,l]=Ot(U=>t.bindBuffer(t.ARRAY_BUFFER,U)),[p,f]=Ot(U=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,U)),[C,v]=Ot(U=>t.bindFramebuffer(t.FRAMEBUFFER,U)),[g,x]=Ot(U=>t.bindRenderbuffer(t.RENDERBUFFER,U)),[y,G]=Ot(U=>{if(!U)return;let{x:h,y:A,w:S,h:P}=U;t.viewport(h,A,S,P)}),[B,D]=Ot(U=>t.useProgram(U));return y({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:n,destroy:o,pushTexture2D:c,popTexture2D:u,pushArrayBuffer:m,popArrayBuffer:l,pushElementArrayBuffer:p,popElementArrayBuffer:f,pushFramebuffer:C,popFramebuffer:v,pushRenderbuffer:g,popRenderbuffer:x,pushViewport:y,popViewport:G,pushProgram:B,popProgram:D,setVertexFormat:a}}i(vi,"initGfx");var ct=class{static{i(this,"FrameBuffer")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,r,n,o={}){this.ctx=e;let s=e.gl;e.onDestroy(()=>this.free()),this.tex=new Be(e,r,n,o);let a=s.createFramebuffer(),c=s.createRenderbuffer();if(!a||!c)throw new Error("Failed to create framebuffer");this.glFramebuffer=a,this.glRenderbuffer=c,this.bind(),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,r,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.tex.glTex,0),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,r=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,r),this.unbind();let n=this.width*4,o=new Uint8Array(n);for(let s=0;s<(this.height/2|0);s++){let a=s*n,c=(this.height-s-1)*n;o.set(r.subarray(a,a+n)),r.copyWithin(a,c,c+n),r.set(o,c)}return new ImageData(r,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),r=e.getContext("2d");if(e.width=this.width,e.height=this.height,!r)throw new Error("Failed to get 2d context");return r.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}};var ir=class{static{i(this,"TexPacker")}lastTextureId=0;textures=[];bigTextures=[];texturesPosition=new Map;canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,r,n){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=n,this.textures=[Be.fromImage(e,this.canvas)],this.bigTextures=[];let o=this.canvas.getContext("2d");if(!o)throw new Error("Failed to get 2d context");this.c2d=o}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height){let a=Be.fromImage(this.gfx,e);return this.bigTextures.push(a),[a,new X(0,0,1,1),0]}this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Be.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let r=this.textures[this.textures.length-1],n=new O(this.x,this.y),o=this.canvas.width-this.x,s=this.canvas.height-this.y;return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,n.x,n.y):this.c2d.drawImage(e,n.x,n.y),r.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:n,size:new O(e.width,e.height),texture:r}),this.lastTextureId++,[r,new X(n.x/this.canvas.width,n.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}remove(e){let r=this.texturesPosition.get(e);if(!r)throw new Error("Texture with packer id not found");this.c2d.clearRect(r.position.x,r.position.y,r.size.x,r.size.y),r.texture.update(this.canvas),this.texturesPosition.delete(e),this.x-=r.size.x}};function nt(t){return t.fixed?!0:t.parent?nt(t.parent):!1}i(nt,"isFixed");function Ue(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}i(Ue,"getRenderProps");function Ci(t,e={}){return{id:"circle",radius:t,draw(){ft(Object.assign(Ue(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new xe(new O(0),this.radius)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}i(Ci,"circle");function Kr(...t){return{id:"color",color:W(...t),inspect(){return`color: ${this.color.toString()}`}}}i(Kr,"color");function wi(t){return{add(){this.canvas=t}}}i(wi,"drawon");function Ei(t,e,r={}){return{id:"ellipse",radiusX:t,radiusY:e,draw(){Nt(Object.assign(Ue(this),{radiusX:this.radiusX,radiusY:this.radiusY,fill:r.fill}))},renderArea(){return new Pe(new O(0),this.radiusX,this.radiusY)},inspect(){return`radiusX: ${Math.ceil(this.radiusX)} radiusY: ${Math.ceil(this.radiusY)}`}}}i(Ei,"ellipse");function Oi(t=1){let e,r=0,n=!1;return{require:["opacity"],add(){e=this.opacity,this.opacity=0},update(){n||(r+=Me(),this.opacity=Le(r,0,t,0,e),r>=t&&(this.opacity=e,n=!0))}}}i(Oi,"fadeIn");function Si(t="intersect"){return{id:"mask",mask:t}}i(Si,"mask");function kr(t){return{id:"opacity",opacity:t??1,fadeIn(e=1,r=F.easings.linear){return E.root.tween(0,this.opacity,e,n=>this.opacity=n,r)},fadeOut(e=1,r=F.easings.linear){return E.root.tween(this.opacity,0,e,n=>this.opacity=n,r)},inspect(){return`opacity: ${rr(this.opacity,1)}`}}}i(kr,"opacity");function Ti(t=1,e=W(0,0,0),r=1,n="miter",o=10,s="butt"){return{id:"outline",outline:{width:t,color:e,opacity:r,join:n,miterLimit:o,cap:s},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}i(Ti,"outline");var Bn=class{static{i(this,"Particle")}pos=b(0);vel=b(0);acc=b(0);angle=0;angularVelocity=0;damping=0;t=0;lt=null;gc=!0;constructor(){}get progress(){return this.lt?this.t/this.lt:this.t}};function Ai(t,e){let r=e.lifetime,n=new Array(t.max),o=t.colors||[_.WHITE],s=t.opacities||[1],a=t.quads||[new X(0,0,1,1)],c=t.scales||[1],u=t.lifeTime,m=e.direction||0,l=e.spread||0,p=t.speed||[0,0],f=t.angle||[0,0],C=t.angularVelocity||[0,0],v=t.acceleration||[b(0),b(0)],g=t.damping||[0,0],x=new Array(t.max*6),y={pos:new Array(t.max*4*2),uv:new Array(t.max*4*2),color:new Array(t.max*4*3),opacity:new Array(t.max*4)},G=0,B=0;for(let h=0;h<t.max;h++)x[h*6+0]=h*4+0,x[h*6+1]=h*4+1,x[h*6+2]=h*4+3,x[h*6+3]=h*4+1,x[h*6+4]=h*4+2,x[h*6+5]=h*4+3,y.pos.fill(0),y.uv.fill(0),y.color.fill(255),y.opacity.fill(1),n[h]=new Bn;let D=new me;function U(h=0){for(;h<t.max;){if(n[h].gc)return h;h++}return null}return i(U,"nextFree"),{id:"particles",emit(h){h=Math.min(h,t.max-G);let A=0;for(let S=0;S<h;S++){if(A=U(A),A==null)return;let P=be(m-l,m+l),V=O.fromAngle(P).scale(be(p[0],p[1])),j=be(f[0],f[1]),K=be(C[0],C[1]),$=b(be(v[0].x,v[1].x),be(v[0].y,v[1].y)),q=be(g[0],g[1]),Q=u?be(u[0],u[1]):null,z=e.shape?e.shape.random():b(),Y=n[A];Y.t=0,Y.lt=Q,Y.pos=z,Y.vel=V,Y.acc=$,Y.angle=j,Y.angularVelocity=K,Y.damping=q,Y.gc=!1}G+=h},update(){if(r!==void 0&&r<=0)return;let h=Me();for(let A=0;A<n.length;A++){let S=n[A];if(!S.gc){if(S.t+=h,S.lt!==null&&S.t>=S.lt){S.gc=!0,G--;continue}S.vel=S.vel.add(S.acc.scale(h)).scale(1-S.damping*h),S.pos=S.pos.add(S.vel.scale(h)),S.angle+=S.angularVelocity*h}}for(r!==void 0&&(r-=h,r<=0&&D.trigger()),B+=h;G<t.max&&e.rate&&B>e.rate;)this.emit(1),B-=e.rate},draw(){if(!(r!==void 0&&r<=0||G==0)){for(let h=0;h<n.length;h++){let A=n[h];if(A.gc){y.opacity[h*4]=0,y.opacity[h*4+1]=0,y.opacity[h*4+2]=0,y.opacity[h*4+3]=0;continue}let S=A.progress,P=Math.floor(S*o.length),V=P<o.length-1?Oe(o[P],o[P+1],Le(S,P/o.length,(P+1)/o.length,0,1)):o[P],j=Math.floor(S*s.length),K=j<s.length-1?Oe(s[j],s[j+1],Le(S,j/s.length,(j+1)/s.length,0,1)):s[j],$=Math.floor(S*a.length),q=a[$],Q=Math.floor(S*c.length),z=c[Q],Y=ae(A.angle),re=Math.cos(Y),J=Math.sin(Y),ie=t.texture.width*q.w/2,ce=t.texture.height*q.h/2,H=h*4;y.pos[H*2]=A.pos.x+-ie*z*re- -ce*z*J,y.pos[H*2+1]=A.pos.y+-ie*z*J+-ce*z*re,y.uv[H*2]=q.x,y.uv[H*2+1]=q.y,y.color[H*3]=V.r,y.color[H*3+1]=V.g,y.color[H*3+2]=V.b,y.opacity[H]=K,H++,y.pos[H*2]=A.pos.x+ie*z*re- -ce*z*J,y.pos[H*2+1]=A.pos.y+ie*z*J+-ce*z*re,y.uv[H*2]=q.x+q.w,y.uv[H*2+1]=q.y,y.color[H*3]=V.r,y.color[H*3+1]=V.g,y.color[H*3+2]=V.b,y.opacity[H]=K,H++,y.pos[H*2]=A.pos.x+ie*z*re-ce*z*J,y.pos[H*2+1]=A.pos.y+ie*z*J+ce*z*re,y.uv[H*2]=q.x+q.w,y.uv[H*2+1]=q.y+q.h,y.color[H*3]=V.r,y.color[H*3+1]=V.g,y.color[H*3+2]=V.b,y.opacity[H]=K,H++,y.pos[H*2]=A.pos.x+-ie*z*re-ce*z*J,y.pos[H*2+1]=A.pos.y+-ie*z*J+ce*z*re,y.uv[H*2]=q.x,y.uv[H*2+1]=q.y+q.h,y.color[H*3]=V.r,y.color[H*3+1]=V.g,y.color[H*3+2]=V.b,y.opacity[H]=K}Ne(y,x,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(h){return D.add(h)},inspect(){return`count: ${G}/${t.max}`}}}i(Ai,"particles");function Vi(t,e={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){ze(Object.assign(Ue(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new pe(this.pts)},inspect(){return`polygon: ${this.pts.map(r=>`[${r.x},${r.y}]`).join(",")}`}}}i(Vi,"polygon");function Nr(t,e,r){let n;return E.root.get("area").forEach(s=>{if(r&&r.some(u=>s.is(u)))return;let c=s.worldArea().raycast(t,e);c&&(n?c.fraction<n.fraction&&(n=c,n.object=s):(n=c,n.object=s))}),n}i(Nr,"raycast");function _r(t,e,r={}){return{id:"rect",width:t,height:e,radius:r.radius||0,draw(){Ge(Object.assign(Ue(this),{width:this.width,height:this.height,radius:this.radius,fill:r.fill}))},renderArea(){return new te(b(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}i(_r,"rect");function Pi(t,e){return{id:"shader",shader:t,...typeof e=="function"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}i(Pi,"shader");var Hr=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ht="topleft";var Mi="monospace",St="monospace";var sr="linear";var ar=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],dc=ar.reduce((t,e)=>t+e.size,0),Gi=2048,Ri=Gi*4*dc,Di=Gi*6,Bi=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Ui=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,ur=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,cr=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Fi=new Set(["id","require"]),Li=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),Ii=200,ji=640,Ki=65536;var he=class t{static{i(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new me;onErrorEvents=new me;onFinishEvents=new me;constructor(e){e.then(r=>{this.loaded=!0,this.data=r,this.onLoadEvents.trigger(r)}).catch(r=>{if(this.error=r,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(r);else throw r}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let r=new t(Promise.resolve(e));return r.data=e,r.loaded=!0,r}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},gt=class{static{i(this,"AssetBucket")}assets=new Map;lastUID=0;add(e,r){let n=e??this.lastUID+++"",o=new he(r);return this.assets.set(n,o),o}addLoaded(e,r){let n=e??this.lastUID+++"",o=he.loaded(r);return this.assets.set(n,o),o}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(r=>{r.loaded&&e++}),e/this.assets.size}};function Ln(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}i(Ln,"fetchURL");function Tt(t){return Ln(t).then(e=>e.json())}i(Tt,"fetchJSON");function ki(t){return Ln(t).then(e=>e.text())}i(ki,"fetchText");function Ni(t){return Ln(t).then(e=>e.arrayBuffer())}i(Ni,"fetchArrayBuffer");function _i(t){return t!==void 0&&(k.urlPrefix=t),k.urlPrefix}i(_i,"loadRoot");function Hi(t,e){return k.custom.add(t,Tt(e))}i(Hi,"loadJSON");function At(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((r,n)=>{e.onload=()=>r(e),e.onerror=()=>n(new Error(`Failed to load image from "${t}"`))})}i(At,"loadImage");function _e(){let t=[k.sprites,k.sounds,k.shaders,k.fonts,k.bitmapFonts,k.custom];return t.reduce((e,r)=>e+r.progress(),0)/t.length}i(_e,"loadProgress");function qi(t){return k.custom.get(t)??null}i(qi,"getAsset");function lr(t){return k.custom.add(null,t)}i(lr,"load");var zi=i(t=>({urlPrefix:"",sprites:new gt,fonts:new gt,bitmapFonts:new gt,sounds:new gt,shaders:new gt,custom:new gt,music:{},packer:new ir(t,2048,2048),loaded:!1}),"initAssets");function Fe(t){return typeof t!="string"||Gr(t)?t:k.urlPrefix+t}i(Fe,"fixURL");function Yi(t,e,r){e=Fe(e),r=Fe(r),typeof e=="string"&&!r&&(r=Jo(e)+".json");let n=typeof r=="string"?Tt(r):Promise.resolve(r);return k.sprites.add(t,n.then(o=>{let s=o.meta.size,a=o.frames.map(u=>new X(u.frame.x/s.w,u.frame.y/s.h,u.frame.w/s.w,u.frame.h/s.h)),c={};for(let u of o.meta.frameTags)u.from===u.to?c[u.name]=u.from:c[u.name]={from:u.from,to:u.to,speed:10,loop:!0,pingpong:u.direction==="pingpong"};return Ye.from(e,{frames:a,anims:c})}))}i(Yi,"loadAseprite");var Vt=class{static{i(this,"FontData")}fontface;filter=sr;outline=null;size=64;constructor(e,r={}){if(this.fontface=e,this.filter=r.filter??sr,this.size=r.size??64,this.size>256)throw new Error(`Max font size: ${256}`);r.outline&&(this.outline={width:1,color:W(0,0,0)},typeof r.outline=="number"?this.outline.width=r.outline:typeof r.outline=="object"&&(r.outline.width&&(this.outline.width=r.outline.width),r.outline.color&&(this.outline.color=r.outline.color)))}};function In(t){if(!t)return In(ue.font??Mi);if(typeof t=="string"){let e=qr(t),r=jn(t);if(e)return e.data??e;if(r)return r.data??r;if(document.fonts.check(`${64}px ${t}`))return t;if(_e()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof he)return t.data?t.data:t;return t}i(In,"resolveFont");function jn(t){return k.fonts.get(t)??null}i(jn,"getFont");function Wi(t,e,r={}){let n=new FontFace(t,typeof e=="string"?`url(${e})`:e);return document.fonts.add(n),k.fonts.add(t,n.load().catch(o=>{throw new Error(`Failed to load font from "${e}": ${o}`)}).then(o=>new Vt(o,r)))}i(Wi,"loadFont");function $i(t,e,r,n){let o=t.width/e,s={},a=n.split("").entries();for(let[c,u]of a)s[u]=new X(c%o*e,Math.floor(c/o)*r,e,r);return{tex:t,map:s,size:r}}i($i,"makeFont");function qr(t){return k.bitmapFonts.get(t)??null}i(qr,"getBitmapFont");function Xi(t,e,r,n,o={}){return k.bitmapFonts.add(t,At(e).then(s=>$i(Be.fromImage(T.ggl,s,o),r,n,o.chars??Hr)))}i(Xi,"loadBitmapFont");function Qi(t,e){return e=Fe(e),k.sprites.add(t,new Promise(async r=>{let n=typeof e=="string"?await Tt(e):e,o=await Promise.all(n.frames.map(At)),s=document.createElement("canvas");s.width=n.width,s.height=n.height*n.frames.length;let a=s.getContext("2d");if(!a)throw new Error("Failed to create canvas context");o.forEach((u,m)=>{a.drawImage(u,0,m*n.height)});let c=await Pt(null,s,{sliceY:n.frames.length,anims:n.anims});r(c)}))}i(Qi,"loadPedit");var Kn=class{static{i(this,"Shader")}ctx;glProgram;constructor(e,r,n,o){this.ctx=e,e.onDestroy(()=>this.free());let s=e.gl,a=s.createShader(s.VERTEX_SHADER),c=s.createShader(s.FRAGMENT_SHADER);if(!a||!c)throw new Error("Failed to create shader");s.shaderSource(a,r),s.shaderSource(c,n),s.compileShader(a),s.compileShader(c);let u=s.createProgram();if(this.glProgram=u,s.attachShader(u,a),s.attachShader(u,c),o.forEach((m,l)=>s.bindAttribLocation(u,l,m)),s.linkProgram(u),!s.getProgramParameter(u,s.LINK_STATUS)){let m=s.getShaderInfoLog(a);if(m)throw new Error("VERTEX SHADER "+m);let l=s.getShaderInfoLog(c);if(l)throw new Error("FRAGMENT SHADER "+l)}s.deleteShader(a),s.deleteShader(c)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let r=this.ctx.gl;for(let n in e){let o=e[n],s=r.getUniformLocation(this.glProgram,n);if(typeof o=="number")r.uniform1f(s,o);else if(o instanceof Ft)r.uniformMatrix4fv(s,!1,new Float32Array(o.m));else if(o instanceof _)r.uniform3f(s,o.r,o.g,o.b);else if(o instanceof O)r.uniform2f(s,o.x,o.y);else if(Array.isArray(o)){let a=o[0];$o(o)?r.uniform1fv(s,o):Wo(o)?r.uniform2fv(s,o.map(c=>[c.x,c.y]).flat()):Yo(o)&&r.uniform3fv(s,o.map(c=>[c.r,c.g,c.b]).flat())}else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function zr(t,e=ur,r=cr){let n=Bi.replace("{{user}}",e??ur),o=Ui.replace("{{user}}",r??cr);try{return new Kn(t,n,o,ar.map(s=>s.name))}catch(s){let c=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,u=Zo(s).match(c);if(!u?.groups)throw s;let m=Number(u.groups.line)-14,l=u.groups.msg.trim(),p=u.groups.type.toLowerCase();throw new Error(`${p} shader line ${m}: ${l}`)}}i(zr,"makeShader");function Ji(t){if(!t)return T.defShader;if(typeof t=="string"){let e=kn(t);if(e)return e.data??e;if(_e()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof he)return t.data?t.data:t;return t}i(Ji,"resolveShader");function kn(t){return k.shaders.get(t)??null}i(kn,"getShader");function Zi(t,e,r){return k.shaders.addLoaded(t,zr(T.ggl,e,r))}i(Zi,"loadShader");function es(t,e,r){e=Fe(e),r=Fe(r);let n=i(s=>s?ki(s):Promise.resolve(null),"resolveUrl"),o=Promise.all([n(e),n(r)]).then(([s,a])=>zr(T.ggl,s,a));return k.shaders.add(t,o)}i(es,"loadShaderURL");var ot=class t{static{i(this,"SoundData")}buf;constructor(e){this.buf=e}static fromAudioBuffer(e){return new t(e)}static fromArrayBuffer(e){return new Promise((r,n)=>oe.ctx.decodeAudioData(e,r,n)).then(r=>new t(r))}static fromURL(e){return Gr(e)?t.fromArrayBuffer(Xo(e)):Ni(e).then(r=>t.fromArrayBuffer(r))}};function ts(t){if(typeof t=="string"){let e=Nn(t);if(e)return e;if(_e()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof ot)return he.loaded(t);if(t instanceof he)return t;throw new Error(`Invalid sound: ${t}`)}}i(ts,"resolveSound");function Nn(t){return k.sounds.get(t)??null}i(Nn,"getSound");function rs(t,e){let r=Fe(e),n;return typeof r=="string"?n=ot.fromURL(r):r instanceof ArrayBuffer?n=ot.fromArrayBuffer(r):n=Promise.resolve(ot.fromAudioBuffer(r)),k.sounds.add(t,n)}i(rs,"loadSound");function ns(t,e){let r=new Audio(e);return r.preload="auto",k.music[t]=Fe(e)}i(ns,"loadMusic");function _n(t,e){return t=Fe(t),typeof e=="string"?lr(new Promise((r,n)=>{Tt(e).then(o=>{_n(t,o).then(r).catch(n)})})):lr(Ye.from(t).then(r=>{let n={};for(let o in e){let s=e[o],a=r.frames[0],c=2048*a.w,u=2048*a.h,m=s.frames?s.frames.map(p=>new X(a.x+(s.x+p.x)/c*a.w,a.y+(s.y+p.y)/u*a.h,p.w/c*a.w,p.h/u*a.h)):Hn(s.sliceX||1,s.sliceY||1,a.x+s.x/c*a.w,a.y+s.y/u*a.h,s.width/c*a.w,s.height/u*a.h),l=new Ye(r.tex,m,s.anims);k.sprites.addLoaded(o,l),n[o]=l}return n}))}i(_n,"loadSpriteAtlas");var os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==";var Ye=class t{static{i(this,"SpriteData")}tex;frames=[new X(0,0,1,1)];anims={};slice9=null;packerId;constructor(e,r,n={},o=null,s=null){this.tex=e,r&&(this.frames=r),this.anims=n,this.slice9=o,this.packerId=s}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,r={}){return typeof e=="string"?t.fromURL(e,r):Promise.resolve(t.fromImage(e,r))}static fromImage(e,r={}){let[n,o,s]=k.packer.add(e),a=r.frames?r.frames.map(c=>new X(o.x+c.x*o.w,o.y+c.y*o.h,c.w*o.w,c.h*o.h)):Hn(r.sliceX||1,r.sliceY||1,o.x,o.y,o.w,o.h);return new t(n,a,r.anims,r.slice9,s)}static fromURL(e,r={}){return At(e).then(n=>t.fromImage(n,r))}};function _t(t){if(typeof t=="string"){let e=qn(t);if(e)return e;if(_e()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof he)return t;throw new Error(`Invalid sprite: ${t}`)}}i(_t,"resolveSprite");function qn(t){return k.sprites.get(t)??null}i(qn,"getSprite");function Pt(t,e,r={sliceX:1,sliceY:1,anims:{}}){return e=Fe(e),Array.isArray(e)?e.some(n=>typeof n=="string")?k.sprites.add(t,Promise.all(e.map(n=>typeof n=="string"?At(n):Promise.resolve(n))).then(n=>is(n,r))):k.sprites.addLoaded(t,is(e,r)):typeof e=="string"?k.sprites.add(t,Ye.from(e,r)):k.sprites.addLoaded(t,Ye.fromImage(e,r))}i(Pt,"loadSprite");function Hn(t=1,e=1,r=0,n=0,o=1,s=1){let a=[],c=o/t,u=s/e;for(let m=0;m<e;m++)for(let l=0;l<t;l++)a.push(new X(r+l*c,n+m*u,c,u));return a}i(Hn,"slice");function is(t,e={}){let r=document.createElement("canvas"),n=t[0].width,o=t[0].height;r.width=n*t.length,r.height=o;let s=r.getContext("2d");if(!s)throw new Error("Failed to create canvas context");t.forEach((c,u)=>{c instanceof ImageData?s.putImageData(c,u*n,0):s.drawImage(c,u*n,0)});let a=s.getImageData(0,0,t.length*n,o);return Ye.fromImage(a,{...e,sliceX:t.length,sliceY:1})}i(is,"createSpriteSheet");function ss(t="bean"){return Pt(t,os)}i(ss,"loadBean");function as(...t){return t.length>0&&(E.cam.pos=b(...t)),E.cam.pos?E.cam.pos.clone():Mt()}i(as,"camPos");function us(...t){return t.length>0&&(E.cam.scale=b(...t)),E.cam.scale.clone()}i(us,"camScale");function cs(t){return t!==void 0&&(E.cam.angle=t),E.cam.angle}i(cs,"camRot");function ls(t=W(255,255,255),e=1){let r=E.root.add([_r(ge(),ye()),Kr(t),kr(1),Wr()]),n=r.fadeOut(e);return n.onEnd(()=>Yr(r)),n}i(ls,"camFlash");function ms(){return E.cam.transform.clone()}i(ms,"camTransform");function ps(t=12){E.cam.shake+=t}i(ps,"shake");function ds(t){return E.cam.transform.transformPoint(t,b())}i(ds,"toScreen");function fs(t){return E.cam.transform.inverse.transformPoint(t,b())}i(fs,"toWorld");function hs(t,e){if(!e.tileWidth||!e.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let r=E.root.add([Gt(e.pos??b(0))]),n=t.length,o=0,s=null,a=null,c=null,u=null,m=i(h=>h.x+h.y*o,"tile2Hash"),l=i(h=>b(Math.floor(h%o),Math.floor(h/o)),"hash2Tile"),p=i(()=>{s=[];for(let h of r.children)f(h)},"createSpatialMap"),f=i(h=>{let A=m(h.tilePos);s[A]?s[A].push(h):s[A]=[h]},"insertIntoSpatialMap"),C=i(h=>{let A=m(h.tilePos);if(s[A]){let S=s[A].indexOf(h);S>=0&&s[A].splice(S,1)}},"removeFromSpatialMap"),v=i(()=>{let h=!1;for(let A of r.children){let S=r.pos2Tile(A.pos);(A.tilePos.x!=S.x||A.tilePos.y!=S.y)&&(h=!0,C(A),A.tilePos.x=S.x,A.tilePos.y=S.y,f(A))}h&&r.trigger("spatialMapChanged")},"updateSpatialMap"),g=i(()=>{let h=r.getSpatialMap(),A=r.numRows()*r.numColumns();a?a.length=A:a=new Array(A),a.fill(1,0,A);for(let S=0;S<h.length;S++){let P=h[S];if(P){let V=0;for(let j of P)if(j.isObstacle){V=1/0;break}else V+=j.cost;a[S]=V||1}}},"createCostMap"),x=i(()=>{let h=r.getSpatialMap(),A=r.numRows()*r.numColumns();c?c.length=A:c=new Array(A),c.fill(15,0,A);for(let S=0;S<h.length;S++){let P=h[S];if(P){let V=P.length,j=15;for(let K=0;K<V;K++)j|=P[K].edgeMask;c[S]=j}}},"createEdgeMap"),y=i(()=>{let h=r.numRows()*r.numColumns(),A=i((P,V)=>{let j=[];for(j.push(P);j.length>0;){let K=j.pop();D(K).forEach($=>{u[$]<0&&(u[$]=V,j.push($))})}},"traverse");u?u.length=h:u=new Array(h),u.fill(-1,0,h);let S=0;for(let P=0;P<a.length;P++){if(u[P]>=0){S++;continue}A(P,S),S++}},"createConnectivityMap"),G=i((h,A)=>a[A],"getCost"),B=i((h,A)=>{let S=l(h),P=l(A);return S.dist(P)},"getHeuristic"),D=i((h,A)=>{let S=[],P=Math.floor(h%o),V=P>0&&c[h]&1&&a[h-1]!==1/0,j=h>=o&&c[h]&2&&a[h-o]!==1/0,K=P<o-1&&c[h]&4&&a[h+1]!==1/0,$=h<o*n-o-1&&c[h]&8&&a[h+o]!==1/0;return A?(V&&(j&&S.push(h-o-1),S.push(h-1),$&&S.push(h+o-1)),j&&S.push(h-o),K&&(j&&S.push(h-o+1),S.push(h+1),$&&S.push(h+o+1)),$&&S.push(h+o)):(V&&S.push(h-1),j&&S.push(h-o),K&&S.push(h+1),$&&S.push(h+o)),S},"getNeighbours"),U={id:"level",tileWidth(){return e.tileWidth},tileHeight(){return e.tileHeight},spawn(h,...A){let S=b(...A),P=(()=>{if(typeof h=="string"){if(e.tiles[h]){if(typeof e.tiles[h]!="function")throw new Error("Level symbol def must be a function returning a component list");return e.tiles[h](S)}else if(e.wildcardTile)return e.wildcardTile(h,S)}else{if(Array.isArray(h))return h;throw new Error("Expected a symbol or a component list")}})();if(!P)return null;let V=!1,j=!1;for(let $ of P)$.id==="tile"&&(j=!0),$.id==="pos"&&(V=!0);V||P.push(Gt(this.tile2Pos(S))),j||P.push($r());let K=r.add(P);return V&&(K.tilePosOffset=K.pos.clone()),K.tilePos=S,rt(K,K.transform),s&&(f(K),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),K},numColumns(){return o},numRows(){return n},levelWidth(){return o*this.tileWidth()},levelHeight(){return n*this.tileHeight()},tile2Pos(...h){return b(...h).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...h){let A=b(...h);return b(Math.floor(A.x/this.tileWidth()),Math.floor(A.y/this.tileHeight()))},getSpatialMap(){return s||p(),s},onSpatialMapChanged(h){return this.on("spatialMapChanged",h)},onNavigationMapInvalid(h){return this.on("navigationMapInvalid",h)},getAt(h){s||p();let A=m(h);return s[A]||[]},raycast(h,A){let S=this.toWorld(h),P=this.toWorld(h.add(A)).sub(S),V=1/this.tileWidth(),j=h.scale(V),K=Mo(j,A,$=>{let q=this.getAt($);if(q.some(z=>z.isObstacle))return!0;let Q=null;for(let z of q)if(z.is("area")){let re=z.worldArea().raycast(S,P);re&&(Q?re.fraction<Q.fraction&&(Q=re,Q.object=z):(Q=re,Q.object=z))}return Q&&(Q.point=this.fromWorld(Q.point).scale(V)),Q||!1},64);return K&&(K.point=K.point.scale(this.tileWidth())),K},update(){s&&v()},invalidateNavigationMap(){a=null,c=null,u=null},onNavigationMapChanged(h){return this.on("navigationMapChanged",h)},getTilePath(h,A,S={}){if(a||g(),c||x(),u||y(),h.x<0||h.x>=o||h.y<0||h.y>=n||A.x<0||A.x>=o||A.y<0||A.y>=n)return null;let P=m(h),V=m(A);if(a[V]===1/0)return null;if(P===V)return[];if(u[P]!=-1&&u[P]!==u[V])return null;let j=new Kt((Y,re)=>Y.cost<re.cost);j.insert({cost:0,node:P});let K=new Map;K.set(P,P);let $=new Map;for($.set(P,0);j.length!==0;){let Y=j.remove()?.node;if(Y===V)break;let re=D(Y,S.allowDiagonals);for(let J of re){let ie=($.get(Y)||0)+G(Y,J)+B(J,V);(!$.has(J)||ie<$.get(J))&&($.set(J,ie),j.insert({cost:ie,node:J}),K.set(J,Y))}}let q=[],Q=V,z=l(Q);for(q.push(z);Q!==P;){let Y=K.get(Q);if(Y===void 0)throw new Error("Bug in pathfinding algorithm");Q=Y;let re=l(Q);q.push(re)}return q.reverse()},getPath(h,A,S={}){let P=this.tileWidth(),V=this.tileHeight(),j=this.getTilePath(this.pos2Tile(h),this.pos2Tile(A),S);return j?[h,...j.slice(1,-1).map(K=>K.scale(P,V).add(P/2,V/2)),A]:null}};return r.use(U),r.onNavigationMapInvalid(()=>{r.invalidateNavigationMap(),r.trigger("navigationMapChanged")}),t.forEach((h,A)=>{let S=h.split("");o=Math.max(S.length,o),S.forEach((P,V)=>{r.spawn(P,b(V,A))})}),r}i(hs,"addLevel");function it(t,e,r){return E.objEvents.registers[t]||(E.objEvents.registers[t]=new tr),E.objEvents.on(t,(n,...o)=>{n.is(e)&&r(n,...o)})}i(it,"on");var gs=fe(t=>{let e=E.root.add([{fixedUpdate:t}]);return{get paused(){return e.paused},set paused(r){e.paused=r},cancel:i(()=>e.destroy(),"cancel")}},(t,e)=>it("fixedUpdate",t,e)),bs=fe(t=>{let e=E.root.add([{update:t}]);return{get paused(){return e.paused},set paused(r){e.paused=r},cancel:i(()=>e.destroy(),"cancel")}},(t,e)=>it("update",t,e)),ys=fe(t=>{let e=E.root.add([{draw:t}]);return{get paused(){return e.hidden},set paused(r){e.hidden=r},cancel:i(()=>e.destroy(),"cancel")}},(t,e)=>it("draw",t,e)),Xr=fe(t=>E.events.on("add",t),(t,e)=>it("add",t,e)),zn=fe(t=>E.events.on("destroy",t),(t,e)=>it("destroy",t,e));function xs(t,e,r){return it("collide",t,(n,o,s)=>o.is(e)&&r(n,o,s))}i(xs,"onCollide");function vs(t,e,r){return it("collideUpdate",t,(n,o,s)=>o.is(e)&&r(n,o,s))}i(vs,"onCollideUpdate");function Cs(t,e,r){return it("collideEnd",t,(n,o,s)=>o.is(e)&&r(n,o,s))}i(Cs,"onCollideEnd");function Qr(t,e){E.root.get(t,{recursive:!0}).forEach(e),Xr(t,e)}i(Qr,"forAllCurrentAndFuture");var ws=fe(t=>R.onMousePress(t),(t,e)=>{let r=[];return Qr(t,n=>{if(!n.area)throw new Error("onClick() requires the object to have area() component");r.push(n.onClick(()=>e(n)))}),He.join(r)});function Es(t,e){let r=[];return Qr(t,n=>{if(!n.area)throw new Error("onHover() requires the object to have area() component");r.push(n.onHover(()=>e(n)))}),He.join(r)}i(Es,"onHover");function Os(t,e){let r=[];return Qr(t,n=>{if(!n.area)throw new Error("onHoverUpdate() requires the object to have area() component");r.push(n.onHoverUpdate(()=>e(n)))}),He.join(r)}i(Os,"onHoverUpdate");function Ss(t,e){let r=[];return Qr(t,n=>{if(!n.area)throw new Error("onHoverEnd() requires the object to have area() component");r.push(n.onHoverEnd(()=>e(n)))}),He.join(r)}i(Ss,"onHoverEnd");function Ts(t){return E.events.on("loading",t)}i(Ts,"onLoading");function As(t){return R.onResize(t)}i(As,"onResize");function Vs(t){return E.events.on("error",t)}i(Vs,"onError");function Ht(t){if(k.loaded)t();else return E.events.on("load",t)}i(Ht,"onLoad");function dr(t=[]){let e=new Map,r=[],n={},o=new Je,s=[],a=null,c=!1,u={id:ri(),hidden:!1,transform:new De,children:[],parent:null,set paused(l){if(l!==c){c=l;for(let p of s)p.paused=l}},get paused(){return c},get tags(){let l=[];for(let[p,f]of e.entries())Object.keys(f).length==1&&l.push(p);return l},add(l){let p=Array.isArray(l)?dr(l):l;if(p.parent)throw new Error("Cannot add a game obj that already has a parent.");return p.parent=this,rt(p,p.transform),this.children.push(p),p.trigger("add",p),E.events.trigger("add",p),p},readd(l){let p=this.children.indexOf(l);return p!==-1&&(this.children.splice(p,1),this.children.push(l)),l},remove(l){let p=this.children.indexOf(l);if(p!==-1){l.parent=null,this.children.splice(p,1);let f=i(C=>{C.trigger("destroy"),E.events.trigger("destroy",C),C.children.forEach(v=>f(v))},"trigger");f(l)}},removeAll(l){if(l)this.get(l).forEach(p=>this.remove(p));else for(let p of[...this.children])this.remove(p)},fixedUpdate(){this.paused||(this.children.forEach(l=>l.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(l=>l.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Te(),this.canvas.bind());let l=T.fixed;this.fixed&&(T.fixed=!0),Ee(),Se(this.pos),lt(this.scale),et(this.angle);let p=this.children.sort((f,C)=>{let v=f.layerIndex??E.defaultLayerIndex,g=C.layerIndex??E.defaultLayerIndex;return v-g||(f.z??0)-(C.z??0)});if(this.mask){let f={intersect:F.drawMasked,subtract:F.drawSubtracted}[this.mask];if(!f)throw new Error(`Invalid mask func: "${this.mask}"`);f(()=>{for(let C=0;C<p.length;C++)p[C].draw()},()=>{this.trigger("draw")})}else{this.trigger("draw");for(let f=0;f<p.length;f++)p[f].draw()}ve(),T.fixed=l,this.canvas&&(Te(),this.canvas.unbind())},drawInspect(){this.hidden||(Ee(),Se(this.pos),lt(this.scale),et(this.angle),this.children.forEach(l=>l.drawInspect()),this.trigger("drawInspect"),ve())},use(l){if(!l)return;if(typeof l=="string")return this.use({id:l});let p=[];l.id?(this.unuse(l.id),n[l.id]=[],p=n[l.id],e.set(l.id,l)):r.push(l);for(let C in l){if(Fi.has(C))continue;let v=Object.getOwnPropertyDescriptor(l,C);if(v)if(typeof v.value=="function"&&(l[C]=l[C].bind(this)),v.set&&Object.defineProperty(l,C,{set:v.set.bind(this)}),v.get&&Object.defineProperty(l,C,{get:v.get.bind(this)}),Li.has(C)){let g=C==="add"?()=>{a=i(x=>p.push(x),"onCurCompCleanup"),l[C]?.(),a=null}:l[C];p.push(this.on(C,g).cancel)}else if(this[C]===void 0)Object.defineProperty(this,C,{get:i(()=>l[C],"get"),set:i(g=>l[C]=g,"set"),configurable:!0,enumerable:!0}),p.push(()=>delete this[C]);else throw new Error(`Duplicate component property: "${C}"`)}let f=i(()=>{if(l.require){for(let C of l.require)if(!this.c(C))throw new Error(`Component "${l.id}" requires component "${C}"`)}},"checkDeps");l.destroy&&p.push(l.destroy.bind(this)),this.exists()?(f(),l.add&&(a=i(C=>p.push(C),"onCurCompCleanup"),l.add.call(this),a=null)):l.require&&p.push(this.on("add",f).cancel)},unuse(l){if(e.has(l)){for(let p of e.values())if(p.require&&p.require.includes(l))throw new Error(`Can't unuse. Component "${p.id}" requires component "${l}"`);e.delete(l)}n[l]&&(n[l].forEach(p=>p()),delete n[l])},c(l){return e.get(l)??null},get(l,p={}){let f=p.recursive?this.children.flatMap(i(function C(v){return[v,...v.children.flatMap(C)]},"recurse")):this.children;if(f=f.filter(C=>l?C.is(l):!0),p.liveUpdate){let C=i(g=>p.recursive?this.isAncestorOf(g):g.parent===this,"isChild"),v=[];v.push(F.onAdd(g=>{C(g)&&g.is(l)&&f.push(g)})),v.push(F.onDestroy(g=>{if(C(g)&&g.is(l)){let x=f.findIndex(y=>y.id===g.id);x!==-1&&f.splice(x,1)}})),this.onDestroy(()=>{for(let g of v)g.cancel()})}return f},query(l){let p=l.hierarchy||"children",f=l.include,C=l.exclude,v=[];switch(p){case"children":v=this.children;break;case"siblings":v=this.parent?this.parent.children.filter(x=>x!==this):[];break;case"ancestors":let g=this.parent;for(;g;)v.push(g),g=g.parent;break;case"descendants":v=this.children.flatMap(i(function x(y){return[y,...y.children.flatMap(x)]},"recurse"));break}if(f&&((l.includeOp||"and")==="and"||!Array.isArray(l.include)?v=v.filter(x=>x.is(f)):v=v.filter(x=>l.include.some(y=>x.is(y)))),C&&((l.includeOp||"and")==="and"||!Array.isArray(l.include)?v=v.filter(x=>!x.is(C)):v=v.filter(x=>!l.exclude.some(y=>x.is(y)))),l.visible===!0&&(v=v.filter(g=>g.visible)),l.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let g=l.distanceOp||"near",x=l.distance*l.distance;g==="near"?v=v.filter(y=>y.pos&&this.pos.sdist(y.pos)<=x):v=v.filter(y=>y.pos&&this.pos.sdist(y.pos)>x)}return l.name&&(v=v.filter(g=>g.name===l.name)),v},isAncestorOf(l){return l.parent?l.parent===this||this.isAncestorOf(l.parent):!1},exists(){return E.root.isAncestorOf(this)},is(l){if(l==="*")return!0;if(Array.isArray(l)){for(let p of l)if(!this.c(p))return!1;return!0}else return this.c(l)!=null},on(l,p){let f=o.on(l,p.bind(this));return a&&a(()=>f.cancel()),f},trigger(l,...p){o.trigger(l,...p),E.objEvents.trigger(l,this,...p)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let l={};for(let[p,f]of e)l[p]=f.inspect?.()??null;for(let[p,f]of r.entries()){if(f.inspect){l[p]=f.inspect();continue}for(let[C,v]of Object.entries(f))typeof v!="function"&&(l[C]=`${C}: ${v}`)}return l},onAdd(l){return this.on("add",l)},onFixedUpdate(l){return this.on("fixedUpdate",l)},onUpdate(l){return this.on("update",l)},onDraw(l){return this.on("draw",l)},onDestroy(l){return this.on("destroy",l)},clearEvents(){o.clear()}},m=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let l of m)u[l]=(...p)=>{let f=R[l]?.(...p);return s.push(f),u.onDestroy(()=>f.cancel()),u.on("sceneEnter",()=>{s.splice(s.indexOf(f),1);let C=R[l]?.(...p);He.replace(f,C),s.push(f)}),f};for(let l of t)u.use(l);return u}i(dr,"make");var Ps=i(()=>({events:new Je,objEvents:new Je,root:dr([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new O(1),angle:0,shake:0,transform:new De}}),"initGame");function Ms(t){E.gravity=t?(E.gravity||b(0,1)).unit().scale(t):null}i(Ms,"setGravity");function Gs(){return E.gravity?E.gravity.len():0}i(Gs,"getGravity");function Rs(t){E.gravity=t.unit().scale(E.gravity?E.gravity.len():1)}i(Rs,"setGravityDirection");function Ds(){return E.gravity?E.gravity.unit():b(0,1)}i(Ds,"getGravityDirection");var Bs=ho("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");function gc(t){return t.createBuffer(1,1,44100)}i(gc,"createEmptyAudioBuffer");var Us=i(()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),r=e.createGain();r.connect(e.destination);let n=new ot(gc(e));return e.decodeAudioData(Bs.buffer.slice(0)).then(o=>{n.buf=o}).catch(o=>{console.error("Failed to load burp: ",o)}),{ctx:e,masterNode:r,burpSnd:n}})(),"initAudio");function Fs(t,e={}){let r=new me,n=new Audio(t),o=oe.ctx.createMediaElementSource(n);o.connect(e.connectTo??oe.masterNode);function s(){Z.paused||R.isHidden()&&!ue.backgroundAudio||oe.ctx.resume()}i(s,"resumeAudioCtx");function a(){s(),n.play()}return i(a,"play"),e.paused||a(),n.onended=()=>r.trigger(),{play(){a()},seek(c){n.currentTime=c},stop(){n.pause(),this.seek(0)},set loop(c){n.loop=c},get loop(){return n.loop},set paused(c){c?n.pause():a()},get paused(){return n.paused},time(){return n.currentTime},duration(){return n.duration},set volume(c){n.volume=Ke(c,0,1)},get volume(){return n.volume},set speed(c){n.playbackRate=Math.max(c,0)},get speed(){return n.playbackRate},set detune(c){},get detune(){return 0},onEnd(c){return r.add(c)},then(c){return this.onEnd(c)},connect(c){o.disconnect(),o.connect(c??oe.masterNode)}}}i(Fs,"playMusic");function Jr(t,e={}){if(typeof t=="string"&&k.music[t])return Fs(k.music[t],e);let r=oe.ctx,n=e.paused??!1,o=r.createBufferSource(),s=new me,a=r.createGain(),c=r.createStereoPanner(),u=e.seek??0,m=0,l=0,p=!1;o.loop=!!e.loop,o.detune.value=e.detune??0,o.playbackRate.value=e.speed??1,o.connect(c),o.onended=()=>{v()>=(o.buffer?.duration??Number.POSITIVE_INFINITY)&&s.trigger()},c.pan.value=e.pan??0,c.connect(a),a.connect(e.connectTo??oe.masterNode),a.gain.value=e.volume??1;let f=i(x=>{o.buffer=x.buf,n||(m=r.currentTime,o.start(0,u),p=!0)},"start"),C=ts(t);C instanceof he&&C.onLoad(f);let v=i(()=>{if(!o.buffer)return 0;let x=n?l-m:r.currentTime-m,y=o.buffer.duration;return o.loop?x%y:Math.min(x,y)},"getTime"),g=i(x=>{let y=r.createBufferSource();return y.buffer=x.buffer,y.loop=x.loop,y.playbackRate.value=x.playbackRate.value,y.detune.value=x.detune.value,y.onended=x.onended,y.connect(c),y},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(x){if(n!==x)if(n=x,x)p&&(o.stop(),p=!1),l=r.currentTime;else{o=g(o);let y=l-m;o.start(0,y),p=!0,m=r.currentTime-y,l=0}},get paused(){return n},play(x=0){this.seek(x),this.paused=!1},seek(x){o.buffer?.duration&&(x>o.buffer.duration||(n?(o=g(o),m=l-x):(o.stop(),o=g(o),m=r.currentTime-x,o.start(0,x),p=!0,l=0)))},set speed(x){o.playbackRate.value=x},get speed(){return o.playbackRate.value},set detune(x){o.detune.value=x},get detune(){return o.detune.value},set volume(x){a.gain.value=Math.max(x,0)},get volume(){return a.gain.value},set pan(x){c.pan.value=x},get pan(){return c.pan.value},set loop(x){o.loop=x},get loop(){return o.loop},duration(){return o.buffer?.duration??0},time(){return v()%this.duration()},onEnd(x){return s.add(x)},then(x){return this.onEnd(x)},connect(x){a.disconnect(),a.connect(x??oe.masterNode)}}}i(Jr,"play");function Zr(t){return Jr(oe.burpSnd,t)}i(Zr,"burp");function Ls(t){return t!==void 0&&(oe.masterNode.gain.value=t),oe.masterNode.gain.value}i(Ls,"volume");function en(){R.onHide(()=>{ue.backgroundAudio||oe.ctx.suspend()}),R.onShow(()=>{!ue.backgroundAudio&&!Z.paused&&oe.ctx.resume()}),R.onResize(()=>{if(R.isFullscreen())return;let t=ue.width&&ue.height;t&&!ue.stretch&&!ue.letterbox||(Ce.width=Ce.offsetWidth*We,Ce.height=Ce.offsetHeight*We,tn(),t||(T.frameBuffer.free(),T.frameBuffer=new ct(T.ggl,T.ggl.gl.drawingBufferWidth,T.ggl.gl.drawingBufferHeight),T.width=T.ggl.gl.drawingBufferWidth/We/qt,T.height=T.ggl.gl.drawingBufferHeight/We/qt))}),ue.debug!==!1&&(R.onKeyPress(ue.debugKey??"f1",()=>Z.inspect=!Z.inspect),R.onKeyPress("f2",()=>Z.clearLog()),R.onKeyPress("f8",()=>Z.paused=!Z.paused),R.onKeyPress("f7",()=>{Z.timeScale=rr(Ke(Z.timeScale-.2,0,2),1)}),R.onKeyPress("f9",()=>{Z.timeScale=rr(Ke(Z.timeScale+.2,0,2),1)}),R.onKeyPress("f10",()=>Z.stepFrame())),ue.burp&&R.onKeyPress("b",()=>Zr())}i(en,"initEvents");function Is(t,e={}){let r=E.root.add([Gt(t),rn()]),n=(e.speed||1)*5,o=e.scale||1;r.add([fr($n),zt(0),hr("center"),Yn(n,o),...e.comps??[]]);let s=r.add([fr(Wn),zt(0),hr("center"),gr(),...e.comps??[]]);return s.wait(.4/n,()=>s.use(Yn(n,o))),s.onDestroy(()=>r.destroy()),r}i(Is,"addKaboom");var js=i(function(t,e){if(E.layers)throw Error("Layers can only be assigned once.");let r=t.indexOf(e);if(r==-1)throw Error("The default layer name should be present in the layers list.");E.layers=t,E.defaultLayerIndex=r},"layers");function Yr(t){t.destroy()}i(Yr,"destroy");function Ks(){return E.root}i(Ks,"getTreeRoot");function ks(t,e){E.scenes[t]=e}i(ks,"scene");function Ns(t,...e){if(!E.scenes[t])throw new Error(`Scene not found: ${t}`);E.events.onOnce("frameEnd",()=>{E.events.trigger("sceneLeave",t),R.events.clear(),E.events.clear(),E.objEvents.clear(),[...E.root.children].forEach(r=>{!r.stay||r.scenesToStay&&!r.scenesToStay.includes(t)?E.root.remove(r):r.trigger("sceneEnter",t)}),E.root.clearEvents(),en(),E.cam={pos:null,scale:b(1),angle:0,shake:0,transform:new De},E.scenes[t](...e)}),E.currentScene=t}i(Ns,"go");function Xn(t){return E.events.on("sceneLeave",t)}i(Xn,"onSceneLeave");function _s(){return E.currentScene}i(_s,"getSceneName");function fr(t,e={}){let r=null,n=null,o=null,s=new me;if(!t)throw new Error("Please pass the resource name or data to sprite()");let a=i((u,m,l,p)=>{let f=b(1,1);return l&&p?(f.x=l/(u.width*m.w),f.y=p/(u.height*m.h)):l?(f.x=l/(u.width*m.w),f.y=f.x):p&&(f.y=p/(u.height*m.h),f.x=f.y),f},"calcTexScale"),c=i((u,m)=>{if(!m)return;let l=m.frames[0].clone();e.quad&&(l=l.scale(e.quad));let p=a(m.tex,l,e.width,e.height);u.width=m.tex.width*l.w*p.x,u.height=m.tex.height*l.h*p.y,e.anim&&u.play(e.anim),r=m,s.trigger(r)},"setSpriteData");return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new X(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},set sprite(u){let m=_t(u);m&&m.onLoad(l=>c(this,l))},get animFrame(){if(!r||!n||o===null)return this.frame;let u=r.anims[n.name];return typeof u=="number"?u:this.frame-Math.min(u.from,u.to)},draw(){if(!r)return;let u=r.frames[this.frame??0];if(!u)throw new Error(`Frame not found: ${this.frame??0}`);if(r.slice9){let{left:m,right:l,top:p,bottom:f}=r.slice9,C=r.tex.width*u.w,v=r.tex.height*u.h,g=this.width-m-l,x=this.height-p-f,y=m/C,G=l/C,B=1-y-G,D=p/v,U=f/v,h=1-D-U,A=[de(0,0,y,D),de(y,0,B,D),de(y+B,0,G,D),de(0,D,y,h),de(y,D,B,h),de(y+B,D,G,h),de(0,D+h,y,U),de(y,D+h,B,U),de(y+B,D+h,G,U),de(0,0,m,p),de(m,0,g,p),de(m+g,0,l,p),de(0,p,m,x),de(m,p,g,x),de(m+g,p,l,x),de(0,p+x,m,f),de(m,p+x,g,f),de(m+g,p+x,l,f)];for(let S=0;S<9;S++){let P=A[S],V=A[S+9];Rt(Object.assign(Ue(this),{pos:V.pos(),tex:r.tex,quad:u.scale(P),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:V.w,height:V.h}))}}else Rt(Object.assign(Ue(this),{tex:r.tex,quad:u.scale(this.quad??new X(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let u=_t(t);u?u.onLoad(m=>c(this,m)):Ht(()=>c(this,_t(t).data))},update(){if(!r||!n||o===null)return;let u=r.anims[n.name];if(typeof u=="number"){this.frame=u;return}if(u.speed===0)throw new Error("Sprite anim speed cannot be 0");n.timer+=Me()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,this.frame+=o,(this.frame<Math.min(u.from,u.to)||this.frame>Math.max(u.from,u.to))&&(n.loop?n.pingpong?(this.frame-=o,o*=-1,this.frame+=o):this.frame=u.from:n.pingpong?o===Math.sign(u.to-u.from)?(this.frame=u.to,o*=-1,this.frame+=o):(this.frame=u.from,n.onEnd(),this.stop()):(this.frame=u.to,n.onEnd(),this.stop())))},play(u,m={}){if(!r){s.add(()=>this.play(u,m));return}let l=r.anims[u];if(l===void 0)throw new Error(`Anim not found: ${u}`);n&&this.stop(),n=typeof l=="number"?{name:u,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:i(()=>{},"onEnd")}:{name:u,timer:0,loop:m.loop??l.loop??!1,pingpong:m.pingpong??l.pingpong??!1,speed:m.speed??l.speed??10,onEnd:m.onEnd??(()=>{})},o=typeof l=="number"?null:l.from<l.to?1:-1,this.frame=typeof l=="number"?l:l.from,this.trigger("animStart",u)},stop(){if(!n)return;let u=n.name;n=null,this.trigger("animEnd",u)},numFrames(){return r?.frames.length??0},getCurAnim(){return n},curAnim(){return n?.name},getAnim(u){return r?.anims[u]??null},hasAnim(u){return!!this.getAnim(u)},onAnimEnd(u){return this.on("animEnd",u)},onAnimStart(u){return this.on("animStart",u)},renderArea(){return new te(b(0),this.width,this.height)},inspect(){return typeof t=="string"?`sprite: "${t}"`:null}}}i(fr,"sprite");function Hs(t,e={}){function r(o){let s=$e(Object.assign(Ue(o),{text:o.text+"",size:o.textSize,font:o.font,width:e.width&&o.width,align:o.align,letterSpacing:o.letterSpacing,lineSpacing:o.lineSpacing,transform:o.textTransform,styles:o.textStyles}));return e.width||(o.width=s.width/(o.scale?.x||1)),o.height=s.height/(o.scale?.y||1),s}i(r,"update");let n={id:"text",set text(o){t=o,r(this),this.renderedText=nn(t).text},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,renderedText:t?nn(t).text:"",add(){Ht(()=>r(this))},draw(){Xe(r(this))},renderArea(){return new te(b(0),this.width,this.height)}};return r(n),n}i(Hs,"text");function qs(t,e){return{id:"rect",width:t,height:e,draw(){mt(Object.assign(Ue(this),{width:this.width,height:this.height}))},renderArea(){return new te(b(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}i(qs,"uvquad");function zs(t={}){let e=null,r=null,n=null,o=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return r&&n?r[n]:null},getPath(){return r?r.slice():null},getTarget(){return e},isNavigationFinished(){return r?n===null:!0},isTargetReachable(){return r!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(s){e=s,r=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),n=r?0:null,r&&n!==null?(o||(o=this.getLevel().onNavigationMapChanged(()=>{e&&r&&n!==null&&(r=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),r?(n=0,this.trigger("navigationNext",this,r[n])):(n=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>o?.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,r[n])):this.trigger("navigationEnded",this)},update(){if(e&&r&&n!==null){if(this.pos.sdist(r[n])<2)if(n===r.length-1){this.pos=e.clone(),n=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else n++,this.trigger("navigationNext",this,r[n]);this.moveTo(r[n],this.agentSpeed)}},onNavigationStarted(s){return this.on("navigationStarted",s)},onNavigationNext(s){return this.on("navigationNext",s)},onNavigationEnded(s){return this.on("navigationEnded",s)},onTargetReached(s){return this.on("targetReached",s)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(r)})}}}i(zs,"agent");function Ys(t){let e=t.graph;return{id:"pathfinder",require:["pos"],navigateTo(r){return this.graph?.getWaypointPath(this.pos,r,t.navigationOpt)},get graph(){if(e)return e;let r=this.parent;for(;r;){if(r.is("pathfinderMap"))return r.graph;r=r.parent}},set graph(r){e=r}}}i(Ys,"pathfinder");function Ws(t={}){let e=t.waypoints,r=t.speed||100,n=t.endBehavior||"stop",o=0,s=e!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return r},set patrolSpeed(a){r=a},get waypoints(){return e},set waypoints(a){e=a,o=0,s=!1},get nextLocation(){return e?e[o]:void 0},update(){let a=this.nextLocation;if(!(!e||!a||s)&&(this.moveTo(a,r),this.pos.sdist(a)<9))switch(n){case"loop":o=(o+1)%e.length;break;case"ping-pong":o=o+1,o==e.length&&(e.reverse(),o=0);break;case"stop":o=Math.min(o+1,e.length-1),o==e.length-1&&(s=!0,this.trigger("patrolFinished"));break}},onPatrolFinished(a){return this.on("patrolFinished",a)}}}i(Ws,"patrol");function $s(t,e={}){let r=typeof t=="function"?t:()=>E.root.query(t),n=e.checkFrequency||1,o=typeof e.direction=="number"?O.fromAngle(e.direction):e.direction,s=0;return{id:"sentry",require:["pos"],direction:typeof e.direction=="number"?O.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(a){this.direction=a!==void 0?O.fromAngle(a):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(a,c,u){let m=(typeof c=="number"?O.fromAngle(c):c)||o,l=u||e.fieldOfView;if(!m||!l||l>=360)return!0;let p=l/2;return a.pos&&m.angleBetween(a.pos.sub(this.pos))<=p},hasLineOfSight(a){let c=Nr(this.pos,a.pos.sub(this.pos),e.raycastExclude);return c!=null&&c.object===a},update(){if(s+=Me(),s>n){s-=n;let a=r();if(a.length&&o&&this.fieldOfView&&this.fieldOfView<360){let c=this.fieldOfView/2;a=a.filter(u=>u.pos&&o.angleBetween(u.pos.sub(this.pos))<=c)}a.length&&e.lineOfSight&&(a=a.filter(c=>c.pos&&this.hasLineOfSight(c))),a.length>0&&(this.spotted=a,this.trigger("objectSpotted",a))}},onObjectsSpotted(a){return this.on("objectSpotted",a)}}}i($s,"sentry");function $r(t={}){let e=b(0),r=t.isObstacle??!1,n=t.cost??0,o=t.edges??[],s=i(()=>{let c={left:1,top:2,right:4,bottom:8};return o.map(u=>c[u]||0).reduce((u,m)=>u|m,0)},"getEdgeMask"),a=s();return{id:"tile",tilePosOffset:t.offset??b(0),set tilePos(c){let u=this.getLevel();e=c.clone(),this.pos=b(this.tilePos.x*u.tileWidth(),this.tilePos.y*u.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(c){r!==c&&(r=c,this.getLevel().invalidateNavigationMap())},get isObstacle(){return r},set cost(c){n!==c&&(n=c,this.getLevel().invalidateNavigationMap())},get cost(){return n},set edges(c){o=c,a=s(),this.getLevel().invalidateNavigationMap()},get edges(){return o},get edgeMask(){return a},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(b(-1,0))},moveRight(){this.tilePos=this.tilePos.add(b(1,0))},moveUp(){this.tilePos=this.tilePos.add(b(0,-1))},moveDown(){this.tilePos=this.tilePos.add(b(0,1))}}}i($r,"tile");var br=class{static{i(this,"AnimateChannel")}name;duration;loops;direction;easing;interpolation;isFinished;timing;easings;relative;constructor(e,r,n){this.name=e,this.duration=r.duration,this.loops=r.loops||0,this.direction=r.direction||"forward",this.easing=r.easing||ut.linear,this.interpolation=r.interpolation||"linear",this.isFinished=!1,this.timing=r.timing,this.easings=r.easings,this.relative=n}update(e,r){return!0}getLowerKeyIndexAndRelativeTime(e,r,n){let o=r-1,s=e/this.duration;if(this.loops!==0&&s>=this.loops)return[o,0];let a=Math.trunc(s);if(s-=a,(this.direction=="reverse"||this.direction=="ping-pong"&&a&1)&&(s=1-s),n){let c=0;for(;n[c+1]!==void 0&&n[c+1]<s;)c++;return c>=o?[o,0]:[c,(s-n[c])/(n[c+1]-n[c])]}else{let c=Math.floor((r-1)*s);return[c,(s-c/o)*o]}}setValue(e,r,n){if(this.relative)switch(r){case"pos":e.pos=e.base.pos.add(n);break;case"angle":e.angle=e.base.angle+n;break;case"scale":e.scale=e.base.scale.scale(n);break;case"opacity":e.opacity=e.base.opacity*n;break;default:e[r]=n}else e[r]=n}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!=="forward"&&(e.direction=this.direction),this.easing!=ut.linear&&(e.easing=this.easing.name),this.interpolation!=="linear"&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(r=>this.easing.name)),e}};function Xs(t,e){return e.add(e.sub(t))}i(Xs,"reflect");var Qn=class extends br{static{i(this,"AnimateChannelNumber")}keys;constructor(e,r,n,o){super(e,n,o),this.keys=r}update(e,r){let[n,o]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(o==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[n]);else{let s=this.easings?this.easings[n]:this.easing;this.setValue(e,this.name,Oe(this.keys[n],this.keys[n+1],s(o)))}return o==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},Jn=class extends br{static{i(this,"AnimateChannelVec2")}keys;curves;dcurves;constructor(e,r,n,o,s){if(super(e,n,o),this.keys=r,this.interpolation==="spline"){this.curves=[],s&&(this.dcurves=[]);for(let a=0;a<this.keys.length-1;a++){let c=this.keys[a],u=a+1,m=this.keys[u],l=a>0?this.keys[a-1]:Xs(m,c),p=u<this.keys.length-1?this.keys[u+1]:Xs(c,m);this.curves.push(jt(l,c,m,p)),s&&this.dcurves?.push(jt(l,c,m,p,ko))}}}update(e,r){let[n,o]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(o==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[n]);else{let s=this.easings?this.easings[n]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[n].lerp(this.keys[n+1],s(o)));break;case"slerp":this.setValue(e,this.name,this.keys[n].slerp(this.keys[n+1],s(o)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[n](s(o))),this.dcurves&&this.setValue(e,"angle",this.dcurves[n](s(o)).angle());break}}}return o==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},Zn=class extends br{static{i(this,"AnimateChannelColor")}keys;constructor(e,r,n,o){super(e,n,o),this.keys=r}update(e,r){let[n,o]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(o==0||this.interpolation=="none")this.setValue(e,this.name,this.keys[n]);else{let s=this.easings?this.easings[n]:this.easing;this.setValue(e,this.name,this.keys[n].lerp(this.keys[n+1],s(o)))}return o==1}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}};function Qs(t={}){let e=[],r=0,n=!1;return{id:"animate",require:t.followMotion?["rotate"]:void 0,base:{pos:b(0,0),angle:0,scale:b(1,1),opacity:1},add(){t.relative&&(this.is("pos")&&(this.base.pos=this.pos.clone()),this.is("rotate")&&(this.base.angle=this.angle),this.is("scale")&&(this.base.scale=this.scale),this.is("opacity")&&(this.base.opacity=this.opacity))},update(){let o=!0,s;r+=Me();for(let a of e)s=a.update(this,r),s&&!a.isFinished&&(a.isFinished=!0,this.trigger("animateChannelFinished",a.name)),o&&=s;o&&!n&&(n=!0,this.trigger("animateFinished"))},animate(o,s,a){n=!1,this.unanimate(o),typeof s[0]=="number"?e.push(new Qn(o,s,a,t.relative||!1)):s[0]instanceof O?e.push(new Jn(o,s,a,t.relative||!1,o==="pos"&&(t.followMotion||!1))):s[0]instanceof _&&e.push(new Zn(o,s,a,t.relative||!1))},unanimate(o){let s=e.findIndex(a=>a.name===o);s>=0&&e.splice(s,1)},unanimateAll(){e.splice(0,e.length)},onAnimateFinished(o){return this.on("animateFinished",o)},onAnimateChannelFinished(o){return this.on("animateChannelFinished",o)},serializeAnimationChannels(){return e.reduce((o,s)=>(o[s.name]=s.serialize(),o),{})},serializeAnimationOptions(){let o={};return t.followMotion&&(o.followMotion=!0),t.relative&&(o.relative=!0),o}}}i(Qs,"animate");function eo(t,e){let r={name:t.name};return t.is("animate")&&(r.channels=t.serializeAnimationChannels(),Object.assign(r,t.serializeAnimationOptions())),t.children.length>0&&(r.children=t.children.filter(n=>n.is("named")).map(n=>eo(n,n.name))),r}i(eo,"serializeAnimation");function Yn(t=2,e=1){let r=0;return{require:["scale"],update(){let n=Math.sin(r*t)*e;n<0&&this.destroy(),this.scale=b(n),r+=Me()}}}i(Yn,"boom");var Js=i((t={followMouse:!0})=>{let e=!1;return{id:"fakeMouse",require:["pos"],get isPressed(){return e},update(){t.followMouse&&F.isMouseMoved()&&(this.pos=Yt())},press(){e=!0,this.trigger("press")},release(){e=!1,this.trigger("release")},onPress(r){this.on("press",r)},onRelease(r){this.on("release",r)}}},"fakeMouse");function Zs(t,e){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(r=1){this.setHP(t-r),this.trigger("hurt",r)},heal(r=1){let n=t;this.setHP(t+r),this.trigger("heal",t-n)},hp(){return t},maxHP(){return e??null},setMaxHP(r){e=r},setHP(r){t=e?Math.min(e,r):r,t<=0&&this.trigger("death")},onHurt(r){return this.on("hurt",r)},onHeal(r){return this.on("heal",r)},onDeath(r){return this.on("death",r)},inspect(){return`health: ${t}`}}}i(Zs,"health");function ea(t,e={}){if(t==null)throw new Error("lifespan() requires time");let r=e.fade??0;return{id:"lifespan",require:["opacity"],async add(){await E.root.wait(t),this.opacity=this.opacity??1,r>0&&await E.root.tween(this.opacity,0,r,n=>this.opacity=n,ut.linear),this.destroy()}}}i(ea,"lifespan");function ta(t){return{id:"named",name:t}}i(ta,"named");function ra(t,e,r){if(!t)throw new Error("state() requires an initial state");let n={};function o(u){n[u]||(n[u]={enter:new me,end:new me,update:new me,draw:new me})}i(o,"initStateEvents");function s(u,m,l){return o(m),n[m][u].add(l)}i(s,"on");function a(u,m,...l){o(m),n[m][u].trigger(...l)}i(a,"trigger");let c=!1;return{id:"state",state:t,enterState(u,...m){if(c=!0,e&&!e.includes(u))throw new Error(`State not found: ${u}`);let l=this.state;if(r){if(!r?.[l])return;let p=typeof r[l]=="string"?[r[l]]:r[l];if(!p.includes(u))throw new Error(`Cannot transition state from "${l}" to "${u}". Available transitions: ${p.map(f=>`"${f}"`).join(", ")}`)}a("end",l,...m),this.state=u,a("enter",u,...m),a("enter",`${l} -> ${u}`,...m)},onStateTransition(u,m,l){return s("enter",`${u} -> ${m}`,l)},onStateEnter(u,m){return s("enter",u,m)},onStateUpdate(u,m){return s("update",u,m)},onStateDraw(u,m){return s("draw",u,m)},onStateEnd(u,m){return s("end",u,m)},update(){c||(a("enter",t),c=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return`state: ${this.state}`}}}i(ra,"state");function rn(t){return{id:"stay",stay:!0,scenesToStay:t}}i(rn,"stay");function na(t=!0,e){let r,n;return{id:"textInput",hasFocus:t,require:["text"],add(){r=F.onCharInput(o=>{this.hasFocus&&(!e||this.text.length<e)&&(F.isKeyDown("shift")?this.text+=o.toUpperCase():this.text+=o)}),n=F.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.text=this.text.slice(0,-1))})},destroy(){r.cancel(),n.cancel()}}}i(na,"textInput");function gr(){return{id:"timer",wait(t,e){let r=[];e&&r.push(e);let n=0,o=this.onUpdate(()=>{n+=F.dt(),n>=t&&(r.forEach(s=>s()),o.cancel())});return{get paused(){return o.paused},set paused(s){o.paused=s},cancel:o.cancel,onEnd(s){r.push(s)},then(s){return this.onEnd(s),this}}},loop(t,e){let r=null,n=i(()=>{r=this.wait(t,n),e()},"newAction");return r=this.wait(0,n),{get paused(){return r?.paused??!1},set paused(o){r&&(r.paused=o)},cancel:i(()=>r?.cancel(),"cancel")}},tween(t,e,r,n,o=ut.linear){let s=0,a=[],c=this.onUpdate(()=>{s+=F.dt();let u=Math.min(s/r,1);n(Oe(t,e,o(u))),u===1&&(c.cancel(),n(e),a.forEach(m=>m()))});return{get paused(){return c.paused},set paused(u){c.paused=u},onEnd(u){a.push(u)},then(u){return this.onEnd(u),this},cancel(){c.cancel()},finish(){c.cancel(),n(e),a.forEach(u=>u())}}}}}i(gr,"timer");var to=0;function ro(){return to>0}i(ro,"usesArea");var pt=null,oa=!1;function ia(t={}){let e={},r=new Set;return!pt&&!oa&&(pt=F.get("fakeMouse")[0],oa=!0),{id:"area",collisionIgnore:t.collisionIgnore??[],restitution:t.restitution,friction:t.friction,add(){to++,this.area.cursor&&this.onHover(()=>R.setCursor(this.area.cursor)),this.onCollideUpdate((n,o)=>{if(!n.id)throw new Error("area() requires the object to have an id");e[n.id]||this.trigger("collide",n,o),o&&(e[n.id]=o,r.add(n.id))})},destroy(){to--},fixedUpdate(){for(let n in e)r.has(Number(n))||(this.trigger("collideEnd",e[n].target),delete e[n]);r.clear()},drawInspect(){let n=this.localArea();F.pushTransform(),F.pushTranslate(this.area.offset);let o={outline:{width:4/on(),color:W(0,0,255)},anchor:this.anchor,fill:!1,fixed:nt(this)};n instanceof F.Rect?F.drawRect({...o,pos:n.pos,width:n.width*this.area.scale.x,height:n.height*this.area.scale.y}):n instanceof F.Polygon?F.drawPolygon({...o,pts:n.pts,scale:this.area.scale}):n instanceof F.Circle&&F.drawCircle({...o,pos:n.center,radius:n.radius}),F.popTransform()},area:{shape:t.shape??null,scale:t.scale?b(t.scale):b(1),offset:t.offset??b(0),cursor:t.cursor??null},isClicked(){return pt?pt.isPressed&&this.isHovering():R.isMousePressed()&&this.isHovering()},isHovering(){if(pt){let o=nt(this)?pt.pos:F.toWorld(pt.pos);return this.hasPoint(o)}let n=nt(this)?F.mousePos():F.toWorld(F.mousePos());return this.hasPoint(n)},checkCollision(n){if(!n.id)throw new Error("checkCollision() requires the object to have an id");return e[n.id]??null},getCollisions(){return Object.values(e)},isColliding(n){if(!n.id)throw new Error("isColliding() requires the object to have an id");return!!e[n.id]},isOverlapping(n){if(!n.id)throw new Error("isOverlapping() requires the object to have an id");let o=e[n.id];return o&&o.hasOverlap()},onClick(n,o="left"){pt&&pt.onPress(()=>{this.isHovering()&&n()});let s=F.onMousePress(o,()=>{this.isHovering()&&n()});return this.onDestroy(()=>s.cancel()),s},onHover(n){let o=!1;return this.onUpdate(()=>{o?o=this.isHovering():this.isHovering()&&(o=!0,n())})},onHoverUpdate(n){return this.onUpdate(()=>{this.isHovering()&&n()})},onHoverEnd(n){let o=!1;return this.onUpdate(()=>{o?this.isHovering()||(o=!1,n()):o=this.isHovering()})},onCollide(n,o){if(typeof n=="function"&&o===void 0)return this.on("collide",n);if(typeof n=="string")return this.onCollide((s,a)=>{s.is(n)&&o?.(s,a)});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(n,o){if(typeof n=="function"&&o===void 0)return this.on("collideUpdate",n);if(typeof n=="string")return this.on("collideUpdate",(s,a)=>s.is(n)&&o?.(s,a));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(n,o){if(typeof n=="function"&&o===void 0)return this.on("collideEnd",n);if(typeof n=="string")return this.on("collideEnd",s=>s.is(n)&&o?.(s));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(n){return this.worldArea().contains(n)},resolveCollision(n){let o=this.checkCollision(n);o&&!o.resolved&&(this.pos=this.pos.add(o.displacement),o.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let n=this.localArea(),o=this.transform.clone().translateSelfV(this.area.offset).scaleSelfV(b(this.area.scale??1));if(n instanceof F.Rect){let s=qe(this.anchor||ht).add(1,1).scale(-.5).scale(n.width,n.height);o.translateSelfV(s)}return n.transform(o)},screenArea(){let n=this.worldArea();return nt(this)?n:n.transform(E.cam.transform)},inspect(){return this.area.scale?.x==this.area.scale?.y?`area: ${this.area.scale?.x?.toFixed(1)}x`:`area: (${this.area.scale?.x?.toFixed(1)}x, ${this.area.scale.y?.toFixed(1)}y)`}}}i(ia,"area");function sa(t={}){let e=null,r=null,n=!1,o=b(0),s=null,a=null,c;return{id:"body",require:["pos"],vel:b(0),damping:t.damping??0,jumpForce:t.jumpForce??ji,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(s=this.pos.clone(),a=this.pos.clone(),c=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate((u,m)=>{if(!m||!u.is("body")||m.resolved)return;this.trigger("beforePhysicsResolve",m);let l=m.reverse();if(u.trigger("beforePhysicsResolve",l),!(m.resolved||l.resolved)&&!(this.isStatic&&u.isStatic)){if(!this.isStatic&&!u.isStatic){let p=this.mass+u.mass;this.pos=this.pos.add(m.displacement.scale(u.mass/p)),u.pos=u.pos.add(m.displacement.scale(-this.mass/p)),rt(this,this.transform),rt(u,u.transform)}else{let p=!this.isStatic&&u.isStatic?m:m.reverse();p.source.pos=p.source.pos.add(p.displacement),rt(p.source,p.source.transform)}m.resolved=!0,this.trigger("physicsResolve",m),u.trigger("physicsResolve",m.reverse())}}),this.onPhysicsResolve(u=>{if(E.gravity)if(u.isBottom()&&this.isFalling()){let C=e;e=u.target,C!=e&&(r=u.target.pos),n?n=!1:C||(this.trigger("ground",e),u.target.trigger("land",this))}else u.isTop()&&this.isJumping()&&(this.trigger("headbutt",u.target),u.target.trigger("headbutted",this));let m=Math.max(u.source.restitution||0,u.target.restitution||0),l=Math.sqrt((u.source.friction||0)*(u.target.friction||0)),p=this.vel.project(u.normal),f=this.vel.sub(p);this.vel.dot(u.normal)<0&&(this.vel=f.sub(p.scale(m))),l!=0&&(this.vel=this.vel.sub(f.scale(l)))}))},update(){e&&this.isColliding(e)&&e.exists()&&e.is("body")&&(r&&!e.pos.eq(r)&&t.stickToPlatform!==!1&&this.moveBy(e.pos.sub(r)),r=e.pos);let u=F.restDt();u&&(this.pos.x==c.x&&(this.pos.x=F.lerp(s.x,a.x,u/F.fixedDt()),c.x=this.pos.x),this.pos.y==c.y&&(this.pos.y=F.lerp(s.y,a.y,u/F.fixedDt()),c.y=this.pos.y))},fixedUpdate(){if(s&&(this.pos.x==c.x&&(this.pos.x=s.x),this.pos.y==c.y&&(this.pos.y=s.y),s=null),E.gravity&&!this.isStatic){n&&(e=null,r=null,this.trigger("fallOff"),n=!1),e&&(!this.isColliding(e)||!e.exists()||!e.is("body"))&&(n=!0);let m=this.vel.clone();this.vel=this.vel.add(E.gravity.scale(this.gravityScale*F.dt()));let l=t.maxVelocity??Ki;this.vel.slen()>l*l&&(this.vel=this.vel.unit().scale(l)),m.dot(E.gravity)<0&&this.vel.dot(E.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=o.x*F.dt(),this.vel.y+=o.y*F.dt(),this.vel.x*=1/(1+this.damping*F.dt()),this.vel.y*=1/(1+this.damping*F.dt()),this.move(this.vel),F.restDt()){s=this.pos.clone();let m=this.vel.add(o.scale(F.dt()));a=this.pos.add(m.scale(F.dt())),c=this.pos.clone()}o.x=0,o.y=0},onPhysicsResolve(u){return this.on("physicsResolve",u)},onBeforePhysicsResolve(u){return this.on("beforePhysicsResolve",u)},curPlatform(){return e},isGrounded(){return e!==null},isFalling(){return this.vel.dot(F.getGravityDirection())>0},isJumping(){return this.vel.dot(F.getGravityDirection())<0},applyImpulse(u){this.vel=this.vel.add(u)},addForce(u){o.x+=u.x/this.mass,o.y+=u.y/this.mass},jump(u){e=null,r=null,this.vel=F.getGravityDirection().scale(-u||-this.jumpForce)},onGround(u){return this.on("ground",u)},onFall(u){return this.on("fall",u)},onFallOff(u){return this.on("fallOff",u)},onHeadbutt(u){return this.on("headbutt",u)},onLand(u){return this.on("land",u)},onHeadbutted(u){return this.on("headbutted",u)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}i(sa,"body");function aa(t=2){let e=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(r){e<=0||(e<this.numJumps&&this.trigger("doubleJump"),e--,this.jump(r))},onDoubleJump(r){return this.on("doubleJump",r)},inspect(){return`jumpsLeft: ${e}`}}}i(aa,"doubleJump");function ua(t){return{id:"surfaceEffector",require:["area"],speed:t.speed,speedVariation:t.speedVariation??0,forceScale:t.speedVariation??.9,add(){this.onCollideUpdate("body",(e,r)=>{let n=r?.normal.normal(),o=e.vel.project(n),a=n?.scale(this.speed)?.sub(o);e.addForce(a?.scale(e.mass*this.forceScale))})}}}i(ua,"surfaceEffector");function ca(t){return{id:"areaEffector",require:["area"],useGlobalAngle:t.useGlobalAngle||!1,forceAngle:t.forceAngle,forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,linearDrag:t.linearDrag??0,add(){this.onCollideUpdate("body",(e,r)=>{let o=O.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(o),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}i(ca,"areaEffector");function la(t){return{id:"pointEffector",require:["area","pos"],forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,distanceScale:t.distanceScale??1,forceMode:t.forceMode||"inverseLinear",linearDrag:t.linearDrag??0,add(){this.onCollideUpdate("body",(e,r)=>{let n=this.pos.sub(e.pos),o=n.len(),s=o*this.distanceScale/10,a=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/s:1/s**2,c=n.scale(this.forceMagnitude*a/o);e.addForce(c),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}i(la,"pointEffector");function ma(t){return{id:"constantForce",require:["body"],force:t.force,update(){this.force&&this.addForce(this.force)}}}i(ma,"constantForce");function pa(t={}){return t.ignoreSides??=[O.UP],t.shouldCollide??=(e,r)=>t.ignoreSides?.findIndex(n=>n.sdist(r)<Number.EPSILON)==-1,{id:"platformEffector",require:["area","body"],platformIgnore:new Set,add(){this.onBeforePhysicsResolve(e=>{this.platformIgnore.has(e.target)?e.preventResolution():t.shouldCollide.call(this,e.target,e.normal)||(e.preventResolution(),this.platformIgnore.add(e.target))}),this.onCollideEnd(e=>{this.platformIgnore.delete(e)})}}}i(pa,"platformEffector");function da(t){return{id:"buoyancyEffector",require:["area"],surfaceLevel:t.surfaceLevel,density:t.density??1,linearDrag:t.linearDrag??1,angularDrag:t.angularDrag??.2,flowAngle:t.flowAngle??0,flowMagnitude:t.flowMagnitude??0,flowVariation:t.flowVariation??0,add(){this.onCollideUpdate("body",(e,r)=>{let n=e,o=n.worldArea(),s=o instanceof pe?o:new pe(o.bbox().points()),[a,c]=s.cut(b(-100,this.surfaceLevel),b(100,this.surfaceLevel));a&&(this.applyBuoyancy(n,a),this.applyDrag(n,a)),this.flowMagnitude&&n.addForce(O.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,r){let n=this.density*r.area(),o=b(0,1).scale(-n);e.addForce(o)},applyDrag(e,r){let n=e.vel,o=this.density*this.linearDrag,s=n.scale(-o);e.addForce(s)}}}i(da,"buoyancyEffector");function hr(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}i(hr,"anchor");function Wr(){return{id:"fixed",fixed:!0}}i(Wr,"fixed");function fa(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:e??b(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}i(fa,"follow");function ha(t){let e=E.layers?.indexOf(t);return{id:"layer",get layerIndex(){return e??null},get layer(){return e?E.layers?.[e]??null:null},set layer(r){if(e=E.layers?.indexOf(r),e==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}i(ha,"layer");function ga(t,e){let r=typeof t=="number"?O.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(e))}}}i(ga,"move");function ba(t={}){let e=t.distance??Ii,r=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let n=this.screenPos();if(!n)return!1;let o=new te(b(0),F.width(),F.height());return!F.testRectPoint(o,n)&&o.sdistToPoint(n)>e*e},onExitScreen(n){return this.on("exitView",n)},onEnterScreen(n){return this.on("enterView",n)},update(){this.isOffScreen()?(r||(this.trigger("exitView"),r=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(r&&(this.trigger("enterView"),r=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}i(ba,"offscreen");function Gt(...t){return{id:"pos",pos:b(...t),moveBy(...e){this.pos=this.pos.add(b(...e))},move(...e){this.moveBy(b(...e).scale(F.dt()))},moveTo(...e){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.moveTo(b(e[0],e[1]),e[2]);let r=e[0],n=e[1];if(n===void 0){this.pos=b(r);return}let o=r.sub(this.pos);if(o.len()<=n*F.dt()){this.pos=b(r);return}this.move(o.unit().scale(n))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.transformPoint(this.pos,b()):this.pos},toWorld(e){return this.parent?this.parent.transform.transformPoint(this.pos.add(e),b()):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.inverse.transformPoint(e,b()).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let r=this.worldPos();return r?nt(this)?r:F.toScreen(r):null}},toScreen(e){let r=this.toWorld(e);return nt(this)?r:F.toScreen(r)},fromScreen(e){return nt(this)?this.fromWorld(e):this.fromWorld(F.toWorld(e))},toOther(e,r){return e.fromWorld(this.toWorld(r))},fromOther(e,r){return e.toOther(this,r)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){F.drawCircle({color:F.rgb(255,0,0),radius:4/on()})}}}i(Gt,"pos");function ya(t){return{id:"rotate",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}i(ya,"rotate");function zt(...t){if(t.length===0)return zt(1);let e=b(...t);return{id:"scale",set scale(r){if(!(r instanceof O))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");e=b(r)},get scale(){return e},scaleTo(...r){e=b(...r)},scaleBy(...r){e=e.scale(b(...r))},inspect(){return e.x==e.y?`scale: ${e.x.toFixed(1)}x`:`scale: (${e.x.toFixed(1)}x, ${e.y.toFixed(1)}y)`}}}i(zt,"scale");function xa(t){return{id:"z",z:t,inspect(){return`z: ${this.z}`}}}i(xa,"z");function Se(t){t!==void 0&&(t.x===0&&t.y===0||T.transform.translateSelfV(t))}i(Se,"pushTranslateV");function tt(t,e){t===0&&e===0||T.transform.translateSelf(t,e)}i(tt,"pushTranslate");function Ee(){T.transformStack[++T.transformStackIndex].setMat23(T.transform)}i(Ee,"pushTransform");function va(t){T.transform.setMat23(t)}i(va,"pushMatrix");function lt(t){t!==void 0&&(t.x===1&&t.y===1||T.transform.scaleSelfV(t))}i(lt,"pushScaleV");function et(t){t&&T.transform.rotateSelf(t)}i(et,"pushRotate");function ve(){T.transformStackIndex>=0&&T.transform.setMat23(T.transformStack[T.transformStackIndex--])}i(ve,"popTransform");function Te(){T.renderer.flush()}i(Te,"flush");function ge(){return T.width}i(ge,"width");function ye(){return T.height}i(ye,"height");function on(){return(T.viewport.width+T.viewport.height)/(T.width+T.height)}i(on,"getViewportScale");function Ca(t){return new O(t.x*T.viewport.width/T.width,t.y*T.viewport.height/T.height)}i(Ca,"contentToView");function yc(t){return new O((t.x-T.viewport.x)*ge()/T.viewport.width,(t.y-T.viewport.y)*ye()/T.viewport.height)}i(yc,"windowToContent");function Yt(){return yc(R.mousePos())}i(Yt,"mousePos");function Mt(){return b(ge()/2,ye()/2)}i(Mt,"center");var Dt=new O;function Ne(t,e,r=!1,n,o,s){let a=n??T.defTex,c=o??T.defShader,u=Ji(c);if(!u||u instanceof he)return;let m=T.fixed||r?T.transform:E.cam.transform.mul(T.transform),l=t.pos.length/2,p=new Array(l*8),f=ge(),C=ye(),v=0;for(let g=0;g<l;g++)Dt.x=t.pos[g*2],Dt.y=t.pos[g*2+1],bi(m.transformPoint(Dt,Dt),f,C,Dt),p[v++]=Dt.x,p[v++]=Dt.y,p[v++]=t.uv[g*2],p[v++]=t.uv[g*2+1],p[v++]=t.color[g*3]/255,p[v++]=t.color[g*3+1]/255,p[v++]=t.color[g*3+2]/255,p[v++]=t.opacity[g];T.renderer.push(T.ggl.gl.TRIANGLES,p,e,u,a,s)}i(Ne,"drawRaw");function ze(t){if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let e=t.pts.length;if(!(e<3)){if(Ee(),Se(t.pos),lt(t.scale),et(t.angle),Se(t.offset),t.fill!==!1){let r=t.color??_.WHITE,n={pos:new Array(t.pts.length*2),uv:new Array(t.pts.length*2),color:new Array(t.pts.length*3),opacity:new Array(t.pts.length)};for(let s=0;s<t.pts.length;s++)n.pos[s*2]=t.pts[s].x,n.pos[s*2+1]=t.pts[s].y;if(t.uv)for(let s=0;s<t.uv.length;s++)n.uv[s*2]=t.uv[s].x,n.uv[s*2+1]=t.uv[s].y;else n.uv.fill(0);if(t.colors)for(let s=0;s<t.colors.length;s++)n.color[s*3]=t.colors[s].r,n.color[s*3+1]=t.colors[s].g,n.color[s*3+2]=t.colors[s].b;else for(let s=0;s<t.pts.length;s++)n.color[s*3]=r.r,n.color[s*3+1]=r.g,n.color[s*3+2]=r.b;n.opacity.fill(t.opacity??1);let o;t.triangulate?o=Pr(t.pts).map(a=>a.map(c=>t.pts.indexOf(c))).flat():o=[...Array(e-2).keys()].map(s=>[0,s+1,s+2]).flat(),Ne(n,t.indices??o,t.fixed,t.uv?t.tex:T.defTex,t.shader,t.uniform??void 0)}t.outline&&Wt({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity??t.outline.opacity}),ve()}}i(ze,"drawPolygon");function Nt(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(t.radiusX===0||t.radiusY===0)return;let e=t.start??0,r=t.end??360,n=qe(t.anchor??"center").scale(new O(-t.radiusX,-t.radiusY)),o=Et(n,t.radiusX,t.radiusY,e,r,t.resolution);o.unshift(n);let s=Object.assign({},t,{pts:o,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(o.length-1).fill(t.gradient[1])]}:{}});if(r-e>=360&&t.outline){t.fill!==!1&&ze(Object.assign({},s,{outline:null})),ze(Object.assign({},s,{pts:o.slice(1),fill:!1}));return}ze(s)}i(Nt,"drawEllipse");function ft(t){if(typeof t.radius!="number")throw new Error('drawCircle() requires property "radius".');t.radius!==0&&Nt(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}i(ft,"drawCircle");function $t(t){let{p1:e,p2:r}=t;if(!e||!r)throw new Error('drawLine() requires properties "p1" and "p2".');let n=t.width||1,o=r.sub(e).unit().normal().scale(n*.5),s=t.color??_.WHITE,a=t.opacity??1,c={pos:[e.x-o.x,e.y-o.y,e.x+o.x,e.y+o.y,r.x+o.x,r.y+o.y,r.x-o.x,r.y-o.y],uv:[0,0,0,0,0,0,0,0],color:[s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b,s.r,s.g,s.b],opacity:[a,a,a,a]};Ne(c,[0,1,3,1,2,3],t.fixed,T.defTex,t.shader,t.uniform??void 0)}i($t,"drawLine");function xc(t){let e=t.pts,r=[],n=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||b(0,0),a;o?a=e[0].sub(e[e.length-2]):a=e[1].sub(e[0]);let c=a.len(),u=a.normal().scale(-n/c),m,l=e[0];if(!o)switch(t.cap){case"square":{let v=a.scale(-n/c);r.push(l.add(v).add(u)),r.push(l.add(v).sub(u));break}case"round":{let v=Math.max(n,10),g=Math.PI/v,x=u.scale(-1),y=Math.cos(g),G=Math.sin(g);for(let B=0;B<v;B++)r.push(l),r.push(l.sub(x)),x=b(x.x*y-x.y*G,x.x*G+x.y*y)}}for(let v=1;v<e.length;v++){if(l===e[v]||l.eq(e[v]))continue;m=l,l=e[v];let g=l.sub(m),x=g.len(),y=g.normal().scale(-n/x),G=a.cross(g);if(Math.abs(G)/(c*x)<.05){r.push(m.add(u)),r.push(m.sub(u)),a.dot(g)<0&&(r.push(m.sub(u)),r.push(m.add(u))),a=g,c=x,u=y;continue}let B=y.sub(u).cross(g)/G,D=u.add(a.scale(B));G>0?(r.push(m.add(D)),r.push(m.sub(u)),r.push(m.add(D)),r.push(m.sub(y))):(r.push(m.add(u)),r.push(m.sub(D)),r.push(m.add(y)),r.push(m.sub(D))),a=g,c=x,u=y}if(!o)switch(r.push(l.add(u)),r.push(l.sub(u)),t.cap){case"square":{let v=a.scale(n/c);r.push(l.add(v).add(u)),r.push(l.add(v).sub(u));break}case"round":{let v=Math.max(n,10),g=Math.PI/v,x=u.scale(1),y=Math.cos(g),G=Math.sin(g);for(let B=0;B<v;B++)x=b(x.x*y-x.y*G,x.x*G+x.y*y),r.push(l),r.push(l.sub(x))}}if(r.length<4)return;let p=[],f=0;for(let v=0;v<r.length-2;v+=2)p[f++]=v+1,p[f++]=v,p[f++]=v+2,p[f++]=v+2,p[f++]=v+3,p[f++]=v+1;o&&(p[f++]=r.length-1,p[f++]=r.length-2,p[f++]=0,p[f++]=0,p[f++]=1,p[f++]=r.length-1);let C={pos:new Array(r.length*2),uv:new Array(r.length*2).fill(0),color:new Array(r.length*3).fill(255),opacity:new Array(r.length).fill(t.opacity??1)};for(let v=0;v<r.length;v++)C.pos[v*2]=r[v].x+s.x,C.pos[v*2+1]=r[v].y+s.y,t.color&&(C.color[v*3]=t.color.r,C.color[v*3+1]=t.color.g,C.color[v*3+2]=t.color.b);Ne(C,p,t.fixed,T.defTex,t.shader,t.uniform??void 0)}i(xc,"_drawLinesBevel");function vc(t){let e=t.pts,r=[],n=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||b(0,0),a;o?a=e[0].sub(e[e.length-2]):a=e[1].sub(e[0]);let c=a.len(),u=a.normal().scale(-n/c),m,l=e[0];if(!o)switch(t.cap){case"square":{let g=a.scale(-n/c);r.push(l.add(g).add(u)),r.push(l.add(g).sub(u));break}case"round":{let g=Math.max(n,10),x=Math.PI/g,y=u.scale(-1),G=Math.cos(x),B=Math.sin(x);for(let D=0;D<g;D++)r.push(l),r.push(l.sub(y)),y=b(y.x*G-y.y*B,y.x*B+y.y*G)}}for(let g=1;g<e.length;g++){if(l===e[g]||l.eq(e[g]))continue;m=l,l=e[g];let x=l.sub(m),y=x.len(),G=x.normal().scale(-n/y),B=a.cross(x);if(Math.abs(B)/(c*y)<.05){r.push(m.add(u)),r.push(m.sub(u)),a.dot(x)<0&&(r.push(m.sub(u)),r.push(m.add(u))),a=x,c=y,u=G;continue}let D=G.sub(u).cross(x)/B,U=u.add(a.scale(D));if(B>0){let h=m.add(U),A=Math.max(n,10),S=ae(u.angleBetween(G)/A),P=u,V=Math.cos(S),j=Math.sin(S);for(let K=0;K<A;K++)r.push(h),r.push(m.sub(P)),P=b(P.x*V-P.y*j,P.x*j+P.y*V)}else{let h=m.sub(U),A=Math.max(n,10),S=ae(u.angleBetween(G)/A),P=u,V=Math.cos(S),j=Math.sin(S);for(let K=0;K<A;K++)r.push(m.add(P)),r.push(h),P=b(P.x*V-P.y*j,P.x*j+P.y*V)}a=x,c=y,u=G}if(!o)switch(r.push(l.add(u)),r.push(l.sub(u)),t.cap){case"square":{let g=a.scale(n/c);r.push(l.add(g).add(u)),r.push(l.add(g).sub(u));break}case"round":{let g=Math.max(n,10),x=Math.PI/g,y=u.scale(1),G=Math.cos(x),B=Math.sin(x);for(let D=0;D<g;D++)y=b(y.x*G-y.y*B,y.x*B+y.y*G),r.push(l),r.push(l.sub(y))}}if(r.length<4)return;let p=r.map(g=>({pos:s.add(g),uv:b(),color:t.color||_.WHITE,opacity:t.opacity??1})),f=[],C=0;for(let g=0;g<r.length-2;g+=2)f[C++]=g+1,f[C++]=g,f[C++]=g+2,f[C++]=g+2,f[C++]=g+3,f[C++]=g+1;o&&(f[C++]=r.length-1,f[C++]=r.length-2,f[C++]=0,f[C++]=0,f[C++]=1,f[C++]=r.length-1);let v={pos:new Array(r.length*2),uv:new Array(r.length*2).fill(0),color:new Array(r.length*3).fill(255),opacity:new Array(r.length).fill(t.opacity??1)};for(let g=0;g<r.length;g++)v.pos[g*2]=r[g].x+s.x,v.pos[g*2+1]=r[g].y+s.y,t.color&&(v.color[g*3]=t.color.r,v.color[g*3+1]=t.color.g,v.color[g*3+2]=t.color.b);Ne(v,f,t.fixed,T.defTex,t.shader,t.uniform??void 0)}i(vc,"_drawLinesRound");function Cc(t){let e=t.pts,r=[],n=(t.width||1)*.5,o=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),s=t.pos||b(0,0),a;o?a=e[0].sub(e[e.length-2]):a=e[1].sub(e[0]);let c=a.len(),u=a.normal().scale(-n/c),m,l=e[0];if(!o)switch(t.cap){case"square":{let g=a.scale(-n/c);r.push(l.add(g).add(u)),r.push(l.add(g).sub(u));break}case"round":{let g=Math.max(n,10),x=Math.PI/g,y=u.scale(-1),G=Math.cos(x),B=Math.sin(x);for(let D=0;D<g;D++)r.push(l),r.push(l.sub(y)),y=b(y.x*G-y.y*B,y.x*B+y.y*G)}}for(let g=1;g<e.length;g++){if(l===e[g]||l.eq(e[g]))continue;m=l,l=e[g];let x=l.sub(m),y=x.len(),G=x.normal().scale(-n/y),B=a.cross(x);if(Math.abs(B)/(c*y)<.05){r.push(m.add(u)),r.push(m.sub(u)),a.dot(x)<0&&(r.push(m.sub(u)),r.push(m.add(u))),a=x,c=y,u=G;continue}let D=G.sub(u).cross(x)/B,U=u.add(a.scale(D));r.push(m.add(U)),r.push(m.sub(U)),a=x,c=y,u=G}if(!o)switch(r.push(l.add(u)),r.push(l.sub(u)),t.cap){case"square":{let g=a.scale(n/c);r.push(l.add(g).add(u)),r.push(l.add(g).sub(u));break}case"round":{let g=Math.max(n,10),x=Math.PI/g,y=u.scale(1),G=Math.cos(x),B=Math.sin(x);for(let D=0;D<g;D++)y=b(y.x*G-y.y*B,y.x*B+y.y*G),r.push(l),r.push(l.sub(y))}}if(r.length<4)return;let p=r.map(g=>({pos:s.add(g),uv:b(),color:t.color||_.WHITE,opacity:t.opacity??1})),f=[],C=0;for(let g=0;g<r.length-2;g+=2)f[C++]=g+1,f[C++]=g,f[C++]=g+2,f[C++]=g+2,f[C++]=g+3,f[C++]=g+1;o&&(f[C++]=r.length-1,f[C++]=r.length-2,f[C++]=0,f[C++]=0,f[C++]=1,f[C++]=r.length-1);let v={pos:new Array(r.length*2),uv:new Array(r.length*2).fill(0),color:new Array(r.length*3).fill(255),opacity:new Array(r.length).fill(t.opacity??1)};for(let g=0;g<r.length;g++)v.pos[g*2]=r[g].x+s.x,v.pos[g*2+1]=r[g].y+s.y,t.color&&(v.color[g*3]=t.color.r,v.color[g*3+1]=t.color.g,v.color[g*3+2]=t.color.b);Ne(v,f,t.fixed,T.defTex,t.shader,t.uniform??void 0)}i(Cc,"_drawLinesMiter");function Wt(t){let e=t.pts,r=t.width??1;if(!e)throw new Error('drawLines() requires property "pts".');if(!(e.length<2)){if(e.length>2)switch(t.join){case"bevel":return xc(t);case"round":return vc(t);case"miter":return Cc(t)}if(t.radius&&e.length>=3){$t(Object.assign({},t,{p1:e[0],p2:e[1]}));for(let n=1;n<e.length-2;n++){let o=e[n],s=e[n+1];$t(Object.assign({},t,{p1:o,p2:s}))}$t(Object.assign({},t,{p1:e[e.length-2],p2:e[e.length-1]}))}else for(let n=0;n<e.length-1;n++)$t(Object.assign({},t,{p1:e[n],p2:e[n+1]})),t.join!=="none"&&ft(Object.assign({},t,{pos:e[n],radius:r/2}))}}i(Wt,"drawLines");function sn(t,e){let r=e.segments??16,n=[];for(let o=0;o<=r;o++)n.push(t(o/r));Wt({pts:n,width:e.width||1,pos:e.pos,color:e.color,opacity:e.opacity})}i(sn,"drawCurve");function wa(t){sn(e=>er(t.pt1,t.pt2,t.pt3,t.pt4,e),t)}i(wa,"drawBezier");var no={};function Sa(t,e){e.pos&&(t.pos=t.pos.add(e.pos)),e.scale&&(t.scale=t.scale.scale(b(e.scale))),e.angle&&(t.angle+=e.angle),e.color&&t.ch.length===1&&(t.color=t.color.mult(e.color)),e.opacity!=null&&(t.opacity*=e.opacity)}i(Sa,"applyCharTransform");function nn(t){let e={},r="",n=[],o=String(t),s=i(a=>{n.length>0&&(e[r.length]=n.slice()),r+=a},"emit");for(;o!=="";){if(o[0]==="\\"){if(o.length===1)throw new Error("Styled text error: \\ at end of string");s(o[1]),o=o.slice(2);continue}if(o[0]==="["){let a=/^\[(\/)?(\w+?)\]/.exec(o);if(!a){s(o[0]),o=o.slice(1);continue}let[c,u,m]=a;if(u!==void 0){let l=n.pop();if(l!==m)throw l!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${l}], got [/${m}]`):new Error(`Styled text error: stray end tag [/${m}]`)}else n.push(m);o=o.slice(c.length);continue}s(o[0]),o=o.slice(1)}if(n.length>0)throw new Error(`Styled text error: unclosed tags ${n}`);return{charStyleMap:e,text:r}}i(nn,"compileStyledText");function $e(t){if(t.text===void 0)throw new Error('formatText() requires property "text".');let e=In(t.font);if(!t.text||t.text===""||e instanceof he||!e)return{width:0,height:0,chars:[],opt:t,renderedText:""};let{charStyleMap:r,text:n}=nn(t.text+""),o=ti(n);if(e instanceof Vt||typeof e=="string"){let G=e instanceof Vt?e.fontface.family:e,B=e instanceof Vt?{outline:e.outline,filter:e.filter}:{outline:null,filter:sr},D=no[G]??{font:{tex:new Be(T.ggl,2048,2048,{filter:B.filter}),map:{},size:64},cursor:new O(0),outline:B.outline};no[G]||(no[G]=D),e=D.font;for(let U of o)if(!D.font.map[U]){let h=oo;if(!h)throw new Error("fontCacheC2d is not defined.");if(!bt)throw new Error("fontCacheCanvas is not defined.");h.clearRect(0,0,bt.width,bt.height),h.font=`${e.size}px ${G}`,h.textBaseline="top",h.textAlign="left",h.fillStyle="#ffffff";let A=h.measureText(U),S=Math.ceil(A.width);if(!S)continue;let P=A.fontBoundingBoxAscent+A.fontBoundingBoxDescent;D.outline&&D.outline.width&&D.outline.color&&(h.lineJoin="round",h.lineWidth=D.outline.width*2,h.strokeStyle=D.outline.color.toHex(),h.strokeText(U,D.outline.width,D.outline.width),S+=D.outline.width*2,P+=D.outline.width*3),h.fillText(U,D.outline?.width??0,D.outline?.width??0);let V=h.getImageData(0,0,S,P);if(D.cursor.x+S>2048&&(D.cursor.x=0,D.cursor.y+=P,D.cursor.y>2048))throw new Error("Font atlas exceeds character limit");e.tex.update(V,D.cursor.x,D.cursor.y),e.map[U]=new X(D.cursor.x,D.cursor.y,S,P),D.cursor.x+=S}}let s=t.size||e.size,a=b(t.scale??1).scale(s/e.size),c=t.lineSpacing??0,u=t.letterSpacing??0,m=0,l=0,p=0,f=[],C=[],v=0,g=null,x=0;for(;v<o.length;){let G=o[v];if(G===`
`)p+=s+c,f.push({width:m-u,chars:C}),g=null,x=0,m=0,C=[];else{let B=e.map[G];if(B){let D=B.w*a.x;t.width&&m+D>t.width&&(p+=s+c,g!=null&&(v-=C.length-g,G=o[v],B=e.map[G],D=B.w*a.x,C=C.slice(0,g-1),m=x),g=null,x=0,f.push({width:m-u,chars:C}),m=0,C=[]),C.push({tex:e.tex,width:B.w,height:B.h,quad:new X(B.x/e.tex.width,B.y/e.tex.height,B.w/e.tex.width,B.h/e.tex.height),ch:G,pos:new O(m,p),opacity:t.opacity??1,color:t.color??_.WHITE,scale:b(a),angle:0}),G===" "&&(g=C.length,x=m),m+=D,l=Math.max(l,m),m+=u}}v++}f.push({width:m-u,chars:C}),p+=s,t.width&&(l=t.width);let y=[];for(let G=0;G<f.length;G++){let B=(l-f[G].width)*li(t.align??"left");for(let D of f[G].chars){let U=e.map[D.ch],h=y.length+G;if(D.pos=D.pos.add(B,0).add(U.w*a.x*.5,U.h*a.y*.5),t.transform){let A=typeof t.transform=="function"?t.transform(h,D.ch):t.transform;A&&Sa(D,A)}if(r[h]){let A=r[h];for(let S of A){let P=t.styles?.[S],V=typeof P=="function"?P(h,D.ch):P;V&&Sa(D,V)}}y.push(D)}}return{width:l,height:p,chars:y,opt:t,renderedText:n}}i($e,"formatText");function mt(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,r=t.height,n=qe(t.anchor||ht),o=n.x*e*-.5,s=n.y*r*-.5,a=t.quad||new X(0,0,1,1),c=t.color||_.WHITE,u=t.opacity??1,m=t.tex?.1/t.tex.width:0,l=t.tex?.1/t.tex.height:0,p=a.x+m,f=a.y+l,C=a.w-m*2,v=a.h-l*2;Ee(),Se(t.pos),et(t.angle),lt(t.scale),tt(o,s),Ne({pos:[-e/2,r/2,-e/2,-r/2,e/2,-r/2,e/2,r/2],uv:[t.flipX?p+C:p,t.flipY?f:f+v,t.flipX?p+C:p,t.flipY?f+v:f,t.flipX?p:p+C,t.flipY?f+v:f,t.flipX?p:p+C,t.flipY?f:f+v],color:[c.r,c.g,c.b,c.r,c.g,c.b,c.r,c.g,c.b,c.r,c.g,c.b],opacity:[u,u,u,u]},[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform??void 0),ve()}i(mt,"drawUVQuad");function Xe(t){Ee(),Se(t.opt.pos),et(t.opt.angle),Se(qe(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(e=>{mt({tex:e.tex,width:e.width,height:e.height,pos:e.pos,scale:e.scale,angle:e.angle,color:e.color,opacity:e.opacity,quad:e.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),ve()}i(Xe,"drawFormattedText");function Ge(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,r=t.height,o=qe(t.anchor||ht).add(1,1).scale(new O(e,r).scale(-.5)),s=[new O(0,0),new O(e,0),new O(e,r),new O(0,r)];if(t.radius){let a=Math.min(e,r)/2,c=Array.isArray(t.radius)?t.radius.map(u=>Math.min(a,u)):new Array(4).fill(Math.min(a,t.radius));s=[new O(c[0],0),...c[1]?Et(new O(e-c[1],c[1]),c[1],c[1],270,360):[b(e,0)],...c[2]?Et(new O(e-c[2],r-c[2]),c[2],c[2],0,90):[b(e,r)],...c[3]?Et(new O(c[3],r-c[3]),c[3],c[3],90,180):[b(0,r)],...c[0]?Et(new O(c[0],c[0]),c[0],c[0],180,270):[]]}ze(Object.assign({},t,{offset:o,pts:s,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}i(Ge,"drawRect");function Qe(t){Te();let e=T.width,r=T.height;T.width=T.viewport.width,T.height=T.viewport.height,t(),Te(),T.width=e,T.height=r}i(Qe,"drawUnscaled");function io(t,e){Qe(()=>{let r=b(8);Ee(),Se(t);let n=$e({text:e,font:St,size:16,pos:r,color:W(255,255,255),fixed:!0}),o=n.width+r.x*2,s=n.height+r.x*2;t.x+o>=ge()&&Se(b(-o,0)),t.y+s>=ye()&&Se(b(0,-s)),Ge({width:o,height:s,color:W(0,0,0),radius:4,opacity:.8,fixed:!0}),Xe(n),ve()})}i(io,"drawInspectText");function an(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return ze(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}i(an,"drawTriangle");function Aa(){if(Z.inspect){let t=null;for(let e of E.root.get("*",{recursive:!0}))if(e.c("area")&&e.isHovering()){t=e;break}if(E.root.drawInspect(),t){let e=[],r=t.inspect();for(let n in r)r[n]?e.push(`${r[n]}`):e.push(`${n}`);io(Ca(Yt()),e.join(`
`))}io(b(8),`FPS: ${Z.fps()}`)}Z.paused&&Qe(()=>{Ee(),tt(ge(),0),tt(-8,8);let t=32;Ge({width:t,height:t,anchor:"topright",color:W(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Ge({width:4,height:t*.6,anchor:"center",pos:b(-t/3*e,t*.5),color:W(255,255,255),radius:2,fixed:!0});ve()}),Z.timeScale!==1&&Qe(()=>{Ee(),tt(ge(),ye()),tt(-8,-8);let t=8,e=$e({text:Z.timeScale.toFixed(1),font:St,size:16,color:W(255,255,255),pos:b(-t),anchor:"botright",fixed:!0});Ge({width:e.width+t*2+t*4,height:e.height+t*2,anchor:"botright",color:W(0,0,0),opacity:.8,radius:4,fixed:!0});for(let r=0;r<2;r++){let n=Z.timeScale<1;an({p1:b(-e.width-t*(n?2:3.5),-t),p2:b(-e.width-t*(n?2:3.5),-t-e.height),p3:b(-e.width-t*(n?3.5:2),-t-e.height/2),pos:b(-r*t*1+(n?-t*.5:0),0),color:W(255,255,255),fixed:!0})}Xe(e),ve()}),Z.curRecording&&Qe(()=>{Ee(),tt(0,ye()),tt(24,-24),ft({radius:12,color:W(255,0,0),opacity:Er(0,1,R.time()*4),fixed:!0}),ve()}),Z.showLog&&E.logs.length>0&&Qe(()=>{Ee(),tt(0,ye()),tt(8,-8);let t=8,e=[];for(let n of E.logs){let o="",s=n.msg instanceof Error?"error":"info";o+=`[time]${n.time.toFixed(2)}[/time]`,o+=" ",o+=`[${s}]${so(n.msg)}[/${s}]`,e.push(o)}E.logs=E.logs.filter(n=>R.time()-n.time<(ue.logTime||4));let r=$e({text:e.join(`
`),font:St,pos:b(t,-t),anchor:"botleft",size:16,width:ge()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:W(127,127,127)},info:{color:W(255,255,255)},error:{color:W(255,0,127)}}});Ge({width:r.width+t*2,height:r.height+t*2,anchor:"botleft",color:W(0,0,0),radius:4,opacity:.8,fixed:!0}),Xe(r),ve()})}i(Aa,"drawDebug");function so(t,e=!1){var r="",n;return e&&typeof t=="string"&&(t=JSON.stringify(t)),Array.isArray(t)&&(r=["[",t.map(o=>so(o,!0)).join(", "),"]"].join(""),t=r),typeof t=="object"&&t.toString===Object.prototype.toString&&(t.constructor!==Object&&(r+=t.constructor.name+" "),r+=["{",(n=Object.getOwnPropertyNames(t).map(o=>`${/^\w+$/.test(o)?o:JSON.stringify(o)}: ${so(t[o],!0)}`).join(", "))?` ${n} `:"","}"].join(""),t=r),String(t).replaceAll(/(?<!\\)\[/g,"\\[")}i(so,"prettyDebug");function Va(){let t=E.cam,e=O.fromAngle(be(0,360)).scale(t.shake);t.shake=Oe(t.shake,0,5*Me()),t.transform=new De().translateSelfV(Mt()).scaleSelfV(t.scale).rotateSelf(t.angle).translateSelfV((t.pos??Mt()).scale(-1).add(e)),E.root.draw(),Te()}i(Va,"drawFrame");function Pa(){let t=_e();E.events.numListeners("loading")>0?E.events.trigger("loading",t):Qe(()=>{let e=ge()/2,r=24,n=b(ge()/2,ye()/2).sub(b(e/2,r/2));Ge({pos:b(0),width:ge(),height:ye(),color:W(0,0,0)}),Ge({pos:n,width:e,height:r,fill:!1,outline:{width:4}}),Ge({pos:n,width:e*t,height:r})})}i(Pa,"drawLoadScreen");function un(t,e,r){let n=T.ggl.gl;Te(),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST),n.stencilFunc(n.NEVER,1,255),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),e(),Te(),n.stencilFunc(r,1,255),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),t(),Te(),n.disable(n.STENCIL_TEST)}i(un,"drawStenciled");function Ma(t,e){let r=T.ggl.gl;un(t,e,r.EQUAL)}i(Ma,"drawMasked");function Rt(t){if(!t.tex)throw new Error('drawTexture() requires property "tex".');let e=t.quad??new X(0,0,1,1),r=t.tex.width*e.w,n=t.tex.height*e.h,o=O.ONE;if(t.tiled){let s=qe(t.anchor||ht),a=(s.x+1)*.5*(t.width||r),c=(s.y+1)*.5*(t.height||n),u=(t.width||r)/r,m=(t.height||n)/n,l=Math.floor(u),p=Math.floor(m),f=u-l,C=m-p,v=(l+f?1:0)*(p+C?1:0),g=new Array(v*6),x={pos:new Array(v*4*2),uv:new Array(v*4*2),color:new Array(v*4*3),opacity:new Array(v*4)},y=0,G=t.color||_.WHITE,B=t.opacity||1,D=i((U,h,A,S,P)=>{g[y*6+0]=y*4+0,g[y*6+1]=y*4+1,g[y*6+2]=y*4+3,g[y*6+3]=y*4+1,g[y*6+4]=y*4+2,g[y*6+5]=y*4+3;let V=y*4;x.pos[V*2]=U-a,x.pos[V*2+1]=h-c,x.uv[V*2]=P.x,x.uv[V*2+1]=P.y,x.color[V*3]=G.r,x.color[V*3+1]=G.g,x.color[V*3+2]=G.b,x.opacity[V]=B,V++,x.pos[V*2]=U+A-a,x.pos[V*2+1]=h-c,x.uv[V*2]=P.x+P.w,x.uv[V*2+1]=P.y,x.color[V*3]=G.r,x.color[V*3+1]=G.g,x.color[V*3+2]=G.b,x.opacity[V]=B,V++,x.pos[V*2]=U+A-a,x.pos[V*2+1]=h+S-c,x.uv[V*2]=P.x+P.w,x.uv[V*2+1]=P.y+P.h,x.color[V*3]=G.r,x.color[V*3+1]=G.g,x.color[V*3+2]=G.b,x.opacity[V]=B,V++,x.pos[V*2]=U-a,x.pos[V*2+1]=h+S-c,x.uv[V*2]=P.x,x.uv[V*2+1]=P.y+P.h,x.color[V*3]=G.r,x.color[V*3+1]=G.g,x.color[V*3+2]=G.b,x.opacity[V]=B,y++},"addQuad");for(let U=0;U<p;U++){for(let h=0;h<l;h++)D(h*r,U*n,r,n,e);f&&D(l*r,U*n,r*f,n,new X(e.x,e.y,e.w*f,e.h))}if(C){for(let U=0;U<l;U++)D(U*r,p*n,r,n*C,new X(e.x,e.y,e.w,e.h*C));f&&D(l*r,p*n,r*f,n*C,new X(e.x,e.y,e.w*f,e.h*C))}Ne(x,g,t.fixed,t.tex,t.shader,t.uniform??void 0)}else t.width&&t.height?(o.x=t.width/r,o.y=t.height/n):t.width?(o.x=t.width/r,o.y=o.x):t.height&&(o.y=t.height/n,o.x=o.y),mt(Object.assign({},t,{scale:t.scale?o.scale(t.scale):o,tex:t.tex,quad:e,width:r,height:n}))}i(Rt,"drawTexture");function Ga(t){if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let e=_t(t.sprite);if(!e||!e.data)return;let r=e.data.frames[t.frame??0];if(!r)throw new Error(`Frame not found: ${t.frame??0}`);Rt(Object.assign({},t,{tex:e.data.tex,quad:r.scale(t.quad??new X(0,0,1,1))}))}i(Ga,"drawSprite");function Ra(t,e){let r=T.ggl.gl;un(t,e,r.NOTEQUAL)}i(Ra,"drawSubtracted");function ao(t){Xe($e(t))}i(ao,"drawText");var Da=i((t,e)=>{let r=zr(e,ur,cr),n=t.pixelDensity??1,o=t.scale??1,{gl:s}=e,a=Be.fromImage(e,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),c=t.width&&t.height?new ct(e,t.width*n*o,t.height*n*o):new ct(e,s.drawingBufferWidth,s.drawingBufferHeight),u=null,m=1;t.background&&(typeof t.background=="string"?u=W(t.background):(u=W(...t.background),m=t.background[3]??1),s.clearColor(u.r/255,u.g/255,u.b/255,m??1)),s.enable(s.BLEND),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);let l=new jr(e,ar,Ri,Di),p=Be.fromImage(e,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"}),f=new Array(32).fill(0).map(C=>new De);return{lastDrawCalls:0,ggl:e,defShader:r,defTex:a,frameBuffer:c,postShader:null,postShaderUniform:null,renderer:l,transform:new De,transformStack:f,transformStackIndex:-1,bgTex:p,bgColor:u,bgAlpha:m,width:t.width??s.drawingBufferWidth/n/o,height:t.height??s.drawingBufferHeight/n/o,viewport:{x:0,y:0,width:s.drawingBufferWidth,height:s.drawingBufferHeight},fixed:!1}},"initAppGfx");function tn(){let t=We,e=T.ggl.gl.drawingBufferWidth/t,r=T.ggl.gl.drawingBufferHeight/t;if(ue.letterbox){if(!ue.width||!ue.height)throw new Error("Letterboxing requires width and height defined.");let n=e/r,o=ue.width/ue.height;if(n>o){let s=r*o,a=(e-s)/2;T.viewport={x:a,y:0,width:s,height:r}}else{let s=e/o,a=(r-s)/2;T.viewport={x:0,y:a,width:e,height:s}}return}if(ue.stretch&&(!ue.width||!ue.height))throw new Error("Stretching requires width and height defined.");T.viewport={x:0,y:0,width:e,height:r}}i(tn,"updateViewport");var Ba="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABqxJREFUeJztnU1yFDkQRtMEB+AG7Fk6fBPO6ZsQLGc/N5gbMAtosJvqKv2kpPxS763A0W5XSXqVqZ+SngzgF58/fflx/7N///vnacW1gBkFD2Z2LOYNBF3Dx9UXAGs5kxLWwhNxU2qlJHrOhwLfkNZoiaBzIa3dCFJYLXgSboKXmETPeVDQyamR8vX55fe/v37/9vBzCDoH0tqktEpZ+t0IOh4KOBm16euZmETPtVDAiRgRLRF0HRRuEkrFrE1hzR4Lipxj+bD6AqCPz5++/Bgp5tXfdv1CeAdPPmFmSkn0nE+a0drdFm6XiOkdKWEuKRptTXqlLuqqFNaM6Dkb+T5nbb+npo8WjZVinqFantFJk9bWojaRThq7HzKN8wiPJ7aCoJHEZN5zHvJp7RE1DTV6SnZ1fa/PL1MjJtF5HmnT2tJF3GZ/BIj05I8ULUtR6ypER7ogjxpw61rRGxEal4KYjNyORzatbUlHSxr06tFcBTHPiN5NUEJWzlZKG/aKRqYk5tl1IKgPafucZ7w+vxSluLP6olHnL6MQQfYV6bpk/+BRZXm+cXHEiApSipZHlE6tRBDMkxmyysl5VsmtjXiFoJmiZU35ZWK0oNv1OY+omSv0GDDKJCaMI42cHg25dvFCi6QZxVS6ViVSpLUz38A4oiS9ySjlW2althGWKZrN6XNuOVpbwq0ReIzqZhfTrHwE/PZZuEYqcnqO0tZQGxVqRylprLGIEDXNkLOKEakbYsYiiphmiQaEZuD9BghixiKSmGYJIueqBt4TRZEyHtHENCNyNtMaRREzHhHFNBOKnKv7myVcVXKka4WfRBXTjMjpypl8iBmP6MsOmed0Bgk1UHjxXlpORIAWIqeybyGtha1QEdNMRM5s7wLCGpTENBORE6AXNTHNkBM2QFFMM4F5ToX5TYiLqphmRE7YmMhimiEnJEb9XBdJOUlp4Qp1Mc1E5QQ4I/qyvFJCy8n8JnijEjXNAi3fQ0TwIEM6e2OqnAgII8kkptkgOZEQZlN6BquZjqhVFxlBOkZq4Z6WASAFQQ8jZwQJ70FK8CTiaeb3fDSLJyMiwiwiS/q0SkwEBE+85jYjSTpcTiSE2WQRtVlOpAMVemVdtjXmlZxICFlQk/TJjHcmYS96JJ0p6KmcZggKeWmVdPopYwgKuxJVUuQE+EU0Sd99KYICxJH0ry9DUIA/rFy3WyWnGYLCnqyQ9PCXERTgmJmSPvwlBAU4p1bUWklPP1yytA9JYWdGRtLLDyEowDUjomiRwQgKUIZnJC3OgREUoByPSDpkDyEkBfhJj6RNQ7xEUYA6aiS9Cdo8SUoUBaijVtCuFQwICtBGiajdawARFKCNK0HdVtEjKUAd0+Q0q9v/FklhJ1rmP4e8JEoUBejfq2jYNgtEUdgJzwN7u6dSSkBQyMSME7O7FyHUQpoLCqw8rv5o+d6Uw3NvfzjagUkAZvOlLH1lLMyx8wCzWBEhW3ZDmLZ7NTsrwCpmyui5A1+IPidigjcjhZy14/vytBYxwRsPMVcf/2c2QU72wQUVIgj5lqFyIiZEJ5qQb1me1gLMJLKM93wY9cVETYiGkphmg+RETFhJljY2LHICQB/uchI1AXxwlRMxAfwgrYVtUHvxwk1OoiaAL8MjJ2ICtOEip1q6APnJEBS6VwiRzp4vtM5YBvf3m/EeI8DyvUZK33z4+v1bqsZ7dN+3n2W6zwgMO44hY0X1vIqkXh419x7lXh9ds8oyviFyRqmcXrxf2FUtF89ymFkG6nI2p7WZB4FGvUWfLcVt4ahsdy+TR7ifz6lc0F5v0GfalmXldpE3esrr6PrTR84sjNjS4kpQhQhaUi4lD6KR1xK9DHupfoKoR02vSFDy9FWNoKVivv1/lG7OfZkqR043OZUbWgmtFaomaGl51ZTHCnFv5bqNnFGjZvRtEFUEHSHmI1ZHWgVBXZ5+sxvX7ANlPChpjKsknSllKaPlRU4nZo0Yjq6wiIJGFPMML2mj3M8ZRRe4QkzF6FhCJEFbBn4i0iKswn11yenZiLLKeMRqQdWiZSmlkqrcV9d0gPfksAcqBW+2ZqAoq5gZGSrnTtGwlVmCIqUepxWxerj7iIyNZ7SgiKmJhJw7NJpRgiKmLuHl3KnReA4UIaU+y+WkcbzHQ1DEzMGQ9aJH0BDK6RE0y9wlTDp2HuppERQxc0FFBaZGUMTMB5UlQG/fHyk1odJEaBUUMXWh4oSoFRQxtaHyxMi2uBseQwUKciUoYuaAShTlkaCImQcqUph7QREzF/8DSS/2GZ2/N/sAAAAASUVORK5CYII=";var Ua="data:image/png;base64,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";var Tc="3001.0.0",F,ue,T,E,R,k,bt,oo,Z,oe,We,Ce,qt,Wn,$n,La=i((t={})=>{ue=t;let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%"),Ce=t.canvas??e.appendChild(document.createElement("canvas")),qt=t.scale??1;let r=t.width&&t.height&&!t.stretch&&!t.letterbox;r?(Ce.width=t.width*qt,Ce.height=t.height*qt):(Ce.width=Ce.parentElement.offsetWidth,Ce.height=Ce.parentElement.offsetHeight);let n=["outline: none","cursor: default"];if(r){let L=Ce.width,N=Ce.height;n.push(`width: ${L}px`),n.push(`height: ${N}px`)}else n.push("width: 100%"),n.push("height: 100%");t.crisp&&(n.push("image-rendering: pixelated"),n.push("image-rendering: crisp-edges")),Ce.style.cssText=n.join(";"),We=t.pixelDensity||1,Ce.width*=We,Ce.height*=We,Ce.tabIndex=0,bt=document.createElement("canvas"),bt.width=256,bt.height=256,oo=bt.getContext("2d",{willReadFrequently:!0}),R=ai({canvas:Ce,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons});let o=[],s=R.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!s)throw new Error("WebGL not supported");let a=s,c=vi(a,{texFilter:t.texFilter});T=Da(t,c),oe=Us(),k=zi(c),E=Ps(),E.root.use(gr());function u(L,N){let ee=new ct(c,L,N);return{clear:i(()=>ee.clear(),"clear"),free:i(()=>ee.free(),"free"),toDataURL:i(()=>ee.toDataURL(),"toDataURL"),toImageData:i(()=>ee.toImageData(),"toImageData"),width:ee.width,height:ee.height,draw:i(ne=>{Te(),ee.bind(),ne(),Te(),ee.unbind()},"draw")}}i(u,"makeCanvas");function m(){a.clear(a.COLOR_BUFFER_BIT),T.frameBuffer.bind(),a.clear(a.COLOR_BUFFER_BIT),T.bgColor||Qe(()=>{mt({width:ge(),height:ye(),quad:new X(0,0,ge()/64,ye()/64),tex:T.bgTex,fixed:!0})}),T.renderer.numDraws=0,T.fixed=!1,T.transformStackIndex=-1,T.transform.setIdentity()}i(m,"frameStart");function l(L,N){T.postShader=L,T.postShaderUniform=N??null}i(l,"usePostEffect");function p(){Te(),T.lastDrawCalls=T.renderer.numDraws,T.frameBuffer.unbind(),a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);let L=T.width,N=T.height;T.width=a.drawingBufferWidth/We,T.height=a.drawingBufferHeight/We,Rt({flipY:!0,tex:T.frameBuffer.tex,pos:new O(T.viewport.x,T.viewport.y),width:T.viewport.width,height:T.viewport.height,shader:T.postShader,uniform:typeof T.postShaderUniform=="function"?T.postShaderUniform():T.postShaderUniform,fixed:!0}),Te(),T.width=L,T.height=N}i(p,"frameEnd");let f=!1;Z={inspect:!1,timeScale:1,showLog:!0,fps:i(()=>R.fps(),"fps"),numFrames:i(()=>R.numFrames(),"numFrames"),stepFrame:j,drawCalls:i(()=>T.lastDrawCalls,"drawCalls"),clearLog:i(()=>E.logs=[],"clearLog"),log:i((...L)=>{let N=t.logMax??8,ee=L.length>1?L.concat(" ").join(" "):L[0];E.logs.unshift({msg:ee,time:R.time()}),E.logs.length>N&&(E.logs=E.logs.slice(0,N))},"log"),error:i(L=>Z.log(new Error(L.toString?L.toString():L)),"error"),curRecording:null,numObjects:i(()=>U("*",{recursive:!0}).length,"numObjects"),get paused(){return f},set paused(L){f=L,L?oe.ctx.suspend():oe.ctx.resume()}};function C(L,N){try{return JSON.parse(window.localStorage[L])}catch{return N?(v(L,N),N):null}}i(C,"getData");function v(L,N){window.localStorage[L]=JSON.stringify(N)}i(v,"setData");function g(L,...N){let ee=L(F),ne;typeof ee=="function"?ne=ee(...N)(F):ne=ee;for(let we in ne)F[we]=ne[we],t.global!==!1&&(window[we]=ne[we]);return F}i(g,"plug");function x(L){let N=R.canvas.captureStream(L),ee=oe.ctx.createMediaStreamDestination();oe.masterNode.connect(ee);let ne=new MediaRecorder(N),we=[];return ne.ondataavailable=Ae=>{Ae.data.size>0&&we.push(Ae.data)},ne.onerror=()=>{oe.masterNode.disconnect(ee),N.getTracks().forEach(Ae=>Ae.stop())},ne.start(),{resume(){ne.resume()},pause(){ne.pause()},stop(){return ne.stop(),oe.masterNode.disconnect(ee),N.getTracks().forEach(Ae=>Ae.stop()),new Promise(Ae=>{ne.onstop=()=>{Ae(new Blob(we,{type:"video/mp4"}))}})},download(Ae="kaboom.mp4"){this.stop().then(Bt=>En(Ae,Bt))}}}i(x,"record");function y(){return document.activeElement===R.canvas}i(y,"isFocused");let G=E.root.add.bind(E.root),B=E.root.readd.bind(E.root),D=E.root.removeAll.bind(E.root),U=E.root.get.bind(E.root),h=E.root.wait.bind(E.root),A=E.root.loop.bind(E.root),S=E.root.query.bind(E.root),P=E.root.tween.bind(E.root);$n=Pt(null,Ba),Wn=Pt(null,Ua);function V(){E.root.fixedUpdate()}i(V,"fixedUpdateFrame");function j(){E.root.update()}i(j,"updateFrame");class K{static{i(this,"Collision")}source;target;normal;distance;resolved=!1;constructor(N,ee,ne,we,Ae=!1){this.source=N,this.target=ee,this.normal=ne,this.distance=we,this.resolved=Ae}get displacement(){return this.normal.scale(this.distance)}reverse(){return new K(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(E.gravity||b(0,1))>0}isRight(){return this.displacement.cross(E.gravity||b(0,1))<0}isTop(){return this.displacement.dot(E.gravity||b(0,1))>0}isBottom(){return this.displacement.dot(E.gravity||b(0,1))<0}preventResolution(){this.resolved=!0}}function $(L,N){if(N.paused||!N.exists())return!1;for(let ne of L.collisionIgnore)if(N.is(ne))return!1;for(let ne of N.collisionIgnore)if(L.is(ne))return!1;let ee=Mn(L.worldArea(),N.worldArea());if(ee){let ne=new K(L,N,ee.normal,ee.distance);L.trigger("collideUpdate",N,ne);let we=ne.reverse();we.resolved=ne.resolved,N.trigger("collideUpdate",L,we)}return!0}i($,"narrowPhase");let q=new Ir,Q=!1;function z(){if(ro()){if(!Q){Q=!0,Xr(L=>{L.is("area")&&q.add(L)}),zn(L=>{q.remove(L)}),Xn(L=>{Q=!1,q.clear()});for(let L of U("*",{recursive:!0}))L.is("area")&&q.add(L)}q.update();for(let[L,N]of q)$(L,N)}}i(z,"broadPhase");function Y(){if(ro())return z()}i(Y,"checkFrame");function re(L){console.error(L),oe.ctx.suspend();let N=L.message??String(L)??"Unknown error, check console for more info";R.run(()=>{},()=>{m(),Qe(()=>{let we=ge(),Ae=ye(),Bt={size:36,width:we-32*2,letterSpacing:4,lineSpacing:4,font:St,fixed:!0};Ge({width:we,height:Ae,color:W(0,0,255),fixed:!0});let yr=$e({...Bt,text:"Error",pos:b(32),color:W(255,128,0),fixed:!0});Xe(yr),ao({...Bt,text:N,pos:b(32,32+yr.height+16),fixed:!0}),ve(),E.events.trigger("error",L)}),p()})}i(re,"handleErr");function J(L){o.push(L)}i(J,"onCleanup");function ie(){E.events.onOnce("frameEnd",()=>{R.quit(),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);let L=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(let N=0;N<L;N++)a.activeTexture(a.TEXTURE0+N),a.bindTexture(a.TEXTURE_2D,null),a.bindTexture(a.TEXTURE_CUBE_MAP,null);a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),c.destroy(),o.forEach(N=>N())})}i(ie,"quit");let ce=!0;R.run(()=>{try{k.loaded&&(Z.paused||V(),Y())}catch(L){re(L)}},(L,N)=>{try{L(),k.loaded||_e()===1&&!ce&&(k.loaded=!0,E.events.trigger("load")),!k.loaded&&t.loadingScreen!==!1||ce?(m(),Pa(),p()):(Z.paused||j(),Y(),m(),Va(),t.debug!==!1&&Aa(),p()),ce&&(ce=!1),E.events.trigger("frameEnd"),N()}catch(ee){re(ee)}}),tn(),en(),F={VERSION:Tc,loadRoot:_i,loadProgress:_e,loadSprite:Pt,loadSpriteAtlas:_n,loadSound:rs,loadMusic:ns,loadBitmapFont:Xi,loadFont:Wi,loadShader:Zi,loadShaderURL:es,loadAseprite:Yi,loadPedit:Qi,loadBean:ss,loadJSON:Hi,load:lr,getSound:Nn,getFont:jn,getBitmapFont:qr,getSprite:qn,getShader:kn,getAsset:qi,Asset:he,SpriteData:Ye,SoundData:ot,width:ge,height:ye,center:Mt,dt:Me,fixedDt:ui,restDt:ci,time:R.time,screenshot:R.screenshot,record:x,isFocused:y,setCursor:R.setCursor,getCursor:R.getCursor,setCursorLocked:R.setCursorLocked,isCursorLocked:R.isCursorLocked,setFullscreen:R.setFullscreen,isFullscreen:R.isFullscreen,isTouchscreen:R.isTouchscreen,onLoad:Ht,onLoading:Ts,onResize:As,onGamepadConnect:R.onGamepadConnect,onGamepadDisconnect:R.onGamepadDisconnect,onError:Vs,onCleanup:J,camPos:as,camScale:us,camFlash:ls,camRot:cs,camTransform:ms,shake:ps,toScreen:ds,toWorld:fs,setGravity:Ms,getGravity:Gs,setGravityDirection:Rs,getGravityDirection:Ds,setBackground:yi,getBackground:xi,getGamepads:R.getGamepads,getTreeRoot:Ks,add:G,make:dr,destroy:Yr,destroyAll:D,get:U,query:S,readd:B,pos:Gt,scale:zt,rotate:ya,color:Kr,opacity:kr,anchor:hr,area:ia,sprite:fr,text:Hs,polygon:Vi,rect:_r,circle:Ci,ellipse:Ei,uvquad:qs,outline:Ti,particles:Ai,body:sa,surfaceEffector:ua,areaEffector:ca,pointEffector:la,buoyancyEffector:da,platformEffector:pa,constantForce:ma,doubleJump:aa,shader:Pi,textInput:na,timer:gr,fixed:Wr,stay:rn,health:Zs,lifespan:ea,named:ta,state:ra,z:xa,layer:ha,move:ga,offscreen:ba,follow:fa,fadeIn:Oi,mask:Si,drawon:wi,raycast:Nr,tile:$r,animate:Qs,serializeAnimation:eo,agent:zs,sentry:$s,patrol:Ws,pathfinder:Ys,fakeMouse:Js,on:it,onFixedUpdate:gs,onUpdate:bs,onDraw:ys,onAdd:Xr,onDestroy:zn,onClick:ws,onCollide:xs,onCollideUpdate:vs,onCollideEnd:Cs,onHover:Es,onHoverUpdate:Os,onHoverEnd:Ss,onKeyDown:R.onKeyDown,onKeyPress:R.onKeyPress,onKeyPressRepeat:R.onKeyPressRepeat,onKeyRelease:R.onKeyRelease,onMouseDown:R.onMouseDown,onMousePress:R.onMousePress,onMouseRelease:R.onMouseRelease,onMouseMove:R.onMouseMove,onCharInput:R.onCharInput,onTouchStart:R.onTouchStart,onTouchMove:R.onTouchMove,onTouchEnd:R.onTouchEnd,onScroll:R.onScroll,onHide:R.onHide,onShow:R.onShow,onGamepadButtonDown:R.onGamepadButtonDown,onGamepadButtonPress:R.onGamepadButtonPress,onGamepadButtonRelease:R.onGamepadButtonRelease,onGamepadStick:R.onGamepadStick,onButtonPress:R.onButtonPress,onButtonDown:R.onButtonDown,onButtonRelease:R.onButtonRelease,mousePos:Yt,mouseDeltaPos:R.mouseDeltaPos,isKeyDown:R.isKeyDown,isKeyPressed:R.isKeyPressed,isKeyPressedRepeat:R.isKeyPressedRepeat,isKeyReleased:R.isKeyReleased,isMouseDown:R.isMouseDown,isMousePressed:R.isMousePressed,isMouseReleased:R.isMouseReleased,isMouseMoved:R.isMouseMoved,isGamepadButtonPressed:R.isGamepadButtonPressed,isGamepadButtonDown:R.isGamepadButtonDown,isGamepadButtonReleased:R.isGamepadButtonReleased,getGamepadStick:R.getGamepadStick,isButtonPressed:R.isButtonPressed,isButtonDown:R.isButtonDown,isButtonReleased:R.isButtonReleased,setButton:R.setButton,getButton:R.getButton,pressButton:R.pressButton,releaseButton:R.releaseButton,getLastInputDeviceType:R.getLastInputDeviceType,charInputted:R.charInputted,loop:A,wait:h,play:Jr,volume:Ls,burp:Zr,audioCtx:oe.ctx,Line:Ve,Rect:te,Circle:xe,Ellipse:Pe,Point:wr,Polygon:pe,Vec2:O,Color:_,Mat4:Ft,Mat23:De,Quad:X,RNG:Jt,rand:be,randi:fn,randSeed:xo,vec2:b,rgb:W,hsl2rgb:go,quad:de,choose:wo,chooseMultiple:Co,shuffle:hn,chance:vo,lerp:Oe,tween:P,easings:ut,map:Le,mapc:yo,wave:Er,deg2rad:ae,rad2deg:at,clamp:Ke,evaluateQuadratic:Go,evaluateQuadraticFirstDerivative:Ro,evaluateQuadraticSecondDerivative:Do,evaluateBezier:er,evaluateBezierFirstDerivative:Bo,evaluateBezierSecondDerivative:Uo,evaluateCatmullRom:Fo,evaluateCatmullRomFirstDerivative:Lo,curveLengthApproximation:vn,normalizedCurve:Io,hermite:It,cardinal:Cn,catmullRom:jt,bezier:jo,kochanekBartels:Ko,easingSteps:Ho,easingLinear:No,easingCubicBezier:_o,testLineLine:Or,testRectRect:gn,testRectLine:Sr,testRectPoint:Tr,testCirclePolygon:Zt,testLinePoint:Ar,testLineCircle:Lt,gjkShapeIntersects:gi,gjkShapeIntersection:Mn,isConvex:zo,triangulate:Pr,NavMesh:Fr,drawSprite:Ga,drawText:ao,formatText:$e,drawRect:Ge,drawLine:$t,drawLines:Wt,drawTriangle:an,drawCircle:ft,drawEllipse:Nt,drawUVQuad:mt,drawPolygon:ze,drawCurve:sn,drawBezier:wa,drawFormattedText:Xe,drawMasked:Ma,drawSubtracted:Ra,pushTransform:Ee,popTransform:ve,pushTranslate:Se,pushScale:lt,pushRotate:et,pushMatrix:va,usePostEffect:l,makeCanvas:u,debug:Z,scene:ks,getSceneName:_s,go:Ns,onSceneLeave:Xn,layers:js,addLevel:hs,getData:C,setData:v,download:Mr,downloadJSON:Qo,downloadText:wn,downloadBlob:En,plug:g,ASCII_CHARS:Hr,canvas:R.canvas,addKaboom:Is,LEFT:O.LEFT,RIGHT:O.RIGHT,UP:O.UP,DOWN:O.DOWN,RED:_.RED,GREEN:_.GREEN,BLUE:_.BLUE,YELLOW:_.YELLOW,MAGENTA:_.MAGENTA,CYAN:_.CYAN,WHITE:_.WHITE,BLACK:_.BLACK,quit:ie,KEvent:me,KEventHandler:Je,KEventController:He};let H=t.plugins;if(H&&H.forEach(g),t.global!==!1)for(let L in F)window[L]=F[L];return t.focus!==!1&&R.canvas.focus(),F},"kaplay");var Ac=La;return hu(Vc);})();
window.kaboom = kaplay.default; window.kaplay = kaplay.default
//# sourceMappingURL=kaboom.js.map
